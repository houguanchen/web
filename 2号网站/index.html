<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾¯å† è¾°å¼ºåŒ–å­¦ä¹ é”…ç‚‰ä¼˜åŒ– (v5.0 æ·±åº¦è§£æç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']]
          }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .nav-link { transition: all 0.2s ease-in-out; border-left: 4px solid transparent; }
        .nav-link.active { background-color: #eef2ff; color: #3730a3; border-left-color: #4f46e5; font-weight: 600; }
        .nav-link:not(.active):hover { background-color: #f1f5f9; }
        .nav-header { font-size: 0.75rem; font-weight: 700; color: #475569; text-transform: uppercase; letter-spacing: 0.05em; padding: 0.75rem 1rem; margin-top: 0.5rem; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        h2 { font-size: 2.25rem; font-weight: 800; color: #1e293b; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
        h3 { font-size: 1.5rem; font-weight: 700; color: #334155; margin-top: 2rem; margin-bottom: 1rem; }
        h4 { font-size: 1.25rem; font-weight: 600; }
        p, ul, li { line-height: 1.75; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #4f46e5; cursor: pointer; border-radius: 50%; box-shadow: 0 0 0 3px #fff, 0 0 0 4px #4f46e5; transition: transform 0.1s ease-in-out; }
        .slider:active::-webkit-slider-thumb { transform: scale(1.2); }
        .slider::-moz-range-thumb { width: 20px; height: 20px; background: #4f46e5; cursor: pointer; border-radius: 50%; }
        
        /* Shared Flame Styles */
        .flame-visual { position: absolute; bottom: 0; left: 50%; transform-origin: bottom center; width: 60%; margin-left: -30%; background: linear-gradient(to top, #ffde00, #ff8c00, rgba(255,140,0,0)); border-radius: 50% 50% 10% 10% / 100% 100% 20% 20%; transition: all 0.4s ease-in-out; animation: flicker-animation 0.3s infinite alternate; }
        #boiler-visual-container, #boiler-visual-container-ch6 { box-shadow: inset 0 0 15px rgba(0,0,0,0.5); border: 3px solid #475569; }
        @keyframes flicker-animation { 0% { transform: scaleY(1) skewX(0deg); opacity: 0.9; } 50% { transform: scaleY(0.98) skewX(2deg); opacity: 1; } 100% { transform: scaleY(1.02) skewX(-2deg); opacity: 0.95; } }

        /* Bellman Grid Styles */
        #bellman-canvas { cursor: pointer; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 10px 15px rgba(79, 70, 229, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); } }
        .pulse-effect { animation: pulse 0.6s ease-out; }

        .deployment-step { transition: all 0.3s ease; border-left-width: 4px; border-color: transparent; }
        .deployment-step.active { border-color: #4f46e5; background-color: #eef2ff; }
    </style>
</head>
<body class="text-slate-800">

    <div class="flex flex-col md:flex-row min-h-screen">
        <aside class="w-full md:w-80 bg-white border-r border-slate-200 flex-shrink-0">
            <div class="p-5 border-b border-slate-200">
                <h1 class="text-2xl font-bold text-indigo-700">RLé”…ç‚‰ä¼˜åŒ–</h1>
                <p class="text-sm text-slate-500 mt-1">å­¦ä¹ ä¸å®éªŒå¹³å° (v5.0 æ·±åº¦è§£æç‰ˆ)</p>
            </div>
            <nav id="main-nav" class="p-2 space-y-1 overflow-y-auto" style="height: calc(100vh - 89px);">
                <div class="nav-header">ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€ç¯‡</div>
                <a href="#chapter1" data-view="chapter1" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">ğŸ“–</span> ç¬¬1ç« : é”…ç‚‰ç³»ç»ŸåŸç†</a>
                <a href="#chapter2" data-view="chapter2" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">ğŸ§°</span> ç¬¬2ç« : å¼ºåŒ–å­¦ä¹ ä¸–ç•Œè§‚</a>
                
                <div class="nav-header">ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒç®—æ³•</div>
                <a href="#chapter3" data-view="chapter3" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">ğŸ­</span> ç¬¬3ç« : æ¼”å‘˜-è¯„è®ºå®¶æ¶æ„</a>
                <a href="#chapter4" data-view="chapter4" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">ğŸ”’</span> ç¬¬4ç« : PPOç®—æ³•è¯¦è§£</a>
                <a href="#chapter5" data-view="chapter5" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">ğŸ§­</span> ç¬¬5ç« : SACç®—æ³•è¯¦è§£</a>

                <div class="nav-header">ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®è·µç¯‡</div>
                <a href="#chapter6" data-view="chapter6" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">ğŸ“</span> ç¬¬6ç« : CMDPæ„å»ºå®éªŒå®¤</a>
                <a href="#chapter7" data-view="chapter7" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">ğŸ¤–</span> ç¬¬7ç« : æ„å»ºæ•°å­—å­ªç”Ÿ</a>
                <a href="#chapter8" data-view="chapter8" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">ğŸ§ª</span> ç¬¬8ç« : è®­ç»ƒå®éªŒä¸è°ƒè¯•</a>

                <div class="nav-header">ç¬¬å››éƒ¨åˆ†ï¼šéƒ¨ç½²ç¯‡</div>
                <a href="#chapter9" data-view="chapter9" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">ğŸš¢</span> ç¬¬9ç« : ä¸‰é˜¶æ®µå®‰å…¨éƒ¨ç½²</a>
                <a href="#chapter10" data-view="chapter10" class="nav-link flex items-center p-3 rounded-lg font-medium text-slate-700"><span class="mr-3 text-lg">å±•æœ›</span> ç¬¬10ç« : æ€»ç»“ä¸æœªæ¥</a>
            </nav>
        </aside>

        <main class="flex-1 p-4 md:p-8 bg-slate-100 overflow-y-auto">
            
            <section id="chapter1" class="content-section">
                <h2>ç¬¬1ç« : é”…ç‚‰ç³»ç»ŸåŸç†</h2>
                <p class="text-lg text-slate-600 mb-6">åœ¨åº”ç”¨ä»»ä½•é«˜çº§ç®—æ³•ä¹‹å‰ï¼Œå¿…é¡»å¯¹è¢«æ§å¯¹è±¡â€”â€”é”…ç‚‰ï¼Œæœ‰æ·±åˆ»çš„ç‰©ç†å’Œå·¥ç¨‹ç†è§£ã€‚æœ¬ç« å°†å¸¦æ‚¨æ·±å…¥äº†è§£é”…ç‚‰èƒŒåçš„æ ¸å¿ƒçŸ›ç›¾ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªè¿›åŒ–ç‰ˆçš„äº’åŠ¨æ²™ç®±ï¼Œè®©æ‚¨äº²æ‰‹æ„Ÿå—åœ¨åŠ¨æ€å·¥å†µä¸‹æ§åˆ¶é”…ç‚‰çš„æŒ‘æˆ˜ã€‚</p>
                <div class="card p-6">
                    <h3 class="text-xl font-bold">åŠ¨æ€å·¥å†µé”…ç‚‰æ²™ç®±</h3>
                    <p class="text-slate-600 mb-6">æˆ‘ä»¬å¼•å…¥äº†â€œé”…ç‚‰è´Ÿè·â€ä½œä¸ºå…³é”®çš„å¤–éƒ¨æ‰°åŠ¨ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯åœ¨ä¸åŒè´Ÿè·ä¸‹ï¼Œé€šè¿‡è°ƒèŠ‚æ§åˆ¶å˜é‡ï¼Œä½¿å„é¡¹æŒ‡æ ‡å°½å¯èƒ½æ¥è¿‘ç›®æ ‡å€¼ã€‚</p>
                    <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                        <!-- Controls -->
                        <div class="lg:col-span-2 bg-slate-50 p-6 rounded-lg">
                            <h4 class="font-bold text-lg mb-4">ğŸ•¹ï¸ æ§åˆ¶ä¸å·¥å†µé¢æ¿</h4>
                            <div class="space-y-6">
                                <div>
                                    <label for="load-slider" class="font-medium flex justify-between">é”…ç‚‰è´Ÿè· (æ‰°åŠ¨): <span id="load-value" class="font-bold text-red-600">75</span>%</label>
                                    <input type="range" id="load-slider" min="50" max="100" value="75" class="slider w-full">
                                    <p class="text-xs text-slate-500 mt-1">æ¨¡æ‹Ÿå¤–éƒ¨éœ€æ±‚å˜åŒ–ï¼Œç›´æ¥å½±å“ç‡ƒçƒ§æ•ˆç‡å’Œæ±¡æŸ“ç‰©ç”ŸæˆåŸºå‡†ã€‚</p>
                                </div>
                                <div class="border-t pt-4">
                                    <label for="air-total-slider" class="font-medium flex justify-between">æ€»é£é‡ (åŠ¨ä½œ): <span id="air-total-value">75</span>%</label>
                                    <input type="range" id="air-total-slider" min="50" max="100" value="75" class="slider w-full">
                                </div>
                                <div>
                                    <label for="burner-tilt-slider" class="font-medium flex justify-between">ç‡ƒçƒ§å™¨æ‘†è§’ (åŠ¨ä½œ): <span id="burner-tilt-value">0</span>Â°</label>
                                    <input type="range" id="burner-tilt-slider" min="-15" max="15" value="0" class="slider w-full">
                                </div>
                                <div>
                                    <label for="o2-dist-slider" class="font-medium flex justify-between">ç‡ƒå°½é£(OFA)å æ¯” (åŠ¨ä½œ): <span id="o2-dist-value">30</span>%</label>
                                    <input type="range" id="o2-dist-slider" min="10" max="50" value="30" class="slider w-full">
                                </div>
                            </div>
                        </div>
                        <!-- Visuals & Metrics -->
                        <div class="lg:col-span-3">
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="p-4 rounded-lg bg-slate-700 flex flex-col items-center justify-center min-h-[300px]">
                                    <h4 class="font-bold text-lg mb-2 text-white">ğŸ”¥ ç‚‰è†›ç«ç„°</h4>
                                    <div id="boiler-visual-container" class="w-48 h-64 bg-slate-800 rounded-t-lg relative overflow-hidden"><div id="flame-visual" class="flame-visual"></div></div>
                                </div>
                                <div class="p-4 rounded-lg bg-slate-100 flex flex-col justify-between">
                                    <h4 class="font-bold text-lg mb-4">ğŸ“ˆ å…³é”®æŒ‡æ ‡</h4>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="font-medium flex justify-between">æ°®æ°§åŒ–ç‰© (NOx) <span class="text-sm text-gray-500">ç›®æ ‡: &lt;50</span></label>
                                            <div class="w-full bg-slate-200 rounded-full h-4"><div id="nox-meter-fill" class="bg-red-500 h-4 rounded-full transition-all duration-300"></div></div>
                                        </div>
                                        <div>
                                            <label class="font-medium flex justify-between">ä¸€æ°§åŒ–ç¢³ (CO) <span class="text-sm text-gray-500">ç›®æ ‡: &lt;40</span></label>
                                            <div class="w-full bg-slate-200 rounded-full h-4"><div id="co-meter-fill" class="bg-amber-500 h-4 rounded-full transition-all duration-300"></div></div>
                                        </div>
                                        <div>
                                            <label class="font-medium flex justify-between">é”…ç‚‰çƒ­æ•ˆç‡ <span class="text-sm text-gray-500">ç›®æ ‡: &gt;93%</span></label>
                                            <div class="text-right"><span id="efficiency-value" class="text-2xl font-bold text-green-600">92.50</span> %</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card p-6 mt-6">
                    <h3 class="text-xl font-bold">ç‡ƒçƒ§åŒ–å­¦ä¸æ±¡æŸ“ç‰©ç”Ÿæˆæœºç†</h3>
                    <p class="text-slate-600 mb-4">é”…ç‚‰ä¼˜åŒ–çš„æ ¸å¿ƒåœ¨äºç†è§£å’Œæ§åˆ¶å¤æ‚çš„ç‡ƒçƒ§åŒ–å­¦è¿‡ç¨‹ã€‚ä¸»è¦æ±¡æŸ“ç‰©NOxå’ŒCOçš„ç”Ÿæˆä¸ç‡ƒçƒ§æ¡ä»¶ï¼ˆæ¸©åº¦ã€æ°§æµ“åº¦ï¼‰å¯†åˆ‡ç›¸å…³ã€‚</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-400">
                            <h4 class="font-bold text-red-800">æ°®æ°§åŒ–ç‰© (NOx) çš„ç”Ÿæˆ</h4>
                            <p class="text-sm mt-2">NOxä¸»è¦åœ¨é«˜æ¸©å¯Œæ°§æ¡ä»¶ä¸‹ç”Ÿæˆï¼Œä¸»è¦æ¥æºæœ‰ä¸‰ç§ï¼š</p>
                            <ul class="list-disc list-inside text-sm mt-2 space-y-1">
                                <li><strong>çƒ­åŠ›å‹NOx</strong>: ç©ºæ°”ä¸­çš„$N_2$åœ¨é«˜æ¸©ï¼ˆ>1300Â°Cï¼‰ä¸‹è¢«æ°§åŒ–ã€‚$N_2 + O_2 \leftrightarrow 2NO$ã€‚è¿™æ˜¯NOxæœ€ä¸»è¦çš„æ¥æºã€‚</li>
                                <li><strong>ç‡ƒæ–™å‹NOx</strong>: ç…¤ä¸­çš„æ°®åŒ–åˆç‰©åœ¨ç‡ƒçƒ§è¿‡ç¨‹ä¸­æ°§åŒ–ç”Ÿæˆã€‚</li>
                                <li><strong>ç¬æ—¶å‹NOx</strong>: ç‡ƒæ–™åœ¨å¯Œç‡ƒåŒºè£‚è§£çš„ç¢³æ°¢è‡ªç”±åŸºä¸ç©ºæ°”ä¸­$N_2$ååº”ç”Ÿæˆã€‚</li>
                            </ul>
                            <p class="text-sm mt-2"><b>æ§åˆ¶ç­–ç•¥</b>ï¼šé™ä½ç‡ƒçƒ§åŒºå³°å€¼æ¸©åº¦å’Œæ°§æµ“åº¦ï¼Œä¾‹å¦‚é‡‡ç”¨ç©ºæ°”åˆ†çº§ç‡ƒçƒ§ï¼ˆOFAæŠ€æœ¯ï¼‰ã€‚</p>
                        </div>
                        <div class="p-4 bg-amber-50 rounded-lg border-l-4 border-amber-400">
                            <h4 class="font-bold text-amber-800">ä¸€æ°§åŒ–ç¢³ (CO) çš„ç”Ÿæˆ</h4>
                            <p class="text-sm mt-2">COæ˜¯ç‡ƒæ–™ä¸å®Œå…¨ç‡ƒçƒ§çš„äº§ç‰©ã€‚å½“æ°§æ°”ä¾›åº”ä¸è¶³æˆ–ç‡ƒçƒ§æ¸©åº¦è¿‡ä½æ—¶ï¼Œç¢³æ— æ³•å®Œå…¨æ°§åŒ–ä¸º$CO_2$ã€‚</p>
                            <p class="text-sm mt-2">$2C + O_2 \rightarrow 2CO$</p>
                            <p class="text-sm mt-2">COä¸ä»…æ˜¯æ±¡æŸ“ç‰©ï¼Œä¹Ÿä»£è¡¨äº†åŒ–å­¦èƒ½çš„æµªè´¹ï¼Œä¼šç›´æ¥é™ä½é”…ç‚‰çš„çƒ­æ•ˆç‡ã€‚</p>
                            <p class="text-sm mt-2"><b>æ§åˆ¶ç­–ç•¥</b>ï¼šä¿è¯å……è¶³çš„æ°§æ°”å’Œè¶³å¤Ÿé«˜çš„ç‡ƒçƒ§æ¸©åº¦ï¼Œä½†è¿™åˆä¸æ§åˆ¶NOxçš„ç­–ç•¥ç›¸çŸ›ç›¾ï¼Œå½¢æˆäº†æ ¸å¿ƒçš„ä¼˜åŒ–éš¾é¢˜ã€‚</p>
                        </div>
                    </div>
                </div>
                <div class="card p-6 mt-6">
                    <h3 class="text-xl font-bold">æ ¸å¿ƒçŸ›ç›¾ï¼šå¸•ç´¯æ‰˜æœ€ä¼˜å‰æ²¿</h3>
                    <p class="text-slate-600 mb-6">é”…ç‚‰ä¼˜åŒ–çš„æœ¬è´¨æ˜¯åœ¨å¤šä¸ªå†²çªç›®æ ‡ï¼ˆå¦‚é«˜æ•ˆç‡ vs ä½æ’æ”¾ï¼‰ä¹‹é—´å¯»æ‰¾æœ€ä½³å¹³è¡¡ç‚¹ã€‚åœ¨å¤šç›®æ ‡ä¼˜åŒ–ä¸­ï¼Œè¿™ä¸ªæœ€ä½³å¹³è¡¡ç‚¹çš„é›†åˆè¢«ç§°ä¸ºâ€œå¸•ç´¯æ‰˜æœ€ä¼˜å‰æ²¿â€ã€‚ä¸‹å›¾å±•ç¤ºäº†çƒ­æ•ˆç‡ä¸NOxæ’æ”¾ä¹‹é—´çš„å…³ç³»ï¼Œè¯·å°è¯•é€šè¿‡è°ƒèŠ‚æ§åˆ¶å˜é‡ï¼Œè®©æ‚¨çš„â€œå½“å‰å·¥ä½œç‚¹â€å°½å¯èƒ½åœ°æ¥è¿‘å·¦ä¸Šæ–¹çš„â€œå¸•ç´¯æ‰˜å‰æ²¿â€è™šçº¿ã€‚</p>
                    <div class="p-4 bg-slate-50 rounded-lg">
                        <canvas id="pareto-chart" height="120"></canvas>
                    </div>
                </div>
            </section>

            <section id="chapter2" class="content-section">
                <h2>ç¬¬2ç« : å¼ºåŒ–å­¦ä¹ ä¸–ç•Œè§‚</h2>
                <p class="text-lg text-slate-600 mb-6">æœ¬ç« å°†é€šè¿‡ä¸€ä¸ªå…¨æ–°çš„äº¤äº’å¼æ¨¡æ‹Ÿå™¨ï¼Œä¸ºæ‚¨æ­ç¤ºé©±åŠ¨æ‰€æœ‰ä»·å€¼å­¦ä¹ ç®—æ³•çš„å¿ƒè„â€”â€”è´å°”æ›¼æ–¹ç¨‹ã€‚æ‚¨å°†äº²æ‰‹è§¦å‘ä»·å€¼çš„è¿­ä»£ï¼Œè§è¯ä¸€ä¸ªæ™ºèƒ½ä½“å¦‚ä½•ä»é›¶å¼€å§‹â€œç†è§£â€å®ƒçš„ä¸–ç•Œã€‚</p>
                <div class="card p-6 mb-6">
                     <h3 class="text-xl font-bold">2.1 â€œæ™ºèƒ½ä½“-ç¯å¢ƒâ€å¾ªç¯ä¸MDP</h3>
                     <p class="text-slate-600 mb-4">æ‰€æœ‰å¼ºåŒ–å­¦ä¹ é—®é¢˜éƒ½å¯ä»¥æŠ½è±¡ä¸ºâ€œæ™ºèƒ½ä½“ï¼ˆAgentï¼‰â€ä¸â€œç¯å¢ƒï¼ˆEnvironmentï¼‰â€çš„æŒç»­äº’åŠ¨ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨æ•°å­¦ä¸Šè¢«å»ºæ¨¡ä¸º**é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ (Markov Decision Process, MDP)**ï¼Œç”±äº”å…ƒç»„ $(S, A, P, R, \gamma)$ å®šä¹‰ã€‚</p>
                </div>
                <div class="card p-6">
                    <h3 class="text-xl font-bold">2.2 äº¤äº’å¼è´å°”æ›¼ä»·å€¼è¿­ä»£</h3>
                    <p class="text-slate-600 mb-4">ä¸‹é¢çš„ç½‘æ ¼ä¸–ç•Œä»£è¡¨ä¸€ä¸ªç®€åŒ–ç¯å¢ƒã€‚æ™ºèƒ½ä½“çš„ç›®æ ‡æ˜¯ä»èµ·ç‚¹(S)åˆ°è¾¾ç»ˆç‚¹(ğŸ†)ï¼ŒåŒæ—¶é¿å¼€å±é™©(â˜ ï¸)ã€‚æ¯ä¸ªæ ¼å­çš„æ•°å­—ä»£è¡¨å…¶å½“å‰çš„çŠ¶æ€ä»·å€¼ $V(s)$ã€‚è¯·ç‚¹å‡»â€œè¿­ä»£ä¸€æ­¥â€æŒ‰é’®ï¼Œè§‚å¯Ÿä»·å€¼æ˜¯å¦‚ä½•æ ¹æ®è´å°”æ›¼æ–¹ç¨‹ $V(s) \leftarrow R(s) + \gamma \max_{a} V(s')$ è¿›è¡Œæ›´æ–°å’Œä¼ æ’­çš„ã€‚éšç€è¿­ä»£æ¬¡æ•°å¢åŠ ï¼Œæ™ºèƒ½ä½“çš„æœ€ä¼˜ç­–ç•¥ï¼ˆç®­å¤´ï¼‰å°†è‡ªç„¶æµ®ç°ã€‚</p>
                    <div class="flex flex-col md:flex-row gap-6 items-center">
                        <div class="flex-shrink-0">
                            <canvas id="bellman-canvas" width="400" height="400" class="border rounded-lg bg-white"></canvas>
                        </div>
                        <div class="space-y-4">
                            <button id="iterate-bellman-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors">è¿­ä»£ä¸€æ­¥ (Step)</button>
                            <button id="reset-bellman-btn" class="w-full bg-slate-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-600 transition-colors">é‡ç½® (Reset)</button>
                            <div class="text-sm p-4 bg-slate-50 rounded-lg">
                                <p><strong>è¿­ä»£æ¬¡æ•°:</strong> <span id="bellman-iteration-count">0</span></p>
                                <p><strong>æŠ˜æ‰£å› å­ $\gamma$:</strong> 0.9</p>
                                <p><strong>å¥–åŠ±:</strong> ğŸ†: +1, â˜ ï¸: -1, å…¶ä»–: 0</p>
                            </div>
                            <div id="bellman-update-info" class="text-sm text-center font-mono h-8"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="chapter3" class="content-section">
                <h2>ç¬¬3ç« : æ¼”å‘˜-è¯„è®ºå®¶æ¶æ„</h2>
                <p class="text-lg text-slate-600 mb-6">ç°ä»£å¼ºåŒ–å­¦ä¹ ç®—æ³•å¤§å¤šé‡‡ç”¨æ¼”å‘˜-è¯„è®ºå®¶ï¼ˆActor-Criticï¼‰æ¶æ„ã€‚å®ƒå·§å¦™åœ°ç»“åˆäº†ç­–ç•¥å­¦ä¹ å’Œä»·å€¼å­¦ä¹ çš„ä¼˜ç‚¹ï¼Œæ˜¯ç†è§£PPOã€SACç­‰é«˜çº§ç®—æ³•çš„åŸºç¡€ã€‚æœ¬æ¬¡æ›´æ–°å°†æ›´æ¸…æ™°åœ°å±•ç¤ºâ€œä¼˜åŠ¿å‡½æ•°â€åœ¨å…¶ä¸­çš„å…³é”®ä½œç”¨ã€‚</p>
                <div class="card p-6">
                    <h3 class="text-xl font-bold">åŠ¨æ€æ¼”ç¤ºï¼šä¿¡æ¯ä¸ä¼˜åŠ¿å‡½æ•°æµåŠ¨è¿‡ç¨‹</h3>
                    <p class="text-slate-600 mb-4">ç‚¹å‡»æ’­æ”¾ï¼Œè§‚å¯Ÿä¿¡æ¯æµã€‚ç‰¹åˆ«æ³¨æ„ï¼Œå½“â€œè¯„è®ºå®¶â€å®Œæˆè¯„ä¼°åï¼Œå®ƒä¸ä»…ä¼šäº§ç”Ÿç”¨äºè‡ªèº«æ›´æ–°çš„TD-Errorï¼Œè¿˜ä¼šè®¡ç®—å‡º**ä¼˜åŠ¿å‡½æ•° A(s,a)**ï¼Œè¿™ä¸ªä¿¡å·æ˜¯æŒ‡å¯¼â€œæ¼”å‘˜â€æ›´æ–°æ–¹å‘çš„æ ¸å¿ƒä¾æ®ã€‚</p>
                    <div class="text-center mb-4"><button id="play-ac-viz" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">â–¶ï¸ æ’­æ”¾æµç¨‹</button></div>
                    <div id="ac-viz-explanation" class="text-center font-semibold text-slate-700 h-10 mb-2"></div>
                    <svg id="ac-viz-svg" viewBox="0 0 400 300" class="w-full"></svg>
                </div>
            </section>

            <section id="chapter4" class="content-section">
                <h2>ç¬¬4ç« : PPOç®—æ³•è¯¦è§£</h2>
                <p class="text-lg text-slate-600 mb-6">è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–(PPO)ä»¥å…¶å“è¶Šçš„ç¨³å®šæ€§è‘—ç§°ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ä¸€ä¸ªå·§å¦™çš„â€œè£å‰ªâ€æœºåˆ¶ï¼Œå°†ç­–ç•¥æ›´æ–°é™åˆ¶åœ¨ä¸€ä¸ªå¯ä¿¡çš„â€œä¿¡ä»»åŸŸâ€å†…ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥äº²æ‰‹è°ƒèŠ‚è¿™ä¸ªä¿¡ä»»åŸŸçš„å¤§å°ã€‚</p>
                <div class="card p-6">
                    <h3 class="text-xl font-bold">äº¤äº’å¼ç†è§£ï¼šå¯è°ƒèŠ‚çš„ä¿¡ä»»åŸŸè£å‰ª</h3>
                    <p class="text-slate-600 mb-4">è¯·æ‹–åŠ¨ä¸‹æ–¹çš„ $\epsilon$ æ»‘å—æ¥è°ƒæ•´ä¿¡ä»»åŸŸçš„å¤§å°ï¼Œå¹¶ç‚¹å‡»æŒ‰é’®åˆ‡æ¢â€œå¥½/ååŠ¨ä½œâ€æƒ…æ™¯ï¼Œè§‚å¯Ÿç›®æ ‡å‡½æ•°ï¼ˆè“è‰²å®çº¿ï¼‰å¦‚ä½•è¢«è£å‰ªè¾¹ç•Œï¼ˆçº¢è‰²è™šçº¿ï¼‰æ‰€é™åˆ¶ã€‚</p>
                    <div class="flex justify-center items-center gap-6 mb-4">
                        <button id="ppo-toggle-advantage" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">åˆ‡æ¢åˆ° "ååŠ¨ä½œ" ($\hat{A}_t < 0$)</button>
                        <div class="w-64">
                             <label for="epsilon-slider" class="font-medium flex justify-between">è£å‰ªèŒƒå›´ $\epsilon$: <span id="epsilon-value">0.2</span></label>
                             <input type="range" id="epsilon-slider" min="0.05" max="0.5" step="0.01" value="0.2" class="slider w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>
                    <canvas id="ppo-canvas" class="w-full h-64 bg-slate-100 border rounded-lg"></canvas>
                    <p id="ppo-explanation" class="text-center mt-2 text-slate-600 font-medium"></p>
                </div>
                 <div class="card p-6 mt-6">
                    <h3 class="text-xl font-bold">PPOæ ¸å¿ƒç»„ä»¶æ·±åº¦è§£æ</h3>
                    <div class="space-y-4">
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <h4 class="font-bold text-blue-800">è£å‰ªä»£ç†ç›®æ ‡ (Clipped Surrogate Objective)</h4>
                             <p class="text-sm mt-2">PPOçš„æ ¸å¿ƒåˆ›æ–°ã€‚é€šè¿‡æ¦‚ç‡æ¯”$r_t(\theta)$å’Œä¼˜åŠ¿å‡½æ•°$\hat{A}_t$æ¥æ„å»ºç›®æ ‡ï¼Œå¹¶ç”¨clipå‡½æ•°é™åˆ¶æ›´æ–°å¹…åº¦ï¼Œç¡®ä¿å­¦ä¹ è¿‡ç¨‹çš„ç¨³å®šã€‚</p>
                             <div class="p-2 my-2 bg-slate-100 rounded text-center">$$L^{CLIP}(\theta) = \mathbb{E}_t \left[ \min\left(r_t(\theta)\hat{A}_t, \text{clip}(r_t(\theta), 1-\epsilon, 1+\epsilon)\hat{A}_t\right) \right]$$</div>
                        </div>
                        <div class="p-4 bg-green-50 rounded-lg">
                            <h4 class="font-bold text-green-800">å¹¿ä¹‰ä¼˜åŠ¿ä¼°è®¡ (Generalized Advantage Estimation, GAE)</h4>
                            <p class="text-sm mt-2">PPOé€šå¸¸ä½¿ç”¨GAEæ¥è®¡ç®—ä¼˜åŠ¿å‡½æ•°$\hat{A}_t$ï¼Œå®ƒé€šè¿‡è¶…å‚æ•°$\lambda$åœ¨æ— åï¼ˆé«˜æ–¹å·®ï¼‰çš„è’™ç‰¹å¡æ´›ä¼°è®¡å’Œæœ‰åï¼ˆä½æ–¹å·®ï¼‰çš„TD(0)ä¼°è®¡ä¹‹é—´è¿›è¡Œæƒè¡¡ï¼Œä»¥è·å¾—æ›´ç¨³å®šå’Œå‡†ç¡®çš„ä¼˜åŠ¿ä¿¡å·ã€‚</p>
                            <div class="p-2 my-2 bg-slate-100 rounded text-center">$$\hat{A}_t^{GAE} = \sum_{l=0}^{\infty} (\gamma\lambda)^l \delta_{t+l} \quad \text{å…¶ä¸­ } \delta_t = r_t + \gamma V(s_{t+1}) - V(s_t)$$</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="chapter5" class="content-section">
                <h2>ç¬¬5ç« : SACç®—æ³•è¯¦è§£</h2>
                <p class="text-lg text-slate-600 mb-6">è½¯æ¼”å‘˜-è¯„è®ºå®¶(SAC)é€šè¿‡â€œæœ€å¤§ç†µâ€æ¡†æ¶ï¼Œåœ¨æœ€å¤§åŒ–å¥–åŠ±çš„åŒæ—¶é¼“åŠ±æ¢ç´¢ã€‚æœ¬æ¬¡æ›´æ–°å°†ç­–ç•¥åˆ†å¸ƒä¸å¥–åŠ±å‡½æ•°å åŠ æ˜¾ç¤ºï¼Œè®©æ‚¨æ›´ç›´è§‚åœ°ç†è§£æ¢ç´¢ä¸åˆ©ç”¨çš„æƒè¡¡ã€‚</p>
                <div class="card p-6">
                    <h3 class="text-xl font-bold">äº¤äº’å¼ç†è§£ï¼šæ¢ç´¢ä¸åˆ©ç”¨çš„æƒè¡¡</h3>
                    <p class="text-slate-600 mb-4">ä¸‹å›¾ä¸­ï¼Œç°è‰²æ›²çº¿ä»£è¡¨ä¸åŒåŠ¨ä½œçš„æ½œåœ¨å¥–åŠ±ï¼ˆå¥–åŠ±åœ°å½¢ï¼‰ï¼Œè“è‰²åŒºåŸŸæ˜¯æ™ºèƒ½ä½“çš„åŠ¨ä½œç­–ç•¥åˆ†å¸ƒã€‚è¯·è°ƒæ•´æ¸©åº¦å‚æ•° $\alpha$ï¼Œè§‚å¯Ÿç­–ç•¥æ˜¯å¦‚ä½•åœ¨â€œæ¢ç´¢æ›´å¹¿é˜”çš„å¥–åŠ±åœ°å½¢â€å’Œâ€œèšç„¦äºæœ€é«˜å¥–åŠ±çš„å±±å³°â€ä¹‹é—´å˜åŒ–çš„ã€‚</p>
                    <canvas id="sac-canvas" class="w-full h-64 bg-slate-100 border rounded-lg"></canvas>
                    <div class="mt-4">
                        <label for="alpha-slider" class="font-medium flex justify-between">æ¸©åº¦ $\alpha$: <span id="alpha-value">0.20</span></label>
                        <input type="range" id="alpha-slider" min="0.01" max="1.0" step="0.01" value="0.2" class="slider w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                     <p id="sac-explanation" class="text-center mt-2 text-slate-600 font-medium">å½“å‰ $\alpha$ å€¼é€‚ä¸­ï¼Œåœ¨â€œæ¢ç´¢â€ä¸â€œåˆ©ç”¨â€ä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p>
                </div>
                <div class="card p-6 mt-6">
                    <h3 class="text-xl font-bold">SACæ ¸å¿ƒç»„ä»¶æ·±åº¦è§£æ</h3>
                    <div class="space-y-4">
                        <div class="p-4 bg-purple-50 rounded-lg">
                            <h4 class="font-bold text-purple-800">åŒQç½‘ç»œ (Twin Q-Critics) ä¸ç›®æ ‡ç½‘ç»œ</h4>
                             <p class="text-sm mt-2">ä¸ºç¼“è§£ä»·å€¼å‡½æ•°è¿‡é«˜ä¼°è®¡çš„é—®é¢˜ï¼ŒSACä½¿ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„Qç½‘ç»œ($Q_{\theta_1}, Q_{\theta_2}$)ï¼Œå¹¶åœ¨è®¡ç®—ç›®æ ‡ä»·å€¼æ—¶å–ä¸¤è€…çš„è¾ƒå°å€¼ã€‚åŒæ—¶ï¼Œä½¿ç”¨ç›®æ ‡ç½‘ç»œ(Target Networks)æ¥ç¨³å®šè®­ç»ƒè¿‡ç¨‹ã€‚</p>
                             <div class="p-2 my-2 bg-slate-100 rounded text-center">$$y = r + \gamma ( \min_{i=1,2} Q_{\theta_i'}(s', a') - \alpha \log \pi(a'|s') )$$</div>
                        </div>
                        <div class="p-4 bg-teal-50 rounded-lg">
                            <h4 class="font-bold text-teal-800">å¸¦å‹ç¼©å‡½æ•°çš„éšæœºç­–ç•¥ä¸ç†µæ­£åˆ™åŒ–</h4>
                            <p class="text-sm mt-2">SACçš„ç­–ç•¥(æ¼”å‘˜)é€šå¸¸è¾“å‡ºä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒï¼Œå¹¶é€šè¿‡`tanh`å‡½æ•°å°†åŠ¨ä½œå‹ç¼©åˆ°æœ‰é™åŒºé—´ã€‚è¿™è¦æ±‚åœ¨è®¡ç®—ç­–ç•¥æŸå¤±æ—¶å¯¹æ¦‚ç‡è¿›è¡Œç›¸åº”è°ƒæ•´ã€‚æœ€å¤§åŒ–ç­–ç•¥ç†µæ˜¯å…¶æ ¸å¿ƒç›®æ ‡ï¼Œç”±æ¸©åº¦å‚æ•°$\alpha$æ§åˆ¶ã€‚</p>
                             <div class="p-2 my-2 bg-slate-100 rounded text-center">$$J_\pi(\phi) = \mathbb{E}_{s_t \sim D} \left[ \mathbb{E}_{a_t \sim \pi_\phi} [\alpha \log(\pi_\phi(a_t|s_t)) - Q_\theta(s_t, a_t)] \right]$$</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="chapter6" class="content-section">
                 <h2>ç¬¬6ç« : CMDPæ„å»ºå®éªŒå®¤</h2>
                <p class="text-lg text-slate-600 mb-6">æ¬¢è¿æ¥åˆ°é¡¹ç›®çš„æŠ€æœ¯æ ¸å¿ƒã€‚å°†ä¸€ä¸ªå¤æ‚çš„å·¥ä¸šé—®é¢˜è½¬åŒ–ä¸ºæœºå™¨å¯ä»¥ç†è§£çš„æ•°å­¦æ¨¡å‹â€”â€”çº¦æŸé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼ˆCMDPï¼‰ï¼Œæ˜¯å†³å®šé¡¹ç›®æˆè´¥æœ€å…³é”®çš„ä¸€æ­¥ã€‚åœ¨è¿™ä¸ªå®éªŒå®¤é‡Œï¼Œè¯·æ‚¨æ‰®æ¼”AIå·¥ç¨‹å¸ˆï¼Œäº²æ‰‹æ„å»ºè¿™ä¸ªæ¨¡å‹ã€‚</p>
                <div class="card p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div id="cmdp-builder-panel">
                            <h3 class="text-xl font-bold">1. æ„å»ºæ‚¨çš„CMDPæ¨¡å‹</h3>
                            <p class="text-slate-500 mb-6">è¯·ä»ä¸‹æ–¹å‹¾é€‰æ‚¨å¸Œæœ›çº³å…¥æ¨¡å‹çš„å˜é‡ã€‚æ‚¨çš„æ¯ä¸€æ¬¡é€‰æ‹©ï¼Œéƒ½ä¼šåœ¨å³ä¾§çš„â€œå®æ—¶é¢„è§ˆâ€ä¸­æ¿€æ´»å¯¹åº”çš„æ¨¡å—ã€‚</p>
                            <div class="mb-4"><h4 class="font-bold text-lg mb-2 text-indigo-700">S - é€‰æ‹©çŠ¶æ€ (State)</h4><div class="space-y-2 text-sm p-4 bg-slate-50 rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-nox-meter"> æ°®æ°§åŒ–ç‰©(NOx)æµ“åº¦</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-co-meter"> ä¸€æ°§åŒ–ç¢³(CO)æµ“åº¦</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-efficiency-meter"> é”…ç‚‰çƒ­æ•ˆç‡</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-temp-meter"> å…³é”®åŒºåŸŸå£æ¸©</label></div></div>
                            <div class="mb-4"><h4 class="font-bold text-lg mb-2 text-green-700">A - é€‰æ‹©åŠ¨ä½œ (Action)</h4><div class="space-y-2 text-sm p-4 bg-slate-50 rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-air-slider"> æ€»é£é‡è°ƒèŠ‚</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-tilt-slider"> ç‡ƒçƒ§å™¨æ‘†è§’è°ƒèŠ‚</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-ofa-slider"> ç‡ƒå°½é£(OFA)å æ¯”è°ƒèŠ‚</label></div></div>
                            <div class="mb-4"><h4 class="font-bold text-lg mb-2 text-amber-600">R - å®šä¹‰å¥–åŠ± (Reward)</h4><div class="space-y-2 text-sm p-4 bg-slate-50 rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-efficiency-meter" data-type="reward"> å¥–åŠ±ï¼šæå‡çƒ­æ•ˆç‡</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-nox-meter" data-type="reward"> å¥–åŠ±ï¼šé™ä½NOxæ’æ”¾</label></div></div>
                            <div class="mb-4"><h4 class="font-bold text-lg mb-2 text-red-700">C - å®šä¹‰æˆæœ¬ (Cost/Constraint)</h4><div class="space-y-2 text-sm p-4 bg-slate-50 rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-temp-meter" data-type="cost"> çº¦æŸï¼šå£æ¸©ä¸è¶…è¿‡å®‰å…¨é˜ˆå€¼</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-co-meter" data-type="cost"> çº¦æŸï¼šCOæµ“åº¦ä¸è¶…è¿‡é™åˆ¶</label></div></div>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold">2. å®æ—¶é¢„è§ˆä¸äº¤äº’</h3>
                            <p class="text-slate-500 mb-6">è¿™é‡Œæ˜¯æ‚¨æ„å»ºçš„è™šæ‹Ÿé”…ç‚‰ã€‚æ‰€æœ‰æ¿€æ´»çš„æ¨¡å—éƒ½å¯ä»¥è¿›è¡Œäº¤äº’ã€‚</p>
                            <div class="p-4 rounded-lg bg-slate-700 flex flex-col items-center justify-start min-h-[500px]">
                                <h4 class="font-bold text-lg mb-2 text-white">ğŸ”¥ è™šæ‹Ÿé”…ç‚‰å®æ—¶è§†å›¾</h4>
                                <div id="boiler-visual-container-ch6" class="w-48 h-64 bg-slate-800 rounded-t-lg relative overflow-hidden mt-4"><div id="flame-visual-ch6" class="flame-visual"></div></div>
                                <div id="dashboard-ch6" class="w-full mt-6 space-y-4 p-2">
                                    <div id="component-nox-meter" class="preview-component hidden"><label class="font-medium text-white text-sm">æ°®æ°§åŒ–ç‰© (NOx)</label><div class="w-full bg-slate-500 rounded-full h-3"><div id="nox-meter-fill-ch6" class="bg-red-500 h-3 rounded-full"></div></div></div>
                                    <div id="component-co-meter" class="preview-component hidden"><label class="font-medium text-white text-sm">ä¸€æ°§åŒ–ç¢³ (CO)</label><div class="w-full bg-slate-500 rounded-full h-3"><div id="co-meter-fill-ch6" class="bg-amber-500 h-3 rounded-full"></div></div></div>
                                    <div id="component-temp-meter" class="preview-component hidden"><label class="font-medium text-white text-sm">å…³é”®åŒºåŸŸå£æ¸©</label><div class="w-full bg-slate-500 rounded-full h-3"><div id="temp-meter-fill-ch6" class="bg-orange-500 h-3 rounded-full"></div></div></div>
                                    <div id="component-efficiency-meter" class="preview-component hidden"><label class="font-medium text-white text-sm">é”…ç‚‰çƒ­æ•ˆç‡</label><div class="text-right"><span id="efficiency-value-ch6" class="text-xl font-bold text-green-400">92.50</span> %</div></div>
                                </div>
                            </div>
                            <div id="controls-ch6" class="mt-4 p-4 bg-white rounded-lg space-y-4">
                                <div id="component-air-slider" class="preview-component hidden"><label for="air-slider-ch6" class="font-medium flex justify-between text-sm">æ€»é£é‡: <span id="air-value-ch6">75</span>%</label><input type="range" id="air-slider-ch6" min="50" max="100" value="75" class="slider w-full"></div>
                                <div id="component-tilt-slider" class="preview-component hidden"><label for="tilt-slider-ch6" class="font-medium flex justify-between text-sm">ç‡ƒçƒ§å™¨æ‘†è§’: <span id="tilt-value-ch6">0</span>Â°</label><input type="range" id="tilt-slider-ch6" min="-15" max="15" value="0" class="slider w-full"></div>
                                <div id="component-ofa-slider" class="preview-component hidden"><label for="ofa-slider-ch6" class="font-medium flex justify-between text-sm">ç‡ƒå°½é£(OFA)å æ¯”: <span id="ofa-value-ch6">30</span>%</label><input type="range" id="ofa-slider-ch6" min="10" max="50" value="30" class="slider w-full"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 pt-4 border-t"><h3 class="text-xl font-bold">3. æ‚¨ç”Ÿæˆçš„CMDPæ¨¡å‹</h3>
                         <div id="cmdp-summary-ch6" class="text-slate-600 text-sm grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-indigo-50 rounded-lg mt-4">
                             <div><strong>çŠ¶æ€:</strong><ul id="summary-State-ch6" class="list-disc list-inside"></ul></div>
                             <div><strong>åŠ¨ä½œ:</strong><ul id="summary-Action-ch6" class="list-disc list-inside"></ul></div>
                             <div><strong>å¥–åŠ±:</strong><ul id="summary-Reward-ch6" class="list-disc list-inside"></ul></div>
                             <div><strong>æˆæœ¬/çº¦æŸ:</strong><ul id="summary-Cost-ch6" class="list-disc list-inside"></ul></div>
                         </div>
                    </div>
                </div>
            </section>
            <section id="chapter7" class="content-section">
                <h2>ç¬¬7ç« : æ„å»ºæ•°å­—å­ªç”Ÿ</h2>
                <p class="text-lg text-slate-600 mb-6">å¼ºåŒ–å­¦ä¹ éœ€è¦åœ¨ä¸€ä¸ªç¯å¢ƒä¸­è¿›è¡Œæµ·é‡çš„è¯•é”™æ¢ç´¢ï¼Œè¿™åœ¨çœŸå®çš„ã€æ˜‚è´µçš„ã€ä¸”æœ‰å®‰å…¨é£é™©çš„å·¥ä¸šè®¾å¤‡ä¸Šæ˜¯ä¸å¯è¡Œçš„ã€‚å› æ­¤ï¼Œæ„å»ºä¸€ä¸ªé«˜ä¿çœŸçš„ä»¿çœŸç¯å¢ƒâ€”â€”å³â€œæ•°å­—å­ªç”Ÿâ€â€”â€”æ˜¯é¡¹ç›®æˆåŠŸçš„å…ˆå†³æ¡ä»¶ã€‚</p>
                <div class="card p-6 mb-6">
                    <h3 class="text-xl font-bold">ä»€ä¹ˆæ˜¯æ•°å­—å­ªç”Ÿï¼Ÿ</h3>
                    <p>æ•°å­—å­ªç”Ÿæ˜¯çœŸå®ç‰©ç†ç³»ç»Ÿçš„è™šæ‹Ÿå‰¯æœ¬ã€‚å®ƒåˆ©ç”¨å†å²è¿è¡Œæ•°æ®ï¼Œé€šè¿‡æœºå™¨å­¦ä¹ ï¼ˆå¦‚ç¥ç»ç½‘ç»œï¼‰æˆ–æœºç†å»ºæ¨¡ï¼Œå­¦ä¹ å¹¶æ¨¡æ‹ŸçœŸå®é”…ç‚‰çš„åŠ¨æ€å“åº”ã€‚å½“æˆ‘ä»¬åœ¨è™šæ‹Ÿç¯å¢ƒä¸­â€œè°ƒèŠ‚é£é—¨â€æ—¶ï¼Œæ•°å­—å­ªç”Ÿä¼šé¢„æµ‹å‡ºçœŸå®çš„é”…ç‚‰å°†ä¼šå‘ç”Ÿçš„æ¸©åº¦ã€å‹åŠ›ã€æ±¡æŸ“ç‰©ç­‰ä¸€ç³»åˆ—å˜åŒ–ã€‚</p>
                </div>
                <div class="card p-6 mb-6">
                    <h3 class="text-xl font-bold">â€œä»¿çœŸåˆ°ç°å®â€çš„é¸¿æ²Ÿ (Sim-to-Real Gap)</h3>
                    <p class="mb-4">ä»»ä½•ä»¿çœŸéƒ½æ— æ³•100%å¤åˆ»ç°å®ã€‚æ¨¡å‹ä¸ç°å®ä¹‹é—´çš„å·®å¼‚è¢«ç§°ä¸ºSim-to-Real Gapã€‚äº§ç”Ÿè¿™ä¸ªé¸¿æ²Ÿçš„åŸå› åŒ…æ‹¬ï¼š</p>
                    <ul class="list-disc list-inside space-y-1">
                        <li><strong>æœªå»ºæ¨¡çš„åŠ¨æ€</strong>ï¼šæ¯”å¦‚ç®¡é“ç§¯ç°ã€è®¾å¤‡ç£¨æŸç­‰ç¼“æ…¢å˜åŒ–çš„è¿‡ç¨‹ã€‚</li>
                        <li><strong>ä¼ æ„Ÿå™¨å™ªå£°</strong>ï¼šçœŸå®ä¼ æ„Ÿå™¨çš„è¯»æ•°æ€»æ˜¯æœ‰æ³¢åŠ¨çš„ã€‚</li>
                        <li><strong>å¤–éƒ¨æ‰°åŠ¨</strong>ï¼šä¾‹å¦‚ç…¤ç‚­è´¨é‡çš„æ‰¹æ¬¡å·®å¼‚ã€ç¯å¢ƒæ¸©æ¹¿åº¦çš„å˜åŒ–ç­‰ã€‚</li>
                    </ul>
                    <p class="mt-4">ä¸€ä¸ªåœ¨â€œå®Œç¾â€ä»¿çœŸç¯å¢ƒä¸­è®­ç»ƒå‡ºçš„ç­–ç•¥ï¼Œåˆ°ç°å®ä¸­å¾ˆå¯èƒ½ä¼šâ€œæ°´åœŸä¸æœâ€ã€‚å› æ­¤ï¼Œç¼©å°è¿™ä¸ªé¸¿æ²Ÿè‡³å…³é‡è¦ã€‚å¸¸ç”¨çš„ä¸€ç§æŠ€æœ¯æ˜¯**é¢†åŸŸéšæœºåŒ– (Domain Randomization)**ï¼Œå³åœ¨è®­ç»ƒæ—¶ï¼Œæ•…æ„ç»™ä»¿çœŸç¯å¢ƒå¢åŠ å„ç§éšæœºå™ªå£°ï¼ˆå¦‚æ¨¡æ‹Ÿä¼ æ„Ÿå™¨è¯¯å·®ã€éšæœºåŒ–ç…¤ç‚­çƒ­å€¼ï¼‰ï¼Œè®©AIæå‰é€‚åº”ä¸€ä¸ªâ€œä¸å®Œç¾â€çš„ä¸–ç•Œï¼Œä»è€Œå¢å¼ºå…¶åœ¨çœŸå®ç¯å¢ƒä¸­çš„é²æ£’æ€§ã€‚</p>
                </div>
                 <div class="card p-6">
                    <h3 class="text-xl font-bold">äº¤äº’æ¼”ç¤ºï¼šæ¨¡å‹è´¨é‡ä¸é²æ£’æ€§</h3>
                    <p class="text-slate-600 mb-4">æ‹–åŠ¨æ»‘å—æ¨¡æ‹Ÿæ¨¡å‹ä¸ç°å®çš„åŒ¹é…ç¨‹åº¦ã€‚é»‘è‰²å®çº¿ä»£è¡¨â€œçœŸå®ä¸–ç•Œâ€çš„æŸä¸ªå‚æ•°å˜åŒ–ï¼Œè“è‰²è™šçº¿ä»£è¡¨æ•°å­—å­ªç”Ÿæ¨¡å‹çš„é¢„æµ‹ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ˜¯é«˜è´¨é‡çš„æ¨¡å‹ï¼ˆ98%ï¼‰ï¼Œä¸çœŸå®ç³»ç»Ÿä¹‹é—´ä¹Ÿæ°¸è¿œå­˜åœ¨å¾®å°çš„å·®è·ï¼ˆGapï¼‰ã€‚</p>
                    <canvas id="sim-real-canvas" class="w-full h-64 bg-slate-100 border rounded-lg"></canvas>
                    <div><label for="model-quality-slider" class="font-medium flex justify-between">æ¨¡å‹-ç°å®åŒ¹é…åº¦: <span id="model-quality-value">50</span>%</label><input type="range" id="model-quality-slider" min="10" max="98" step="1" value="50" class="slider w-full h-2 bg-slate-200 rounded-lg"></div>
                </div>
            </section>
            <section id="chapter8" class="content-section">
                <h2>ç¬¬8ç« : è®­ç»ƒå®éªŒä¸è°ƒè¯•</h2>
                <p class="text-lg text-slate-600 mb-8">æ¬¢è¿æ¥åˆ°RLè®­ç»ƒå®éªŒå®¤ï¼ä¸ºäº†æ›´è´´åˆä¸»é¢˜ï¼Œæˆ‘ä»¬å°†ç»å…¸çš„â€œå¯»å®â€ä¾‹å­å‡çº§ä¸ºâ€œé”…ç‚‰çŠ¶æ€ç©ºé—´å¯»ä¼˜â€ã€‚æ™ºèƒ½ä½“çš„ç›®æ ‡æ˜¯åœ¨ç®€åŒ–çš„ï¼ˆæ¸©åº¦-å‹åŠ›ï¼‰çŠ¶æ€ç½‘æ ¼ä¸­ï¼Œä»â€œå†·æ€â€å‡ºå‘ï¼Œå°½å¿«åˆ°è¾¾â€œæœ€ä¼˜å·¥ä½œç‚¹â€ï¼ŒåŒæ—¶å¿…é¡»é¿å¼€â€œè¶…æ¸©/è¶…å‹â€çš„å±é™©åŒºåŸŸã€‚</p>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1 card p-6">
                        <h3 class="text-xl font-bold">å‚æ•°è°ƒèŠ‚</h3>
                        <div class="space-y-4">
                            <div><label for="gamma" class="font-medium flex justify-between">è¿œè§ç¨‹åº¦ ($\gamma$): <span id="gamma-value">0.9</span></label><input type="range" id="gamma" min="0.5" max="0.99" step="0.01" value="0.9" class="slider w-full"><p class="text-xs text-slate-500">å€¼è¶Šé«˜ï¼ŒAIè¶Šå…³å¿ƒé•¿æœŸå›æŠ¥ã€‚</p></div>
                            <div><label for="lr" class="font-medium flex justify-between">å­¦ä¹ ç‡ ($\alpha_{lr}$): <span id="lr-value">0.1</span></label><input type="range" id="lr" min="0.01" max="0.5" step="0.01" value="0.1" class="slider w-full"><p class="text-xs text-slate-500">å€¼è¶Šé«˜ï¼ŒAIå­¦ä¹ é€Ÿåº¦è¶Šå¿«ï¼Œä½†å¯èƒ½ä¸ç¨³å®šã€‚</p></div>
                            <div><label for="epsilon" class="font-medium flex justify-between">æ¢ç´¢ç‡ ($\epsilon$): <span id="epsilon-value">0.2</span></label><input type="range" id="epsilon" min="0.05" max="1.0" step="0.05" value="0.2" class="slider w-full"><p class="text-xs text-slate-500">å€¼è¶Šé«˜ï¼ŒAIè¶Šå€¾å‘äºæ¢ç´¢æœªçŸ¥ã€‚</p></div>
                        </div>
                        <button id="start-sim" class="mt-6 w-full bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700 transition-colors">å¼€å§‹ / é‡ç½®è®­ç»ƒ</button>
                    </div>
                    <div class="lg:col-span-2 card p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h3 class="text-xl font-bold">é”…ç‚‰çŠ¶æ€ç©ºé—´ (ç­–ç•¥å¯è§†åŒ–)</h3>
                                <canvas id="rl-canvas" class="w-full bg-slate-50 border rounded-lg aspect-square"></canvas>
                                 <div class="flex justify-around text-xs mt-2 flex-wrap"><span class="flex items-center"><div class="w-3 h-3 rounded-full bg-blue-500 mr-1"></div>æ™ºèƒ½ä½“</span><span class="flex items-center"><div class="w-3 h-3 rounded-full bg-green-200 mr-1"></div>ä¼˜è‰¯åŒºåŸŸ</span><span class="flex items-center"><div class="w-3 h-3 rounded-full bg-red-200 mr-1"></div>å±é™©åŒºåŸŸ</span></div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold">å­¦ä¹ æ›²çº¿ (å¹³å‡å¥–åŠ±)</h3>
                                <div class="w-full h-64 border rounded-lg p-2"><canvas id="rewardChart"></canvas></div>
                                <div class="mt-2 text-center text-sm"><p>å›åˆ (Episode): <span id="episode-counter">0</span></p><p>å¹³å‡å¥–åŠ± (Avg Reward): <span id="total-reward">0</span></p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section id="chapter9" class="content-section">
                <h2>ç¬¬9ç« : ä¸‰é˜¶æ®µå®‰å…¨éƒ¨ç½²</h2>
                <p class="text-lg text-slate-600 mb-6">å°†AIä»è™šæ‹Ÿä¸–ç•Œå®‰å…¨åœ°å¼•å…¥ç°å®å·¥å‚ï¼Œæ˜¯ä¸€ä¸ªæ¯”ç®—æ³•æœ¬èº«æ›´é‡è¦çš„å·¥ç¨‹æŒ‘æˆ˜ã€‚æˆ‘ä»¬é‡‡ç”¨ä¸‰é˜¶æ®µç­–ç•¥ï¼Œæ ¸å¿ƒæ˜¯å»ºç«‹ä¿¡ä»»ã€ç®¡ç†é£é™©ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤±ã€‚</p>
                <div class="flex flex-col lg:flex-row gap-6">
                    <div class="w-full lg:w-1/3 space-y-2">
                        <div id="step1" class="p-4 rounded-lg cursor-pointer deployment-step" onclick="selectStep(1)"><h4 class="font-bold text-lg">é˜¶æ®µä¸€ï¼šå»ºè®®æ¨¡å¼</h4><p class="text-sm">AIä½œä¸ºâ€œå½±å­é¡¾é—®â€ï¼Œé›¶é£é™©éªŒè¯æ€§èƒ½ã€‚</p></div>
                        <div id="step2" class="p-4 rounded-lg cursor-pointer deployment-step" onclick="selectStep(2)"><h4 class="font-bold text-lg">é˜¶æ®µäºŒï¼šç›‘ç£æ§åˆ¶</h4><p class="text-sm">AIè°ƒæ•´PIDè®¾å®šå€¼ï¼Œåˆ©ç”¨ç°æœ‰ç³»ç»Ÿä½œä¸ºå®‰å…¨ç½‘ã€‚</p></div>
                        <div id="step3" class="p-4 rounded-lg cursor-pointer deployment-step" onclick="selectStep(3)"><h4 class="font-bold text-lg">é˜¶æ®µä¸‰ï¼šç›´æ¥æ§åˆ¶</h4><p class="text-sm">AIç›´æ¥è¾“å‡ºæŒ‡ä»¤ï¼Œä½†é¡»é€šè¿‡æœ€ç»ˆâ€œå®‰å…¨å±‚â€è¿‡æ»¤ã€‚</p></div>
                    </div>
                    <div id="step-content" class="flex-1 card p-6 min-h-[300px]">
                        <!-- Content will be injected by JS -->
                    </div>
                </div>
            </section>
            <section id="chapter10" class="content-section">
                <h2>ç¬¬10ç« : æ€»ç»“ä¸æœªæ¥</h2>
                <p class="text-lg text-slate-600 mb-6">æˆ‘ä»¬ç³»ç»Ÿæ€§åœ°æ¢è®¨äº†ä»ç†è®ºåˆ°å®è·µçš„å®Œæ•´æ¡†æ¶ã€‚æˆåŠŸå®æ–½çš„å…³é”®åœ¨äºå°†å…ˆè¿›ç®—æ³•ä¸æ·±åšçš„é¢†åŸŸçŸ¥è¯†ç›¸ç»“åˆï¼Œå¹¶å§‹ç»ˆå°†å®‰å…¨ç½®äºé¦–ä½ã€‚</p>
                <div class="card p-6">
                    <h3 class="text-xl font-bold">æœªæ¥ç ”ç©¶æ–¹å‘</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="p-4 bg-slate-50 rounded-lg hover:shadow-md transition"><h4 class="font-bold text-lg">å¤šæ™ºèƒ½ä½“ (MARL)</h4><p class="text-sm mt-2">å°†æ¯ä¸ªç‡ƒçƒ§å™¨æˆ–é£é—¨ç»„è§†ä¸ºç‹¬ç«‹æ™ºèƒ½ä½“ï¼Œå­¦ä¹ ååŒé…åˆï¼Œå®ç°æ¯”å•æ™ºèƒ½ä½“æ›´ç²¾ç»†çš„ç«ç„°å½¢çŠ¶æ§åˆ¶ã€‚</p></div>
                        <div class="p-4 bg-slate-50 rounded-lg hover:shadow-md transition"><h4 class="font-bold text-lg">å¯è§£é‡Šæ€§ (XAI)</h4><p class="text-sm mt-2">è®©AIä¸å†æ˜¯â€œé»‘ç®±â€ï¼Œèƒ½å¤Ÿè§£é‡Šå…¶å†³ç­–åŸå› ï¼ˆå¦‚â€œå› ä¸ºæ£€æµ‹åˆ°COä¸Šå‡è¶‹åŠ¿ï¼Œæˆ‘é€‰æ‹©å¢åŠ ä¸Šå±‚é£é—¨â€ï¼‰ï¼Œä»è€Œå¢å¼ºäººæœºä¿¡ä»»ã€‚</p></div>
                        <div class="p-4 bg-slate-50 rounded-lg hover:shadow-md transition"><h4 class="font-bold text-lg">è¿ç§»å­¦ä¹ ä¸ç»ˆèº«å­¦ä¹ </h4><p class="text-sm mt-2">å°†åœ¨Aæœºç»„ä¸Šè®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¿«é€Ÿã€ä½æˆæœ¬åœ°é€‚é…åˆ°Bæœºç»„ã€‚å¹¶ä¸”è®©æ¨¡å‹èƒ½åœ¨ä¸Šçº¿åæŒç»­å­¦ä¹ ï¼Œé€‚åº”è®¾å¤‡è€åŒ–ç­‰æ–°æƒ…å†µã€‚</p></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Global Variables & Selectors ---
    const navLinks = document.querySelectorAll('.nav-link');
    const contentSections = document.querySelectorAll('.content-section');
    
    let currentView = '';
    // Use an object to manage animation frame IDs for different chapters to precisely control start/stop
    let activeAnimationFrames = {};

    // --- Core Navigation Function ---
    function navigateTo(viewId) {
        if (!viewId || currentView === viewId) return;

        // --- Cleanup: Stop animations of the view being left ---
        Object.values(activeAnimationFrames).forEach(id => {
            if (id) cancelAnimationFrame(id);
        });
        activeAnimationFrames = {}; // Clear animation ID records
        
        if(window.acAnimationTimeoutId) clearTimeout(window.acAnimationTimeoutId);
        if(window.bellmanIntervalId) clearInterval(window.bellmanIntervalId);
        
        currentView = viewId;
        
        navLinks.forEach(link => link.classList.toggle('active', link.dataset.view === viewId));
        contentSections.forEach(section => section.classList.toggle('active', section.id === viewId));
        
        // --- Initialization: Start interactive modules for the new view ---
        initializeInteractiveModules(viewId);
    }
    
    // --- Initial Page Load ---
    const initialView = window.location.hash ? window.location.hash.substring(1) : 'chapter1';
    navigateTo(initialView);

    // --- Event Binding ---
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const viewId = link.dataset.view;
            navigateTo(viewId);
            window.history.pushState(null, null, `#${viewId}`);
        });
    });

    window.addEventListener('popstate', () => {
        const viewId = window.location.hash ? window.location.hash.substring(1) : 'chapter1';
        navigateTo(viewId);
    });
});

// --- Central dispatcher for initializing all interactive modules ---
function initializeInteractiveModules(viewId) {
    // Make the animation frame manager globally accessible within this script's scope
    window.activeAnimationFrames = window.activeAnimationFrames || {};
    switch(viewId) {
        case 'chapter1': initBoilerSandbox(); break;
        case 'chapter2': initBellmanGrid(); break;
        case 'chapter3': initActorCriticViz(); break;
        case 'chapter4': initPpoCanvas(); break;
        case 'chapter5': initSacCanvas(); break;
        case 'chapter6': initCmdpLab(); break;
        case 'chapter7': initSimRealCanvas(); break;
        case 'chapter8': initSim(); break; 
        case 'chapter9': selectStep(1); break;
    }
}
    
// --- JS Logic Implementation for Each Chapter ---

/**
 * Chapter 1: Evolved Boiler Sandbox with Dynamic Load and Pareto Front
 */
function initBoilerSandbox() {
    const sliders = {
        load: document.getElementById('load-slider'),
        air: document.getElementById('air-total-slider'),
        tilt: document.getElementById('burner-tilt-slider'),
        ofa: document.getElementById('o2-dist-slider')
    };
    if (!sliders.load) return;

    const values = {
        load: document.getElementById('load-value'),
        air: document.getElementById('air-total-value'),
        tilt: document.getElementById('burner-tilt-value'),
        ofa: document.getElementById('o2-dist-value')
    };
    const visuals = {
        flame: document.getElementById('flame-visual'),
        nox: document.getElementById('nox-meter-fill'),
        co: document.getElementById('co-meter-fill'),
        efficiency: document.getElementById('efficiency-value')
    };
    
    const paretoCtx = document.getElementById('pareto-chart')?.getContext('2d');
    let paretoChart;

    function updateBoilerSimulation() {
        const load = parseFloat(sliders.load.value);
        const air = parseFloat(sliders.air.value);
        const tilt = parseFloat(sliders.tilt.value);
        const ofa = parseFloat(sliders.ofa.value);
        
        values.load.textContent = load.toFixed(0);
        values.air.textContent = air.toFixed(0);
        values.tilt.textContent = tilt.toFixed(0);
        values.ofa.textContent = ofa.toFixed(0);

        // More complex simulation model incorporating load
        const load_factor = load / 100;
        let nox_raw = (air * 1.2 - ofa * 1.5 + Math.abs(tilt) * 0.5) * (0.8 + load_factor * 0.4);
        let co_raw = (150 - air + (Math.abs(air - 85) * 0.4)) * (0.9 + load_factor * 0.2);
        let eff_base = 90.5 + load_factor * 2;
        let eff_air = 1 - Math.abs(air - (80 + load_factor * 5)) / 50;
        let eff_ofa = 1 - Math.abs(ofa - 35) / 40;
        let efficiency_raw = eff_base + (eff_air * 1.5) + (eff_ofa * 1) - (co_raw / 150);

        const nox = Math.max(10, Math.min(100, nox_raw));
        const co = Math.max(5, Math.min(100, co_raw));
        const efficiency = Math.max(88, Math.min(94.5, efficiency_raw));
        
        visuals.flame.style.height = `${(40 + (air / 100) * 60) * (0.8 + load_factor * 0.2)}%`;
        visuals.flame.style.transform = `translateY(${tilt * -1.5}px) skewX(${tilt * -0.5}deg)`;
        visuals.nox.style.width = `${nox}%`;
        visuals.co.style.width = `${co}%`;
        visuals.efficiency.textContent = efficiency.toFixed(2);

        updateParetoChart(efficiency, nox);
    }

    function generateParetoFront() {
        // Simplified generation of a plausible Pareto front
        const front = [];
        for (let eff = 94.5; eff >= 90; eff -= 0.1) {
            let nox = 30 + Math.pow(94.5 - eff, 2) * 2;
            nox += (Math.random() - 0.5) * 5; // add some noise
            front.push({x: nox, y: eff});
        }
        return front.sort((a,b) => a.x - b.x);
    }

    function updateParetoChart(efficiency, nox) {
        if (!paretoCtx) return;
        
        if (!paretoChart) {
            const paretoFrontData = generateParetoFront();
            paretoChart = new Chart(paretoCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'å¸•ç´¯æ‰˜æœ€ä¼˜å‰æ²¿',
                        data: paretoFrontData,
                        borderColor: 'rgba(220, 38, 38, 0.5)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        showLine: true,
                        fill: false,
                    },{
                        label: 'å½“å‰å·¥ä½œç‚¹',
                        data: [{x: nox, y: efficiency}],
                        backgroundColor: 'rgb(79, 70, 229)',
                        pointRadius: 8,
                        pointHoverRadius: 10,
                    }]
                },
                options: {
                    scales: {
                        x: { title: { display: true, text: 'NOx æ’æ”¾ (å€¼è¶Šä½è¶Šå¥½)' }, min: 20, max: 100 },
                        y: { title: { display: true, text: 'çƒ­æ•ˆç‡ (%)' }, min: 88, max: 95 }
                    },
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        } else {
            paretoChart.data.datasets[1].data = [{x: nox, y: efficiency}];
            paretoChart.update();
        }
    }

    Object.values(sliders).forEach(slider => slider.addEventListener('input', updateBoilerSimulation));
    updateBoilerSimulation();
}


/**
 * Chapter 2: Interactive Bellman Value Iteration
 */
function initBellmanGrid() {
    const canvas = document.getElementById('bellman-canvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const iterateBtn = document.getElementById('iterate-bellman-btn');
    const resetBtn = document.getElementById('reset-bellman-btn');
    const iterCountEl = document.getElementById('bellman-iteration-count');
    const updateInfoEl = document.getElementById('bellman-update-info');

    const GRID_SIZE = 5;
    const GAMMA = 0.9;
    const REWARDS = { goal: 1, trap: -1, step: 0 };
    const goal = {x: 4, y: 4};
    const traps = [{x: 2, y: 2}, {x: 1, y: 3}];
    const walls = [{x: 3, y: 1}];

    let values = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(0));
    let policy = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(-1));
    let iterationCount = 0;

    function reset() {
        iterationCount = 0;
        values = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(0));
        policy = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(-1));
        iterCountEl.textContent = iterationCount;
        updateInfoEl.textContent = 'ç¯å¢ƒå·²é‡ç½®ã€‚';
        drawGrid();
    }

    function iterate() {
        let newValues = JSON.parse(JSON.stringify(values));
        let maxChange = 0;

        for (let y = 0; y < GRID_SIZE; y++) {
            for (let x = 0; x < GRID_SIZE; x++) {
                if (isWall(x, y)) continue;
                if (isTerminal(x, y)) {
                    newValues[y][x] = (x === goal.x && y === goal.y) ? REWARDS.goal : REWARDS.trap;
                    continue;
                }

                const actionValues = getActionValues(x, y);
                const bestValue = Math.max(...actionValues);
                newValues[y][x] = REWARDS.step + GAMMA * bestValue;
                
                maxChange = Math.max(maxChange, Math.abs(newValues[y][x] - values[y][x]));
            }
        }
        values = newValues;
        updatePolicy();
        iterationCount++;
        iterCountEl.textContent = iterationCount;
        updateInfoEl.textContent = `V(s) æ›´æ–°å®Œæˆã€‚æœ€å¤§å˜åŒ–é‡: ${maxChange.toFixed(3)}`;
        drawGrid();
    }
    
    function getActionValues(x, y) {
        const actions = [[0, -1], [0, 1], [-1, 0], [1, 0]]; // U, D, L, R
        return actions.map(([dx, dy]) => {
            const nx = x + dx, ny = y + dy;
            if (nx < 0 || nx >= GRID_SIZE || ny < 0 || ny >= GRID_SIZE || isWall(nx, ny)) {
                return values[y][x]; // Bump into wall, stay in place
            }
            return values[ny][nx];
        });
    }
    
    function updatePolicy() {
         for (let y = 0; y < GRID_SIZE; y++) {
            for (let x = 0; x < GRID_SIZE; x++) {
                if (isTerminal(x, y) || isWall(x, y)) continue;
                const actionValues = getActionValues(x, y);
                policy[y][x] = actionValues.indexOf(Math.max(...actionValues));
            }
        }
    }

    function isTerminal(x, y) { return (x === goal.x && y === goal.y) || traps.some(t => t.x === x && t.y === y); }
    function isWall(x, y) { return walls.some(w => w.x === x && w.y === y); }

    function drawGrid() {
        const cellSize = canvas.width / GRID_SIZE;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const arrows = ['â†‘', 'â†“', 'â†', 'â†’'];

        for (let y = 0; y < GRID_SIZE; y++) {
            for (let x = 0; x < GRID_SIZE; x++) {
                const val = values[y][x];
                const heat = (val - REWARDS.trap) / (REWARDS.goal - REWARDS.trap);
                const r = Math.floor(255 * (1 - heat));
                const g = Math.floor(255 * heat);
                ctx.fillStyle = `rgb(${r}, ${g}, 100)`;
                if (isWall(x, y)) ctx.fillStyle = '#555';
                ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                ctx.strokeStyle = '#ccc';
                ctx.strokeRect(x * cellSize, y * cellSize, cellSize, cellSize);

                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                if (isTerminal(x,y) || isWall(x,y)) {
                    ctx.font = `${cellSize*0.6}px sans-serif`;
                    ctx.fillStyle = '#fff';
                    if(x === goal.x && y === goal.y) ctx.fillText('ğŸ†', x * cellSize + cellSize/2, y * cellSize + cellSize/2);
                    else if(isWall(x, y)) ctx.fillText('ğŸ§±', x * cellSize + cellSize/2, y * cellSize + cellSize/2);
                    else ctx.fillText('â˜ ï¸', x * cellSize + cellSize/2, y * cellSize + cellSize/2);
                } else {
                    ctx.fillStyle = '#000';
                    ctx.font = `bold ${cellSize*0.25}px sans-serif`;
                    ctx.fillText(val.toFixed(1), x * cellSize + cellSize/2, y * cellSize + cellSize/4);
                    if(policy[y][x] !== -1) {
                         ctx.font = `${cellSize*0.4}px sans-serif`;
                         ctx.fillText(arrows[policy[y][x]], x * cellSize + cellSize/2, y * cellSize + cellSize*0.7);
                    }
                }
            }
        }
    }
    
    iterateBtn.onclick = iterate;
    resetBtn.onclick = reset;
    reset();
}

/**
 * Chapter 3: Actor-Critic Visualization with Advantage Function
 */
function initActorCriticViz() {
    const playBtn = document.getElementById('play-ac-viz');
    const explanationEl = document.getElementById('ac-viz-explanation');
    const svgEl = document.getElementById('ac-viz-svg');
    if (!playBtn) return;
    
    const vizHtml = `<defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#9ca3af" /></marker><marker id="arrowhead-h" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#f97316" /></marker></defs><g class="ac-label" id="label-state"><text x="50" y="25" text-anchor="middle" font-size="12">çŠ¶æ€ S</text></g><g class="ac-node" id="node-state"><rect x="10" y="30" width="80" height="40" rx="5" fill="#fff" stroke="#9ca3af" stroke-width="2" /></g><path class="ac-arrow" id="arrow-to-actor" d="M95,50 C140,50 140,90 185,90" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-label" id="label-actor"><text x="225" y="80" text-anchor="middle" font-size="12">æ¼”å‘˜ Actor</text></g><g class="ac-node" id="node-actor"><rect x="185" y="85" width="80" height="40" rx="20" fill="#eff6ff" stroke="#60a5fa" stroke-width="2" /></g><path class="ac-arrow" id="arrow-to-action" d="M225,130 Q225,150 225,170" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-label" id="label-action"><text x="225" y="165" text-anchor="middle" font-size="12">åŠ¨ä½œ A</text></g><g class="ac-node" id="node-action"><rect x="185" y="170" width="80" height="40" rx="5" fill="#fff" stroke="#9ca3af" stroke-width="2" /></g><path class="ac-arrow" id="arrow-to-env" d="M180,190 C140,190 140,230 105,230" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-label" id="label-env"><text x="65" y="220" text-anchor="middle" font-size="12">ç¯å¢ƒ Env</text></g><g class="ac-node" id="node-env"><rect x="25" y="225" width="80" height="40" rx="20" fill="#fff7ed" stroke="#fb923c" stroke-width="2" /></g><path class="ac-arrow" id="arrow-to-critic" d="M110,245 C160,245 250,245 295,245" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-label" id="label-reward"><text x="200" y="265" text-anchor="middle" font-size="10">å¥–åŠ± R, æ–°çŠ¶æ€ S'</text></g><g class="ac-label" id="label-critic"><text x="340" y="220" text-anchor="middle" font-size="12">è¯„è®ºå®¶ Critic</text></g><g class="ac-node" id="node-critic"><rect x="300" y="225" width="80" height="40" rx="20" fill="#f0fdf4" stroke="#4ade80" stroke-width="2" /></g><path class="ac-arrow" id="arrow-critic-to-actor" d="M340,220 C340,150 270,150 265,125" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5" /><g class="ac-label" id="label-update"><text x="310" y="170" text-anchor="middle" font-weight="bold" font-size="12" fill="transparent">ä¼˜åŠ¿ A(s,a)</text></g>`;
    svgEl.innerHTML = vizHtml;
    
    playBtn.onclick = () => {
        if (playBtn.disabled) return;
        playBtn.disabled = true;
        if(window.acAnimationTimeoutId) clearTimeout(window.acAnimationTimeoutId);
        let i = 0;
        const steps=[{el:["node-state","label-state"],text:"1. æ™ºèƒ½ä½“è§‚å¯Ÿåˆ°å½“å‰çŠ¶æ€ S"},{el:["arrow-to-actor"],text:"2. çŠ¶æ€ S è¢«è¾“å…¥ç»™æ¼”å‘˜ (Actor)"},{el:["node-actor","label-actor"],text:"3. æ¼”å‘˜æ ¹æ®ç­–ç•¥ï¼Œé€‰æ‹©ä¸€ä¸ªåŠ¨ä½œ A"},{el:["arrow-to-action"],text:"4. æ¼”å‘˜è¾“å‡ºåŠ¨ä½œ A"},{el:["node-action","label-action"],text:"5. åŠ¨ä½œ A å‡†å¤‡æ–½åŠ äºç¯å¢ƒ"},{el:["arrow-to-env"],text:"6. ç¯å¢ƒæ¥æ”¶åŠ¨ä½œ"},{el:["node-env","label-env"],text:"7. ç¯å¢ƒå‘ç”Ÿæ”¹å˜ï¼Œè¿”å›æ–°çŠ¶æ€S'å’Œå¥–åŠ±R"},{el:["arrow-to-critic","label-reward"],text:"8. S, A, R, S' è¢«é€å¾€è¯„è®ºå®¶è¿›è¡Œè¯„ä¼°"},{el:["node-critic","label-critic"],text:"9. è¯„è®ºå®¶è®¡ç®—TDç›®æ ‡å’Œå½“å‰Qå€¼ï¼Œå¾—å‡ºä¼˜åŠ¿å‡½æ•° A(s,a)"},{el:["arrow-critic-to-actor","label-update"],text:"10. ä¼˜åŠ¿å‡½æ•° A(s,a) æŒ‡å¯¼æ¼”å‘˜æ›´æ–°ç­–ç•¥ (è‹¥A>0, å¢åŠ è¯¥åŠ¨ä½œæ¦‚ç‡)"}];
        const elements={nodes:Array.from(svgEl.querySelectorAll(".ac-node")),labels:Array.from(svgEl.querySelectorAll(".ac-label")),arrows:Array.from(svgEl.querySelectorAll(".ac-arrow")),updateLabel:svgEl.querySelector("#label-update")};
        function resetHighlights(){elements.nodes.forEach(e=>e.classList.remove("highlight")),elements.labels.forEach(e=>e.classList.remove("highlight")),elements.arrows.forEach(e=>{e.style.stroke="#9ca3af",e.setAttribute("marker-end","url(#arrowhead)")}),elements.updateLabel.style.fill="transparent",explanationEl.textContent=""}
        function nextStep(){resetHighlights();if(i>=steps.length)return playBtn.disabled=!1,void(explanationEl.textContent="æµç¨‹ç»“æŸã€‚å¯å†æ¬¡æ’­æ”¾ã€‚");const e=steps[i];explanationEl.textContent=e.text,e.el.forEach(t=>{const e=svgEl.querySelector(`#${t}`);e&&(e.classList.add("highlight"),"path"===e.tagName.toLowerCase()?(e.style.stroke="#f97316",e.setAttribute("marker-end","url(#arrowhead-h)")):t.includes("node")?e.classList.add("highlight"):"label-update"===t&&(e.style.fill="#c2410c"))}),i++,window.acAnimationTimeoutId=setTimeout(nextStep,1800)}
        resetHighlights(),nextStep();
    };
}
    
/**
 * Chapter 4: PPO Canvas with adjustable Epsilon
 */
function initPpoCanvas() {
    const canvas = document.getElementById('ppo-canvas'); 
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const toggleBtn = document.getElementById('ppo-toggle-advantage');
    const explanationEl = document.getElementById('ppo-explanation');
    const epsilonSlider = document.getElementById('epsilon-slider');
    const epsilonValueEl = document.getElementById('epsilon-value');
    let advantage = 1;
    let epsilon = 0.2;

    function drawPpo(){
        const w = canvas.width, h = canvas.height;
        ctx.clearRect(0, 0, w, h);
        
        ctx.strokeStyle = '#cbd5e1';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, h/2); ctx.lineTo(w, h/2);
        const r1_x = w * (1 - 0.5) / 1.5;
        ctx.moveTo(r1_x, 0); ctx.lineTo(r1_x, h);
        ctx.stroke();
        ctx.fillStyle = '#64748b';
        ctx.font = '12px Noto Sans SC';
        ctx.fillText('r(Î¸)=1', r1_x - 10, h/2 + 15);
        ctx.fillText('ç›®æ ‡ L', w/2 - 20, 15);
        
        // Draw trust region
        ctx.fillStyle = 'rgba(79, 70, 229, 0.05)';
        const clip_lower_x = w * (1 - epsilon - 0.5) / 1.5;
        const clip_upper_x = w * (1 + epsilon - 0.5) / 1.5;
        ctx.fillRect(clip_lower_x, 0, clip_upper_x - clip_lower_x, h);

        ctx.strokeStyle = '#fca5a5';
        ctx.setLineDash([5, 5]);
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.moveTo(0, h/2 - 50 * (1 + epsilon) * advantage);
        ctx.lineTo(w, h/2 - 50 * (1 + epsilon) * advantage);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, h/2 - 50 * (1 - epsilon) * advantage);
        ctx.lineTo(w, h/2 - 50 * (1 - epsilon) * advantage);
        ctx.stroke();
        ctx.setLineDash([]);
        
        ctx.strokeStyle = '#4f46e5';
        ctx.lineWidth = 3;
        ctx.beginPath();
        for (let i = 0; i <= w; i++) {
            const ratio = 0.5 + (i / w) * 1.5;
            const y_unclipped = h/2 - 50 * ratio * advantage;
            let y_clipped = y_unclipped;
            if (advantage > 0) {
                y_clipped = Math.max(y_unclipped, h/2 - 50 * (1 + epsilon) * advantage);
            } else {
                y_clipped = Math.min(y_unclipped, h/2 - 50 * (1 - epsilon) * advantage);
            }
            i === 0 ? ctx.moveTo(i, y_clipped) : ctx.lineTo(i, y_clipped);
        }
        ctx.stroke();

        if (advantage > 0) {
            explanationEl.innerHTML = 'å½“ä¼˜åŠ¿ $\\hat{A}_t > 0$ (å¥½åŠ¨ä½œ)æ—¶ï¼Œç›®æ ‡å‡½æ•°è¢« <span class="text-red-500 font-semibold">å‘ä¸Šæ¨åŠ¨</span>ï¼Œä½†è¢«ä¸Šé™è£å‰ªï¼Œé˜²æ­¢ç­–ç•¥è¿‡äºæ¿€è¿›ã€‚';
        } else {
            explanationEl.innerHTML = 'å½“ä¼˜åŠ¿ $\\hat{A}_t < 0$ (ååŠ¨ä½œ)æ—¶ï¼Œç›®æ ‡å‡½æ•°è¢« <span class="text-blue-500 font-semibold">å‘ä¸‹æ‹‰åŠ¨</span>ï¼Œä½†è¢«ä¸‹é™è£å‰ªï¼Œé˜²æ­¢ç­–ç•¥æ›´æ–°è¿‡çŒ›ã€‚';
        }
        if(window.MathJax) MathJax.typesetPromise();
    }
    
    toggleBtn.onclick=()=>{
        advantage *= -1;
        toggleBtn.textContent = advantage > 0 ? 'åˆ‡æ¢åˆ° "ååŠ¨ä½œ" (Ã‚ < 0)' : 'åˆ‡æ¢åˆ° "å¥½åŠ¨ä½œ" (Ã‚ > 0)';
        drawPpo();
    };
    epsilonSlider.oninput = (e) => {
        epsilon = parseFloat(e.target.value);
        epsilonValueEl.textContent = epsilon.toFixed(2);
        drawPpo();
    };
    
    drawPpo();
}
    
/**
 * Chapter 5: SAC Canvas with Reward Landscape
 */
function initSacCanvas() {
    const sacCanvas = document.getElementById('sac-canvas'); 
    if (!sacCanvas) return;
    const sacCtx = sacCanvas.getContext('2d');
    const slider = document.getElementById('alpha-slider');
    const valueDisp = document.getElementById('alpha-value');
    const explanationEl = document.getElementById('sac-explanation');
    let alpha = 0.2;
    
    const activeAnimationFrames = window.activeAnimationFrames || (window.activeAnimationFrames = {});

    slider.oninput = (e) => {
        alpha = parseFloat(e.target.value);
        valueDisp.textContent = alpha.toFixed(2);
    };
    
    function drawRewardLandscape(ctx, w, h) {
        ctx.beginPath();
        ctx.strokeStyle = 'rgba(100, 116, 139, 0.4)';
        ctx.lineWidth = 2;
        ctx.setLineDash([2, 3]);
        for (let x = 0; x < w; x++) {
            const y = h - (Math.sin(x * 0.05) * 20 + Math.cos(x * 0.15) * 15 + h/2.5);
            x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        }
        ctx.stroke();
        ctx.setLineDash([]);
    }

    function drawSac() {
        const w = sacCanvas.width, h = sacCanvas.height;
        sacCtx.clearRect(0, 0, w, h);
        drawRewardLandscape(sacCtx, w, h);
        
        sacCtx.beginPath();
        sacCtx.fillStyle = 'rgba(79, 70, 229, 0.5)';
        const std_dev = 0.05 + alpha * 0.5;
        const mean = w / 2 + Math.sin(Date.now() * 0.0005) * w/4; // Slowly moving peak
        
        for (let x = 0; x < w; x++) {
            const norm_x = (x - mean) / (w / 4);
            const y = Math.exp(-0.5 * Math.pow(norm_x / std_dev, 2)) * (h - 20);
            x === 0 ? sacCtx.moveTo(x, h - y) : sacCtx.lineTo(x, h - y);
        }
        sacCtx.lineTo(w, h);
        sacCtx.lineTo(0, h);
        sacCtx.closePath();
        sacCtx.fill();
        
        explanationEl.textContent = alpha > 0.5 ? 'é«˜Î±: ç­–ç•¥æ›´å¹³å¦, ç§¯ææ¢ç´¢' : (alpha < 0.1 ? 'ä½Î±: ç­–ç•¥æ›´å°–é”, ç§¯æåˆ©ç”¨' : 'Î±é€‚ä¸­: å¹³è¡¡æ¢ç´¢ä¸åˆ©ç”¨');
        activeAnimationFrames.sac = requestAnimationFrame(drawSac);
    }
    
    activeAnimationFrames.sac = requestAnimationFrame(drawSac);
}

/**
 * Chapter 6: CMDP Lab - Flame Fix
 */
function initCmdpLab(){const e=document.getElementById("cmdp-builder-panel");if(!e)return;const t=e.querySelectorAll(".cmdp-checkbox"),l=document.getElementById("air-slider-ch6"),n=document.getElementById("tilt-slider-ch6"),o=document.getElementById("ofa-slider-ch6"),i=document.getElementById("air-value-ch6"),a=document.getElementById("tilt-value-ch6"),s=document.getElementById("ofa-value-ch6"),r=document.getElementById("flame-visual-ch6"),d=document.getElementById("nox-meter-fill-ch6"),c=document.getElementById("co-meter-fill-ch6"),m=document.getElementById("temp-meter-fill-ch6"),u=document.getElementById("efficiency-value-ch6");function g(){if(!l||!n||!o)return;const e=parseFloat(l.value),t=parseFloat(n.value),c=parseFloat(o.value);i&&(i.textContent=e.toFixed(0)),a&&(a.textContent=t.toFixed(0)),s&&(s.textContent=c.toFixed(0));let g=1.1*e-1.6*c+.4*Math.abs(t),h=140-e+.5*Math.abs(e-80),f=60+(e-75)+Math.abs(t),p=1-Math.abs(e-85)/50,E=1-Math.abs(c-35)/40,v=91.5+1.5*p+1*E-h/100;g=Math.max(10,Math.min(100,g)),h=Math.max(5,Math.min(100,h)),f=Math.max(20,Math.min(100,f)),v=Math.max(90,Math.min(94,v)),r&&(r.style.height=`${30+e/100*70}%`,r.style.transform=`translateY(${t*-1.5}px) skewX(${t*-.5}deg)`),d&&(d.style.width=`${g}%`),c&&(c.style.width=`${h}%`),m&&(m.style.width=`${f}%`),u&&(u.textContent=v.toFixed(2))}function h(){t.forEach(e=>{e.addEventListener("change",()=>{const t=e.dataset.target,l=document.getElementById(t);if(!l)return;l.classList.toggle("hidden",!e.checked);const n=e.dataset.type;l.classList.remove("reward-highlight","cost-highlight"),e.checked&&("reward"===n?l.classList.add("reward-highlight"):"cost"===n&&l.classList.add("cost-highlight")),f()})}),l&&l.addEventListener("input",g),n&&n.addEventListener("input",g),o&&o.addEventListener("input",g),f()}function f(){const e={State:[],Action:[],Reward:[],Cost:[]};t.forEach(t=>{if(t.checked){const l=t.parentElement.textContent.trim(),n=t.closest("div.space-y-2").previousElementSibling.textContent;n.includes("çŠ¶æ€")?e.State.push(l):n.includes("åŠ¨ä½œ")?e.Action.push(l):n.includes("å¥–åŠ±")?e.Reward.push(l):n.includes("æˆæœ¬")&&e.Cost.push(l)}}),document.getElementById("summary-State-ch6").innerHTML=e.State.map(e=>`<li>${e}</li>`).join("")||"<li>å°šæœªé€‰æ‹©</li>",document.getElementById("summary-Action-ch6").innerHTML=e.Action.map(e=>`<li>${e}</li>`).join("")||"<li>å°šæœªé€‰æ‹©</li>",document.getElementById("summary-Reward-ch6").innerHTML=e.Reward.map(e=>`<li>${e}</li>`).join("")||"<li>å°šæœªé€‰æ‹©</li>",document.getElementById("summary-Cost-ch6").innerHTML=e.Cost.map(e=>`<li>${e}</li>`).join("")||"<li>å°šæœªé€‰æ‹©</li>"}h(),g()}
function initSimRealCanvas(){const e=document.getElementById("sim-real-canvas");if(!e)return;const t=e.getContext("2d");let l=50;const n=document.getElementById("model-quality-slider"),o=document.getElementById("model-quality-value"),i=window.activeAnimationFrames||(window.activeAnimationFrames={});n&&(n.oninput=e=>{l=parseInt(e.target.value),o.textContent=l});const a=()=>{const n=e.width,o=e.height;t.clearRect(0,0,n,o);const s=Date.now()*.0005;t.beginPath(),t.strokeStyle="#1e293b",t.lineWidth=3;for(let e=0;e<n;e++){const l=o/2+Math.sin(.03*e+s)*o/6+Math.cos(.07*e+s)*o/8;0===e?t.moveTo(e,l):t.lineTo(e,l)}t.stroke(),t.beginPath(),t.strokeStyle="#3b82f6",t.lineWidth=2,t.setLineDash([5,5]);const r=(100-l)/100*o/3;for(let e=0;e<n;e++){const l=o/2+Math.sin(.03*e+s)*o/6+Math.cos(.07*e+s)*o/8,i=l+(.5-Math.random())*r;0===e?t.moveTo(e,i):t.lineTo(e,i)}t.stroke(),t.setLineDash([]),i.simReal=requestAnimationFrame(a)};i.simReal=requestAnimationFrame(a)}
function initSim(){const e=document.getElementById("rl-canvas");if(!e)return;const t=e.getContext("2d"),l=document.getElementById("rewardChart").getContext("2d"),n=window.activeAnimationFrames||(window.activeAnimationFrames={});let o,i,a,s,r,d,c=8,m={x:c-1,y:c-1},u=[{x:2,y:2},{x:2,y:3},{x:3,y:2},{x:5,y:5},{x:6,y:5}],g=[];const h={gamma:.9,lr:.1,epsilon:.2};function f(){n.rl&&cancelAnimationFrame(n.rl),e.width=e.offsetWidth,e.height=e.offsetHeight,o=e.width/c,i={x:0,y:0},a=Array(c).fill(0).map(()=>Array(c).fill(0).map(()=>[0,0,0,0])),s=0,r=0,g=[],E(),v(),p()}function p(){s<1e3?(function(){for(let e=0;e<10;e++)w()}() ,y(),n.rl=requestAnimationFrame(p)):y()}function y(){if(!t)return;t.clearRect(0,0,e.width,e.height);for(let l=0;l<c;l++)for(let n=0;n<c;n++){const e=Math.max(...a[l][n]),i=e>.1?Math.min(1,e/50):0,s=u.some(e=>e.x===n&&e.y===l)?220:255-150*i,d=m.x===n&&m.y===l?220:220+30*i,f=u.some(e=>e.x===n&&e.y===l)?100:220-100*i;t.fillStyle=`rgb(${Math.floor(s)}, ${Math.floor(d)}, ${Math.floor(f)})`,t.fillRect(n*o,l*o,o,o),s>50&&e>.1&&(t.fillStyle="rgba(0, 0, 0, 0.6)",t.font=`${.4*o}px sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText(["â†‘","â†“","â†","â†’"][a[l][n].indexOf(e)],n*o+o/2,l*o+o/2))}t.font=`${.6*o}px sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText("S",o/2,o/2),t.fillText("ğŸ†",m.x*o+o/2,m.y*o+o/2),u.forEach(e=>t.fillText("â˜ ï¸",e.x*o+o/2,e.y*o+o/2)),t.fillStyle="#3b82f6",t.beginPath(),t.arc(i.x*o+o/2,i.y*o+o/2,o/3.5,0,2*Math.PI),t.fill()}function w(){i={x:0,y:0};let e=0,t=0,l=!1;for(;!l&&t<50;){const n={x:i.x,y:i.y},o=b(n),d=x(n,o),f=k(d),p=a[n.y][n.x][o],y=Math.max(...a[d.y][d.x]);a[n.y][n.x][o]=p+h.lr*(f+h.gamma*y-p),i=d,e+=f,t++,(i.x===m.x&&i.y===m.y||u.some(e=>e.x===i.x&&e.y===i.y))&&(l=!0)}s++,g.push(e),C(),L()}function b(e){return Math.random()<h.epsilon?Math.floor(4*Math.random()):a[e.y][e.x].indexOf(Math.max(...a[e.y][e.x]))}function x(e,t){let{x:l,y:n}=e;return 0===t?n=Math.max(0,n-1):1===t?n=Math.min(c-1,n+1):2===t?l=Math.max(0,l-1):3===t&&(l=Math.min(c-1,l+1)),{x:l,y:n}}function k(e){return e.x===m.x&&e.y===m.y?100:u.some(t=>t.x===e.x&&t.y===e.y)?-100:-1}function v(){d&&d.destroy(),d=new Chart(l,{type:"line",data:{labels:[],datasets:[{label:"æœ€è¿‘10å›åˆå¹³å‡å¥–åŠ±",data:[],borderColor:"#16a34a",tension:.2,pointRadius:0,fill:!0,backgroundColor:"rgba(22, 163, 74, 0.1)"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{display:!1},y:{title:{display:!0,text:"å¥–åŠ±"}}},plugins:{legend:{display:!1}}}})}function C(){if(!d||s%10!=0)return;const e=g.slice(-10);r=e.reduce((e,t)=>e+t,0)/e.length,d.data.labels.push(s),d.data.datasets[0].data.push(r),d.data.labels.length>100&&(d.data.labels.shift(),d.data.datasets[0].data.shift()),d.update("none")}function L(){document.getElementById("episode-counter").textContent=s,document.getElementById("total-reward").textContent=r.toFixed(2)}function E(){document.getElementById("gamma-value").textContent=h.gamma,document.getElementById("lr-value").textContent=h.lr,document.getElementById("epsilon-value").textContent=h.epsilon}document.getElementById("start-sim").onclick=f,document.getElementById("gamma").oninput=e=>{h.gamma=parseFloat(e.target.value),E()},document.getElementById("lr").oninput=e=>{h.lr=parseFloat(e.target.value),E()},document.getElementById("epsilon").oninput=e=>{h.epsilon=parseFloat(e.target.value),E()},f()}
function selectStep(e){const t=document.getElementById("step-content");if(!t)return;const l={1:{title:"é˜¶æ®µä¸€ï¼šå»ºè®®æ¨¡å¼ (Advisory Mode)",description:"RLæ™ºèƒ½ä½“ä»¥â€œå½±å­æ¨¡å¼â€è¿è¡Œï¼Œå®æ—¶æ¥æ”¶ç”µå‚æ•°æ®å¹¶è®¡ç®—æœ€ä¼˜åŠ¨ä½œã€‚ä½†è¿™äº›åŠ¨ä½œå¹¶<strong>ä¸</strong>ç›´æ¥æ‰§è¡Œï¼Œè€Œæ˜¯ä½œä¸ºæ“ä½œå»ºè®®æ˜¾ç¤ºåœ¨æ“ä½œå‘˜ç«™çš„ç•Œé¢ä¸Šï¼Œç”±äººå·¥ç¡®è®¤æ‰§è¡Œã€‚",goals:["åœ¨é›¶é£é™©ä¸‹éªŒè¯AIç­–ç•¥çš„é•¿æœŸæ€§èƒ½ã€‚","è®©æ“ä½œå‘˜é€æ­¥ç†Ÿæ‚‰å’Œä¿¡ä»»AIçš„å†³ç­–é€»è¾‘ã€‚","æ”¶é›†å¯¹æ¯”æ•°æ®ï¼Œé‡åŒ–AIç›¸æ¯”äººå·¥æ“ä½œçš„æå‡ã€‚"],risk_mitigation:"æ“ä½œå‘˜æ‹¥æœ‰100%çš„æœ€ç»ˆæ§åˆ¶æƒï¼ŒAIæ— ä»»ä½•æ‰§è¡Œèƒ½åŠ›ï¼Œå®ç°ç»å¯¹å®‰å…¨ã€‚"},2:{title:"é˜¶æ®µäºŒï¼šç›‘ç£æ§åˆ¶ (Supervisory Control)",description:"AIçš„è¾“å‡ºä¸å†æ˜¯ç›´æ¥çš„é˜€é—¨åŠ¨ä½œï¼Œè€Œæ˜¯è°ƒæ•´DCSä¸­ç°æœ‰PIDæ§åˆ¶å›è·¯çš„<strong>è®¾å®šå€¼</strong>ï¼ˆSetpointï¼‰ã€‚ä¾‹å¦‚ï¼ŒAIå†³å®šå°†äºŒæ¬¡é£PIDçš„ç›®æ ‡ä»50%è°ƒæ•´åˆ°55%ã€‚",goals:["åœ¨ä¸æ”¹å˜åº•å±‚æˆç†Ÿæ§åˆ¶ç»“æ„çš„å‰æä¸‹å®ç°ä¼˜åŒ–ã€‚","åˆ©ç”¨ç°æœ‰DCSç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨è”é”ä½œä¸ºåšå›ºçš„åº•å±‚å®‰å…¨ç½‘ã€‚","åœ¨çœŸå®åé¦ˆä¸‹å¯¹æ¨¡å‹è¿›è¡Œåœ¨çº¿å¾®è°ƒã€‚"],risk_mitigation:"æ™ºèƒ½ä½“çš„ä½œç”¨èŒƒå›´è¢«é™åˆ¶åœ¨é«˜å±‚è®¾å®šå€¼ï¼Œåº•å±‚çš„å¿«é€Ÿè°ƒèŠ‚å’Œå®‰å…¨ä¿æŠ¤ä»ç”±ç°æœ‰PIDç³»ç»Ÿå®Œæˆï¼ŒåŠ¨ä½œå¹³ç¼“ä¸”å¯æ§ã€‚"},3:{title:"é˜¶æ®µä¸‰ï¼šç›´æ¥æ§åˆ¶ (Direct Control)",description:"è¿™æ˜¯æœ€ç»ˆé˜¶æ®µï¼ŒAIè·å¾—å¯¹æ‰§è¡Œå™¨çš„ç›´æ¥æ§åˆ¶æƒã€‚ä½†å…¶è¾“å‡ºçš„æ‰€æœ‰æŒ‡ä»¤åœ¨å‘é€ç»™DCSä¹‹å‰ï¼Œå¿…é¡»å¼ºåˆ¶é€šè¿‡ä¸€ä¸ªæœ€ç»ˆçš„ã€ç¡¬ç¼–ç çš„<strong>å®‰å…¨å±‚ (Safety Layer)</strong>ã€‚",goals:["å®ç°å®Œå…¨çš„è‡ªä¸»ä¼˜åŒ–ï¼Œå‘æŒ¥RLç­–ç•¥çš„æœ€å¤§æ½œåŠ›ã€‚","å¯¹å·¥å†µå˜åŒ–åšå‡ºæœ€å¿«é€Ÿã€æœ€ç›´æ¥çš„å“åº”ã€‚"],risk_mitigation:"â€œå®‰å…¨å±‚â€æ˜¯ä¸€ä¸ªéAIçš„ç®€å•è§„åˆ™ç¨‹åºï¼Œå®ƒä¼šæ£€æŸ¥AIçš„æ¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œå¦å†³ä»»ä½•å¯èƒ½è¿åç¡¬æ€§å®‰å…¨çº¦æŸï¼ˆå¦‚æ¸©åº¦ã€å‹åŠ›ã€å˜åŒ–é€Ÿç‡è¶Šé™ï¼‰çš„åŠ¨ä½œï¼Œæ˜¯å¯¹æŠ—AIä¸å¯é¢„è§è¡Œä¸ºçš„æœ€åä¸€é“é˜²çº¿ã€‚"}};for(let n=1;n<=3;n++){const o=document.getElementById(`step${n}`);o&&o.classList.toggle("active",n===e)}const n=l[e];n&&(t.innerHTML=`<h3 class="text-xl font-bold mb-4">${n.title}</h3><p class="text-slate-600 mb-4">${n.description}</p><h4 class="font-bold text-lg mb-2">ä¸»è¦ç›®æ ‡:</h4><ul class="list-disc list-inside space-y-1 text-slate-600 mb-4">${n.goals.map(e=>`<li>${e}</li>`).join("")}</ul><h4 class="font-bold text-lg mb-2">é£é™©æ§åˆ¶:</h4><p class="p-3 bg-green-50 border border-green-200 text-green-800 rounded-lg">${n.risk_mitigation}</p>`)}
</script>
</body>
</html>
