<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾¯å† è¾°å¼ºåŒ–å­¦ä¹ é”…ç‚‰ä¼˜åŒ–</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']]
          }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* Define CSS variables for theming */
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-muted: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --border-color: #e2e8f0;
            --accent-color: #4f46e5;
            --accent-text: #ffffff;
            --card-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.07), 0 2px 4px -2px rgb(0 0 0 / 0.07);
            --card-shadow-hover: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        .dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-muted: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --accent-color: #6366f1;
            --accent-text: #ffffff;
            --card-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --card-shadow-hover: 0 10px 15px -3px rgb(0 0 0 / 0.2), 0 4px 6px -4px rgb(0 0 0 / 0.2);
        }

        body { 
            font-family: 'Noto Sans SC', sans-serif; 
            background-color: var(--bg-primary); 
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        
        .landing-title { animation: fadeInUp 0.8s ease-out both; }
        .landing-p { animation: fadeInUp 0.8s ease-out 0.2s both; }
        .landing-btn { animation: fadeInUp 0.8s ease-out 0.4s both; }
        .landing-logo { animation: fadeInUp 0.8s ease-out 0.6s both; }

        /* Navigation */
        .nav-link { transition: all 0.2s ease-in-out; border-left: 4px solid transparent; color: var(--text-secondary); }
        .nav-link.active { background-color: rgba(79, 70, 229, 0.1); color: var(--accent-color); border-left-color: var(--accent-color); font-weight: 600; }
        .nav-link:not(.active):hover { background-color: var(--bg-muted); transform: translateX(2px); }
        .nav-header { font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; padding: 0.75rem 1rem; margin-top: 0.5rem; }
        
        /* Components with Theme Variables */
        .card { background-color: var(--bg-secondary); border-radius: 0.75rem; box-shadow: var(--card-shadow); transition: all 0.3s ease-in-out; border: 1px solid var(--border-color); }
        .card:hover { transform: translateY(-4px); box-shadow: var(--card-shadow-hover); }
        
        h2 { border-bottom: 2px solid var(--border-color); color: var(--text-primary); }
        h3 { color: var(--text-primary); }
        
        .bg-themed-secondary { background-color: var(--bg-secondary); }
        .border-themed { border-color: var(--border-color); }
        .bg-themed-muted { background-color: var(--bg-muted); }
        .text-themed-primary { color: var(--text-primary); }
        .text-themed-secondary { color: var(--text-secondary); }

        /* Shared Flame Styles */
        .flame-visual { position: absolute; bottom: 0; left: 50%; transform-origin: bottom center; width: 60%; margin-left: -30%; background: linear-gradient(to top, #ffde00, #ff8c00, rgba(255,140,0,0)); border-radius: 50% 50% 10% 10% / 100% 100% 20% 20%; transition: all 0.4s ease-in-out; animation: flicker-animation 0.3s infinite alternate; }
        #boiler-visual-container, #boiler-visual-container-ch7 { box-shadow: inset 0 0 15px rgba(0,0,0,0.5); border: 3px solid #475569; }
        @keyframes flicker-animation { 0% { transform: scaleY(1) skewX(0deg); opacity: 0.9; } 50% { transform: scaleY(0.98) skewX(2deg); opacity: 1; } 100% { transform: scaleY(1.02) skewX(-2deg); opacity: 0.95; } }

        .deployment-step { transition: all 0.3s ease; border-left-width: 4px; border-color: transparent; }
        .deployment-step.active { border-color: var(--accent-color); background-color: rgba(79, 70, 229, 0.1); }
        
        /* Code block style */
        pre { background-color: var(--bg-muted); padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-family: 'Courier New', Courier, monospace; font-size: 0.9em; color: var(--text-primary); }
        code { font-family: 'Courier New', Courier, monospace; }

        /* CMDP Lab Specific styles */
        .preview-component.hidden { display: none; }
        .preview-component.reward-highlight { background-color: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e; padding-left: 8px;}
        .preview-component.cost-highlight { background-color: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; padding-left: 8px; }

        /* Slider styles */
        .slider::-webkit-slider-thumb { background: var(--accent-color); box-shadow: 0 0 0 3px var(--bg-secondary), 0 0 0 4px var(--accent-color); }
        .slider::-moz-range-thumb { background: var(--accent-color); }

        /* Modal styles */
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 50; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-backdrop.visible { opacity: 1; pointer-events: auto; }
        .modal-content { background-color: var(--bg-secondary); padding: 2rem; border-radius: 0.75rem; max-width: 90%; width: 500px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.visible .modal-content { transform: scale(1); }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <section id="home-landing" class="min-h-screen flex flex-col justify-center items-center bg-gradient-to-br from-indigo-50 to-white dark:from-slate-900 dark:to-slate-800 p-4">
        <div class="max-w-3xl text-center">
            <h1 class="text-5xl md:text-6xl font-extrabold text-indigo-700 dark:text-indigo-400 mb-6 landing-title">æ™ºèƒ½é”…ç‚‰ä¼˜åŒ–å¹³å°</h1>
            <p class="text-lg text-slate-600 dark:text-slate-300 mb-8 max-w-2xl mx-auto landing-p">èåˆå¼ºåŒ–å­¦ä¹ ä¸å·¥ä¸šæœºç†ï¼Œé©±åŠ¨é”…ç‚‰èŠ‚èƒ½å‡æ’æ–°çºªå…ƒã€‚<br>ä¸ºç”µå‚æ™ºèƒ½åŒ–å‡çº§æä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚</p>
            <button id="start-experience-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-indigo-700 hover:shadow-xl transform hover:-translate-y-1 transition-all text-xl landing-btn">
                <i class="fa-solid fa-rocket mr-2"></i>ç«‹å³ä½“éªŒ
            </button>
            <div class="mt-12 flex justify-center gap-8 items-center landing-logo">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Southeast_University_logo.svg/1200px-Southeast_University_logo.svg.png" alt="ä¸œå—å¤§å­¦" class="h-16 rounded-full bg-white border-2 border-yellow-500 p-1" onerror="this.onerror=null;this.src='https://placehold.co/64x64/facc15/ffffff?text=SEU';" />
            </div>
        </div>
        <footer class="text-center text-slate-500 dark:text-slate-400 text-sm py-6 w-full absolute bottom-0 border-t border-slate-200 dark:border-slate-700">
            &copy; 2025 æ™ºèƒ½é”…ç‚‰ä¼˜åŒ–å¹³å° | æŠ€æœ¯æ”¯æŒï¼šHGC | 
            <i class="fa-solid fa-eye"></i> è®¿é—®é‡: <span id="visitor-count">åŠ è½½ä¸­...</span>
        </footer>
    </section>

    <!-- Main App Interface -->
    <div id="main-app" class="hidden">
        <div class="flex flex-col md:flex-row min-h-screen">
            <!-- Sidebar -->
            <aside class="w-full md:w-80 bg-themed-secondary border-r border-themed flex-shrink-0 flex flex-col">
                <div class="p-4 border-b border-themed">
                    <div class="flex items-center gap-3 cursor-pointer" id="main-logo">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Southeast_University_logo.svg/1200px-Southeast_University_logo.svg.png" alt="ä¸œå—å¤§å­¦" class="h-10 w-10 rounded-full bg-white p-0.5" onerror="this.onerror=null;this.src='https://placehold.co/40x40/facc15/ffffff?text=SEU';" />
                        <div>
                            <h1 class="text-xl font-bold text-indigo-500 dark:text-indigo-400">RLé”…ç‚‰ä¼˜åŒ–</h1>
                            <p class="text-xs text-themed-secondary mt-1">HGCå­¦ä¹ ä¸å®éªŒå¹³å°</p>
                        </div>
                    </div>
                </div>
                <nav id="main-nav" class="p-2 space-y-1 overflow-y-auto flex-grow">
                    <div class="nav-header">ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€ç¯‡</div>
                    <a href="#chapter1" data-view="chapter1" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-book-open w-5 text-center mr-3"></i> ç¬¬1ç« : é”…ç‚‰ç³»ç»ŸåŸç†</a>
                    <a href="#chapter2" data-view="chapter2" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-globe w-5 text-center mr-3"></i> ç¬¬2ç« : å¼ºåŒ–å­¦ä¹ ä¸–ç•Œè§‚</a>
                    
                    <div class="nav-header">ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒç®—æ³•</div>
                    <a href="#chapter3" data-view="chapter3" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-brain w-5 text-center mr-3"></i> ç¬¬3ç« : ä»RLåˆ°æ·±åº¦RL</a>
                    <a href="#chapter4" data-view="chapter4" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-masks-theater w-5 text-center mr-3"></i> ç¬¬4ç« : æ¼”å‘˜-è¯„è®ºå®¶æ¶æ„</a>
                    <a href="#chapter5" data-view="chapter5" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-lock w-5 text-center mr-3"></i> ç¬¬5ç« : PPOç®—æ³•è¯¦è§£</a>
                    <a href="#chapter6" data-view="chapter6" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-compass w-5 text-center mr-3"></i> ç¬¬6ç« : SACç®—æ³•è¯¦è§£</a>

                    <div class="nav-header">ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®è·µç¯‡</div>
                    <a href="#chapter7" data-view="chapter7" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-ruler-combined w-5 text-center mr-3"></i> ç¬¬7ç« : CMDPæ„å»ºå®éªŒå®¤</a>
                    <a href="#chapter8" data-view="chapter8" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-robot w-5 text-center mr-3"></i> ç¬¬8ç« : æ„å»ºæ•°å­—å­ªç”Ÿ</a>
                    <a href="#chapter9" data-view="chapter9" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-flask-vial w-5 text-center mr-3"></i> ç¬¬9ç« : è®­ç»ƒå®éªŒä¸è°ƒè¯•</a>

                    <div class="nav-header">ç¬¬å››éƒ¨åˆ†ï¼šéƒ¨ç½²ç¯‡</div>
                    <a href="#chapter10" data-view="chapter10" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-ship w-5 text-center mr-3"></i> ç¬¬10ç« : ä¸‰é˜¶æ®µå®‰å…¨éƒ¨ç½²</a>
                    <a href="#chapter11" data-view="chapter11" class="nav-link flex items-center p-3 rounded-lg font-medium"><i class="fa-solid fa-flag-checkered w-5 text-center mr-3"></i> ç¬¬11ç« : æ€»ç»“ä¸æœªæ¥</a>
                </nav>
                <div class="p-4 border-t border-themed">
                     <div id="user-info-panel" class="p-2 bg-themed-muted rounded-lg text-xs text-themed-secondary cursor-pointer hover:bg-opacity-80 transition">
                        <div class="flex items-center gap-2">
                           <i class="fa-solid fa-user-check text-green-500"></i>
                           <div>
                               <strong>å½“å‰ç”¨æˆ·:</strong>
                               <span id="user-id-display" class="font-mono block truncate">æœªç™»å½•</span>
                           </div>
                        </div>
                    </div>
                    <div class="mt-2 text-xs text-themed-secondary space-y-2">
                        <button id="contact-btn" class="w-full text-left p-2 rounded-md hover:bg-themed-muted transition flex items-center gap-2"><i class="fa-solid fa-envelope w-4"></i> è”ç³»æˆ‘ä»¬</button>
                        <button id="theme-toggle-btn" class="w-full text-left p-2 rounded-md hover:bg-themed-muted transition flex items-center gap-2">
                            <i id="theme-icon" class="fa-solid fa-moon w-4"></i>
                            <span id="theme-text">åˆ‡æ¢æ·±è‰²æ¨¡å¼</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="flex-1 p-4 md:p-8 bg-themed-primary overflow-y-auto">
                <!-- Chapter content will be injected here -->
                <section id="chapter1" class="content-section"></section>
                <section id="chapter2" class="content-section"></section>
                <section id="chapter3" class="content-section"></section>
                <section id="chapter4" class="content-section"></section>
                <section id="chapter5" class="content-section"></section>
                <section id="chapter6" class="content-section"></section>
                <section id="chapter7" class="content-section"></section>
                <section id="chapter8" class="content-section"></section>
                <section id="chapter9" class="content-section"></section>
                <section id="chapter10" class="content-section"></section>
                <section id="chapter11" class="content-section"></section>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="user-modal" class="modal-backdrop">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-indigo-500 dark:text-indigo-400 mb-4">æ‚¨çš„ä¸“å±ç”¨æˆ·å‡­è¯</h3>
            <p class="text-themed-secondary mb-4">æ‚¨å¥½ï¼ç³»ç»Ÿå·²ä¸ºæ‚¨åˆ†é…äº†ä¸€ä¸ªå”¯ä¸€çš„åŒ¿åç”¨æˆ·IDã€‚è¿™ä¸ªIDå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨æœªæ¥ä¸ºæ‚¨ä¿å­˜å­¦ä¹ è¿›åº¦æˆ–å®éªŒé…ç½®ã€‚</p>
            <div class="p-3 bg-themed-muted rounded-lg text-center font-mono break-all" id="modal-user-id"></div>
            <button id="close-user-modal-btn" class="mt-6 w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">å…³é—­</button>
        </div>
    </div>
    <div id="contact-modal" class="modal-backdrop">
        <div class="modal-content">
            <h3 class="text-xl font-bold text-indigo-500 dark:text-indigo-400 mb-4">è”ç³»æˆ‘ä»¬ / åé¦ˆ</h3>
            <p id="contact-intro" class="text-themed-secondary mb-6">æˆ‘ä»¬éå¸¸æ¬¢è¿æ‚¨çš„å»ºè®®å’Œåé¦ˆï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬ä¸æ–­æ”¹è¿›å¹³å°ã€‚</p>
            <div id="contact-success-msg" class="hidden p-4 mb-4 text-sm text-green-700 bg-green-100 rounded-lg dark:bg-green-200 dark:text-green-800" role="alert">
                <span class="font-medium">å‘é€æˆåŠŸ!</span> æ„Ÿè°¢æ‚¨çš„åé¦ˆã€‚
            </div>
            <form id="contact-form">
                <div class="space-y-4">
                    <div>
                        <label for="contact-name" class="block text-sm font-medium text-themed-secondary">å§“å</label>
                        <input type="text" id="contact-name" class="mt-1 block w-full bg-themed-muted border border-themed rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="contact-email" class="block text-sm font-medium text-themed-secondary">é‚®ç®±</label>
                        <input type="email" id="contact-email" class="mt-1 block w-full bg-themed-muted border border-themed rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="contact-message" class="block text-sm font-medium text-themed-secondary">å†…å®¹</label>
                        <textarea id="contact-message" rows="4" class="mt-1 block w-full bg-themed-muted border border-themed rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button type="button" id="close-contact-modal-btn" class="bg-themed-muted text-themed-primary font-bold py-2 px-4 rounded-lg hover:bg-opacity-80 transition-colors">å–æ¶ˆ</button>
                    <button type="submit" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">æäº¤</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, runTransaction } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration and Initialization ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'rl-boiler-app';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, auth, db;

        if (firebaseConfig) {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                console.log("Firebase initialized successfully.");
                setupAuthListener();
                incrementAndShowVisitorCount();
            } catch (e) {
                console.error("Firebase initialization failed:", e);
                displayFirebaseError();
            }
        } else {
            console.warn("Firebase config not found. Features like visitor count and user ID will be disabled.");
            displayFirebaseError();
        }

        // --- Authentication ---
        function setupAuthListener() {
            onAuthStateChanged(auth, user => {
                const userIdDisplay = document.getElementById('user-id-display');
                if (user) {
                    userIdDisplay.textContent = user.uid;
                    document.getElementById('modal-user-id').textContent = user.uid;
                } else {
                    signIn();
                }
            });
        }

        async function signIn() {
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Error signing in:", error);
                document.getElementById('user-id-display').textContent = "ç™»å½•å¤±è´¥";
            }
        }

        // --- Visitor Counter ---
        async function incrementAndShowVisitorCount() {
            if (!db) return;
            const visitorCountEl = document.getElementById('visitor-count');
            const counterRef = doc(db, `artifacts/${appId}/public/data/analytics`, 'page_views');

            try {
                await runTransaction(db, async (transaction) => {
                    const counterDoc = await transaction.get(counterRef);
                    const newCount = counterDoc.exists() ? counterDoc.data().count + 1 : 1;
                    transaction.set(counterRef, { count: newCount }, { merge: true });
                });
                const finalDoc = await getDoc(counterRef);
                if (finalDoc.exists()) {
                    visitorCountEl.textContent = finalDoc.data().count;
                }
            } catch (e) {
                console.error("Failed to update visitor count:", e);
                visitorCountEl.textContent = 'N/A';
            }
        }

        function displayFirebaseError() {
            document.getElementById('visitor-count').textContent = 'æœåŠ¡ä¸å¯ç”¨';
            document.getElementById('user-id-display').textContent = 'æœåŠ¡ä¸å¯ç”¨';
        }

        // --- Main Application Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            // --- Chapter Content Injection ---
            const chapterContents = {
                chapter1: `
                    <h2>ç¬¬1ç« : é”…ç‚‰ç³»ç»ŸåŸç†</h2>
                    <p class="text-lg text-themed-secondary mb-6">åœ¨åº”ç”¨ä»»ä½•é«˜çº§ç®—æ³•ä¹‹å‰ï¼Œå¿…é¡»å¯¹è¢«æ§å¯¹è±¡â€”â€”é”…ç‚‰ï¼Œæœ‰æ·±åˆ»çš„ç‰©ç†å’Œå·¥ç¨‹ç†è§£ã€‚æœ¬ç« å°†å¸¦æ‚¨æ·±å…¥äº†è§£é”…ç‚‰èƒŒåçš„æ ¸å¿ƒçŸ›ç›¾ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªè¿›åŒ–ç‰ˆçš„äº’åŠ¨æ²™ç®±ï¼Œè®©æ‚¨äº²æ‰‹æ„Ÿå—åœ¨åŠ¨æ€å·¥å†µä¸‹æ§åˆ¶é”…ç‚‰çš„æŒ‘æˆ˜ã€‚</p>
                    <div class="card p-6 mb-6">
                        <h3 class="text-xl font-bold">ç³»ç»Ÿç»„ä»¶ä¸çƒ­åŠ›å¾ªç¯</h3>
                        <p class="text-themed-secondary mb-4">é”…ç‚‰å¹¶éå­¤ç«‹è®¾å¤‡ï¼Œè€Œæ˜¯å‘ç”µå‚çƒ­åŠ›ç³»ç»Ÿçš„æ ¸å¿ƒã€‚å®ƒé€šè¿‡ç‡ƒçƒ§ç‡ƒæ–™ï¼ˆå¦‚ç…¤ç²‰ï¼‰äº§ç”Ÿé«˜æ¸©é«˜å‹è’¸æ±½ï¼Œé©±åŠ¨æ±½è½®æœºåšåŠŸå‘ç”µã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨çƒ­åŠ›å­¦ä¸Šéµå¾ªç»å…¸çš„**æœ—è‚¯å¾ªç¯**ã€‚ç†è§£è¿™ä¸€å¾ªç¯æœ‰åŠ©äºæˆ‘ä»¬æ˜ç¡®é”…ç‚‰åœ¨æ•´ä¸ªå‘ç”µæµç¨‹ä¸­çš„è§’è‰²ï¼šå®ƒæ˜¯ä¸€ä¸ªèƒ½é‡è½¬æ¢å™¨ï¼Œå°†ç‡ƒæ–™çš„åŒ–å­¦èƒ½é«˜æ•ˆåœ°è½¬åŒ–ä¸ºè’¸æ±½çš„çƒ­èƒ½ã€‚</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                            <div id="boiler-diagram-container" class="p-2 bg-themed-secondary rounded-lg shadow-inner"></div>
                            <div id="rankine-diagram-container" class="p-2 bg-themed-secondary rounded-lg shadow-inner"></div>
                        </div>
                        <p class="text-sm text-themed-secondary mt-2 text-center">å·¦ï¼šå…¸å‹ç…¤ç²‰é”…ç‚‰ç³»ç»Ÿç¤ºæ„å›¾ã€‚å³ï¼šç†æƒ³æœ—è‚¯å¾ªç¯T-så›¾ã€‚</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-xl font-bold">åŠ¨æ€å·¥å†µé”…ç‚‰æ²™ç®±</h3>
                        <p class="text-themed-secondary mb-6">æˆ‘ä»¬å¼•å…¥äº†"é”…ç‚‰è´Ÿè·"ä½œä¸ºå…³é”®çš„å¤–éƒ¨æ‰°åŠ¨ã€‚è´Ÿè·ä»£è¡¨äº†ç”µç½‘å¯¹å‘ç”µæœºç»„çš„ç”µåŠ›éœ€æ±‚ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯åœ¨ä¸åŒè´Ÿè·ä¸‹ï¼Œé€šè¿‡è°ƒèŠ‚æ§åˆ¶å˜é‡ï¼ˆåŠ¨ä½œï¼‰ï¼Œä½¿å„é¡¹æŒ‡æ ‡ï¼ˆçŠ¶æ€ï¼‰å°½å¯èƒ½æ¥è¿‘ç›®æ ‡å€¼ï¼Œä½“éªŒå¤šç›®æ ‡ä¼˜åŒ–çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚</p>
                        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                            <div class="lg:col-span-2 bg-themed-muted p-6 rounded-lg">
                                <h4 class="font-bold text-lg mb-4">ğŸ•¹ï¸ æ§åˆ¶ä¸å·¥å†µé¢æ¿</h4>
                                <div class="space-y-6">
                                    <div>
                                        <label for="load-slider" class="font-medium flex justify-between">é”…ç‚‰è´Ÿè· (æ‰°åŠ¨): <span id="load-value" class="font-bold text-red-500">75</span>%</label>
                                        <input type="range" id="load-slider" min="50" max="100" value="75" class="slider w-full">
                                    </div>
                                    <div class="border-t border-themed pt-4">
                                        <label for="air-total-slider" class="font-medium flex justify-between">æ€»é£é‡ (åŠ¨ä½œ): <span id="air-total-value">75</span>%</label>
                                        <input type="range" id="air-total-slider" min="50" max="100" value="75" class="slider w-full">
                                    </div>
                                    <div>
                                        <label for="burner-tilt-slider" class="font-medium flex justify-between">ç‡ƒçƒ§å™¨æ‘†è§’ (åŠ¨ä½œ): <span id="burner-tilt-value">0</span>Â°</label>
                                        <input type="range" id="burner-tilt-slider" min="-15" max="15" value="0" class="slider w-full">
                                    </div>
                                    <div>
                                        <label for="o2-dist-slider" class="font-medium flex justify-between">ç‡ƒå°½é£(OFA)å æ¯” (åŠ¨ä½œ): <span id="o2-dist-value">30</span>%</label>
                                        <input type="range" id="o2-dist-slider" min="10" max="50" value="30" class="slider w-full">
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-3">
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                     <div class="p-4 rounded-lg bg-slate-700 flex flex-col items-center justify-center min-h-[300px]">
                                         <h4 class="font-bold text-lg mb-2 text-white">ğŸ”¥ ç‚‰è†›ç«ç„°</h4>
                                         <div id="boiler-visual-container" class="w-48 h-64 bg-slate-800 rounded-t-lg relative overflow-hidden"><div id="flame-visual" class="flame-visual"></div></div>
                                     </div>
                                     <div class="p-4 rounded-lg bg-themed-muted flex flex-col justify-between">
                                         <h4 class="font-bold text-lg mb-4">ğŸ“ˆ å…³é”®æŒ‡æ ‡</h4>
                                         <div class="space-y-4">
                                             <div>
                                                 <label class="font-medium flex justify-between">æ°®æ°§åŒ–ç‰© (NOx) <span class="text-sm text-themed-secondary">ç›®æ ‡: &lt;50</span></label>
                                                 <div class="w-full bg-slate-200 dark:bg-slate-600 rounded-full h-4"><div id="nox-meter-fill" class="bg-red-500 h-4 rounded-full transition-all duration-300"></div></div>
                                             </div>
                                             <div>
                                                 <label class="font-medium flex justify-between">ä¸€æ°§åŒ–ç¢³ (CO) <span class="text-sm text-themed-secondary">ç›®æ ‡: &lt;40</span></label>
                                                 <div class="w-full bg-slate-200 dark:bg-slate-600 rounded-full h-4"><div id="co-meter-fill" class="bg-amber-500 h-4 rounded-full transition-all duration-300"></div></div>
                                             </div>
                                             <div>
                                                 <label class="font-medium flex justify-between">é”…ç‚‰çƒ­æ•ˆç‡ <span class="text-sm text-themed-secondary">ç›®æ ‡: &gt;93%</span></label>
                                                 <div class="text-right"><span id="efficiency-value" class="text-2xl font-bold text-green-600">92.50</span> %</div>
                                             </div>
                                         </div>
                                     </div>
                                 </div>
                            </div>
                        </div>
                    </div>
                    <div class="card p-6 mt-6">
                        <h3 class="text-xl font-bold">æ ¸å¿ƒçŸ›ç›¾ï¼šå¸•ç´¯æ‰˜æœ€ä¼˜å‰æ²¿</h3>
                        <p class="text-themed-secondary mb-6">é”…ç‚‰ä¼˜åŒ–çš„æœ¬è´¨æ˜¯åœ¨å¤šä¸ªç›¸äº’å†²çªçš„ç›®æ ‡ä¹‹é—´å¯»æ‰¾æœ€ä½³å¹³è¡¡ç‚¹ã€‚ä¾‹å¦‚ï¼Œé™ä½NOxæ’æ”¾å¯èƒ½ä¼šå¢åŠ COæ’æ”¾å¹¶é™ä½çƒ­æ•ˆç‡ã€‚è¿™ä¸ªæœ€ä½³å¹³è¡¡ç‚¹çš„é›†åˆè¢«ç§°ä¸º"å¸•ç´¯æ‰˜æœ€ä¼˜å‰æ²¿"ã€‚RLæ™ºèƒ½ä½“çš„ä»»åŠ¡ï¼Œå°±æ˜¯åœ¨ä¸åŒå·¥å†µä¸‹ï¼Œæ‰¾åˆ°å¹¶ç»´æŒåœ¨è¿™ä¸€å‰æ²¿ä¸Šçš„æœ€ä¼˜å·¥ä½œç‚¹ã€‚ä¸‹å›¾å±•ç¤ºäº†çƒ­æ•ˆç‡ä¸NOxæ’æ”¾çš„å…³ç³»ï¼Œè¯·å°è¯•è°ƒèŠ‚æ§åˆ¶å˜é‡ï¼Œè®©"å½“å‰å·¥ä½œç‚¹"å°½å¯èƒ½åœ°æ¥è¿‘å·¦ä¸Šæ–¹çš„"å¸•ç´¯æ‰˜å‰æ²¿"è™šçº¿ã€‚</p>
                        <div class="p-4 bg-themed-muted rounded-lg"><canvas id="pareto-chart" height="120"></canvas></div>
                    </div>
                `,
                chapter2: `
                    <h2>ç¬¬2ç« : å¼ºåŒ–å­¦ä¹ ä¸–ç•Œè§‚</h2>
                    <p class="text-lg text-themed-secondary mb-6">å¼ºåŒ–å­¦ä¹ (RL)æ˜¯ä¸€ç§é€šè¿‡"è¯•é”™"æ¥å­¦ä¹ çš„æœºå™¨å­¦ä¹ èŒƒå¼ã€‚æ™ºèƒ½ä½“(Agent)åœ¨ä¸ç¯å¢ƒ(Environment)çš„äº¤äº’ä¸­ï¼Œæ ¹æ®è·å¾—çš„å¥–åŠ±(Reward)æˆ–æƒ©ç½šæ¥å­¦ä¹ å¦‚ä½•é€‰æ‹©åŠ¨ä½œ(Action)ï¼Œä»¥æœ€å¤§åŒ–é•¿æœŸç´¯ç§¯å¥–åŠ±ã€‚</p>
                     <div class="card p-6 mb-6">
                         <h3 class="text-xl font-bold">2.1 é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ (MDP)</h3>
                         <p class="text-themed-secondary mb-4">RLé—®é¢˜é€šå¸¸è¢«æ•°å­¦åŒ–åœ°æè¿°ä¸ºé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ (MDP)ï¼Œä¸€ä¸ªç”±äº”å…ƒç»„æ„æˆçš„æ¨¡å‹ï¼š $(S, A, P, R, \\gamma)$</p>
                         <ul class="list-disc list-inside space-y-2 text-themed-secondary bg-themed-muted p-4 rounded-lg">
                            <li><b>S (State)</b>: çŠ¶æ€é›†åˆã€‚åœ¨é”…ç‚‰é—®é¢˜ä¸­ï¼Œè¿™å¯ä»¥æ˜¯ $\{ä¸»è’¸æ±½å‹åŠ›, ä¸»è’¸æ±½æ¸©åº¦, O_2å«é‡, ...\}$ã€‚</li>
                            <li><b>A (Action)</b>: åŠ¨ä½œé›†åˆã€‚ä¾‹å¦‚ $\{æ€»é£é—¨å¼€åº¦, ç‡ƒçƒ§å™¨æ‘†è§’, ...\}$ã€‚</li>
                            <li><b>P (Transition Probability)</b>: çŠ¶æ€è½¬ç§»æ¦‚ç‡ $P(s'|s,a)$ã€‚å³åœ¨çŠ¶æ€ $s$ ä¸‹æ‰§è¡ŒåŠ¨ä½œ $a$ åï¼Œè½¬ç§»åˆ°çŠ¶æ€ $s'$ çš„æ¦‚ç‡ã€‚</li>
                            <li><b>R (Reward Function)</b>: å¥–åŠ±å‡½æ•° $R(s,a,s')$ã€‚æ‰§è¡ŒåŠ¨ä½œåå¾—åˆ°çš„å³æ—¶å¥–åŠ±ã€‚</li>
                            <li><b>$\\gamma$ (Discount Factor)</b>: æŠ˜æ‰£å› å­ï¼Œå–å€¼åœ¨ $[0, 1]$ ä¹‹é—´ï¼Œå†³å®šäº†æœªæ¥å¥–åŠ±çš„é‡è¦æ€§ã€‚</li>
                         </ul>
                    </div>
                    <div class="card p-6 mb-6">
                         <h3 class="text-xl font-bold">2.2 è´å°”æ›¼æ–¹ç¨‹ï¼šä»·å€¼å­¦ä¹ çš„æ ¸å¿ƒ</h3>
                         <p class="text-themed-secondary mb-4">RLçš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜ç­–ç•¥ $\\pi^*(a|s)$ã€‚ä¸ºäº†è¯„ä¼°ç­–ç•¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†çŠ¶æ€ä»·å€¼å‡½æ•° $V^\\pi(s)$ï¼Œå®ƒéµå¾ªè‘—åçš„è´å°”æ›¼æœŸæœ›æ–¹ç¨‹ï¼š</p>
                         <div class="p-4 my-2 bg-themed-muted rounded text-center text-lg">$$V^\\pi(s) = \\mathbb{E}_{\\pi} [R_{t+1} + \\gamma V^\\pi(S_{t+1}) | S_t=s]$$</div>
                         <p class="text-themed-secondary mt-4">è¿™ä¸ªå…¬å¼å°†å¤æ‚ã€é•¿æœŸçš„å›æŠ¥é—®é¢˜ï¼Œåˆ†è§£ä¸ºäº†ä¸€ä¸ªå½“å‰å¥–åŠ±å’Œä¸‹ä¸€çŠ¶æ€ä»·å€¼çš„é€’å½’å…³ç³»ï¼Œæ˜¯æ‰€æœ‰ä»·å€¼å­¦ä¹ ç®—æ³•çš„åŸºçŸ³ã€‚</p>
                    </div>
                    <div class="card p-6 mb-6">
                           <h3 class="text-xl font-bold">2.3 RLç®—æ³•å…¨æ™¯å›¾</h3>
                           <p class="text-themed-secondary mb-4">RLç®—æ³•ç§ç±»ç¹å¤šï¼Œä½†å¯ä»¥æ ¹æ®å‡ ä¸ªå…³é”®ç»´åº¦è¿›è¡Œåˆ†ç±»ã€‚ä¸‹å›¾ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„åˆ†ç±»æ¡†æ¶ï¼Œå¸®åŠ©æ‚¨ç†è§£ä¸åŒç®—æ³•ä¹‹é—´çš„å…³ç³»ã€‚</p>
                           <div id="rl-taxonomy-container" class="p-4 bg-themed-muted rounded-lg flex justify-center"></div>
                </div>
                    <div class="card p-6">
                        <h3 class="text-xl font-bold">2.4 äº¤äº’å¼åŠ¨æ€è§„åˆ’æ±‚è§£å™¨</h3>
                        <p class="text-themed-secondary mb-4">åŠ¨æ€è§„åˆ’(DP)æ˜¯è§£å†³å·²çŸ¥æ¨¡å‹MDPçš„åŸºç¡€æ–¹æ³•ã€‚è™½ç„¶åœ¨ç°å®ä¸­æˆ‘ä»¬é€šå¸¸ä¸çŸ¥é“ç²¾ç¡®æ¨¡å‹ï¼Œä½†ç†è§£å®ƒçš„å·¥ä½œåŸç†æ˜¯ç†è§£æ›´é«˜çº§çš„æ— æ¨¡å‹ç®—æ³•çš„åŸºçŸ³ã€‚ä¸‹é¢ï¼Œæ‚¨å¯ä»¥äº²æ‰‹æ“ä½œ<b>ä»·å€¼è¿­ä»£</b>å’Œ<b>ç­–ç•¥è¿­ä»£</b>ã€‚</p>
                        <div class="flex flex-col md:flex-row gap-6 items-center">
                            <div class="flex-shrink-0"><canvas id="bellman-canvas" width="400" height="400" class="border border-themed rounded-lg bg-themed-secondary"></canvas></div>
                            <div class="space-y-4">
                                <div class="flex gap-2">
                                    <button id="iterate-bellman-btn" class="flex-1 bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors">è¿­ä»£ä¸€æ­¥ (Step)</button>
                                    <button id="reset-bellman-btn" class="bg-slate-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-600 transition-colors">é‡ç½®</button>
                                </div>
                                 <div class="p-2 bg-themed-muted rounded-lg">
                                     <label for="dp-method-select" class="text-sm font-bold">é€‰æ‹©ç®—æ³•:</label>
                                     <select id="dp-method-select" class="w-full p-2 rounded border-themed bg-themed-secondary"><option value="vi">ä»·å€¼è¿­ä»£</option><option value="pi">ç­–ç•¥è¿­ä»£</option></select>
                                 </div>
                                <div class="text-sm p-4 bg-themed-muted rounded-lg">
                                    <p><strong>è¿­ä»£æ¬¡æ•°:</strong> <span id="bellman-iteration-count">0</span></p>
                                    <p><strong>å½“å‰é˜¶æ®µ:</strong> <span id="pi-phase-info">--</span></p>
                                    <p class="mt-2"><b>ä»·å€¼è¿­ä»£:</b> ç›´æ¥è¿­ä»£æ›´æ–°ä»·å€¼å‡½æ•°ï¼Œç›´åˆ°æ”¶æ•›å¾—åˆ°æœ€ä¼˜ä»·å€¼ã€‚</p>
                                    <p class="mt-2"><b>ç­–ç•¥è¿­ä»£:</b> åœ¨"ç­–ç•¥è¯„ä¼°"å’Œ"ç­–ç•¥æå‡"ä¸¤ä¸ªé˜¶æ®µé—´äº¤æ›¿è¿›è¡Œã€‚</p>
                                </div>
                                <div id="bellman-update-info" class="text-sm text-center font-mono h-8"></div>
                            </div>
                        </div>
                    </div>
                `,
                chapter3: `
                    <h2>ç¬¬3ç« : ä»RLåˆ°æ·±åº¦RL</h2>
                    <p class="text-lg text-themed-secondary mb-6">ç»å…¸RLæ–¹æ³•ä½¿ç”¨è¡¨æ ¼å­˜å‚¨ä»·å€¼ï¼Œä½†è¿™åœ¨çŠ¶æ€ç©ºé—´å·¨å¤§æ—¶ï¼ˆç»´åº¦ç¾éš¾ï¼‰ä¸å¯è¡Œã€‚æ·±åº¦å­¦ä¹ é€šè¿‡ä½¿ç”¨ç¥ç»ç½‘ç»œä½œä¸ºå¼ºå¤§çš„å‡½æ•°é€¼è¿‘å™¨ï¼Œå‚¬ç”Ÿäº†æ·±åº¦å¼ºåŒ–å­¦ä¹ ï¼ˆDRLï¼‰ï¼Œå½»åº•æ”¹å˜äº†è¿™ä¸€é¢†åŸŸã€‚</p>
                     <div class="card p-6 mb-6">
                         <h3 class="text-xl font-bold">å‡½æ•°é€¼è¿‘çš„å¿…è¦æ€§</h3>
                         <p class="text-themed-secondary mb-4">é”…ç‚‰çš„çŠ¶æ€ç”±å¤šä¸ªè¿ç»­å˜é‡æè¿°ï¼Œæ€»çŠ¶æ€æ•°æ˜¯å¤©æ–‡æ•°å­—ã€‚ç¥ç»ç½‘ç»œï¼ˆNNï¼‰çš„æ³›åŒ–èƒ½åŠ›ä½¿å…¶ä¸éœ€è§è¿‡æ‰€æœ‰çŠ¶æ€ï¼Œå°±èƒ½å­¦ä¹ ä»é«˜ç»´è¾“å…¥åˆ°æœŸæœ›è¾“å‡ºçš„å¤æ‚æ˜ å°„ã€‚æˆ‘ä»¬ç”¨å¸¦å‚æ•° $\\theta$ çš„å‡½æ•°æ¥é€¼è¿‘ä»·å€¼æˆ–ç­–ç•¥å‡½æ•°ï¼š</p>
                         <ul class="list-disc list-inside space-y-2 text-themed-secondary">
                             <li><b>ä»·å€¼å‡½æ•°é€¼è¿‘</b>: $V(s; \\theta) \\approx V^*(s)$ æˆ– $Q(s, a; \\theta) \\approx Q^*(s, a)$ã€‚</li>
                             <li><b>ç­–ç•¥å‡½æ•°é€¼è¿‘</b>: ç›´æ¥å­¦ä¹ ä¸€ä¸ªå¸¦å‚æ•°çš„ç­–ç•¥ $\\pi(a|s; \\theta)$ã€‚</li>
                         </ul>
                     </div>
                    <div class="card p-6">
                        <h3 class="text-xl font-bold">æ·±åº¦Qç½‘ç»œ (DQN)</h3>
                        <p class="text-themed-secondary mb-4">DQNæ˜¯DRLçš„å¼€åˆ›æ€§å·¥ä½œï¼Œå®ƒæˆåŠŸåœ°å°†æ·±åº¦å­¦ä¹ ä¸Q-Learningç»“åˆã€‚DQNå¼•å…¥äº†ä¸¤ä¸ªå…³é”®æŠ€æœ¯æ¥è§£å†³è®­ç»ƒä¸ç¨³å®šçš„é—®é¢˜ï¼Œè‡³ä»Šä»æ˜¯è®¸å¤šç°ä»£DRLç®—æ³•çš„åŸºçŸ³ï¼š</p>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                             <div class="p-4 bg-blue-500/10 rounded-lg">
                                 <h4 class="font-bold text-blue-600 dark:text-blue-400">ç»éªŒå›æ”¾ (Experience Replay)</h4>
                                  <p class="text-sm mt-2">æ™ºèƒ½ä½“ä¸ç¯å¢ƒäº¤äº’çš„ç»éªŒ $(s_t, a_t, r_t, s_{t+1})$ è¢«å­˜å‚¨åœ¨"å›æ”¾æ± "ä¸­ã€‚è®­ç»ƒæ—¶ï¼Œéšæœºé‡‡æ ·ä¸€ä¸ªå°æ‰¹é‡æ•°æ®è¿›è¡Œæ›´æ–°ã€‚è¿™æ‰“ç ´äº†æ•°æ®ç›¸å…³æ€§ï¼Œå¹¶æé«˜äº†æ•°æ®åˆ©ç”¨æ•ˆç‡ã€‚</p>
                             </div>
                             <div class="p-4 bg-green-500/10 rounded-lg">
                                 <h4 class="font-bold text-green-600 dark:text-green-400">ç›®æ ‡ç½‘ç»œ (Target Network)</h4>
                                 <p class="text-sm mt-2">ä½¿ç”¨ä¸¤ä¸ªç½‘ç»œï¼šä¸€ä¸ªé¢‘ç¹æ›´æ–°çš„åœ¨çº¿ç½‘ç»œ $Q(s, a; \\theta)$ï¼Œå’Œä¸€ä¸ªå®šæœŸä»åœ¨çº¿ç½‘ç»œå¤åˆ¶æƒé‡çš„ç›®æ ‡ç½‘ç»œ $Q(s', a'; \\theta')$ã€‚åœ¨è®¡ç®—TDç›®æ ‡æ—¶ä½¿ç”¨å›ºå®šçš„ç›®æ ‡ç½‘ç»œï¼Œæå¤§åœ°å¢å¼ºäº†è®­ç»ƒçš„ç¨³å®šæ€§ã€‚</p>
                                 <div class="p-2 my-2 bg-themed-muted rounded text-center text-sm">$$L(\\theta) = \\mathbb{E}_{(s,a,r,s') \\sim D} \\left[ (r + \\gamma \\max_{a'} Q(s', a'; \\theta') - Q(s, a; \\theta))^2 \\right]$$</div>
                             </div>
                         </div>
                    </div>
                `,
                chapter4: `
                    <h2>ç¬¬4ç« : æ¼”å‘˜-è¯„è®ºå®¶æ¶æ„</h2>
                    <p class="text-lg text-themed-secondary mb-6">æ¼”å‘˜-è¯„è®ºå®¶ï¼ˆActor-Critic, ACï¼‰æ–¹æ³•æ˜¯ç°ä»£RLç®—æ³•çš„æ”¯æŸ±ï¼Œå®ƒç»“åˆäº†ç­–ç•¥å­¦ä¹ å’Œä»·å€¼å­¦ä¹ çš„ä¼˜ç‚¹ã€‚ACæ–¹æ³•çš„æ ¸å¿ƒæ˜¯åŒæ—¶ç»´æŠ¤ä¸¤ä¸ªæ¨¡å‹ï¼š</p>
                    <div class="card p-6 mb-6">
                        <h3 class="text-xl font-bold">æ¼”å‘˜ä¸è¯„è®ºå®¶çš„è§’è‰²åˆ†å·¥</h3>
                        <ul class="list-disc list-inside space-y-2 text-themed-secondary">
                            <li><b>æ¼”å‘˜ (Actor)</b>: äº§å‡ºåŠ¨ä½œã€‚å®ƒæ˜¯ä¸€ä¸ªå‚æ•°åŒ–çš„ç­–ç•¥ $\\pi_\\theta(a|s)$ï¼Œç›®æ ‡æ˜¯è°ƒæ•´å‚æ•° $\\theta$ æ¥è·å¾—æ›´é«˜çš„åˆ†æ•°ã€‚</li>
                            <li><b>è¯„è®ºå®¶ (Critic)</b>: è¯„ä»·æ¼”å‘˜çš„åŠ¨ä½œæœ‰å¤šå¥½ã€‚å®ƒæ˜¯ä¸€ä¸ªå‚æ•°åŒ–çš„ä»·å€¼å‡½æ•°ï¼Œå¦‚ $Q_\\phi(s,a)$ æˆ– $V_\\phi(s)$ã€‚</li>
                        </ul>
                        <p class="text-themed-secondary mt-4">ä¸¤è€…ååŒå·¥ä½œï¼šæ¼”å‘˜æ‰§è¡ŒåŠ¨ä½œï¼Œè¯„è®ºå®¶è¯„ä»·ï¼Œæ¼”å‘˜æ ¹æ®åé¦ˆè°ƒæ•´ã€‚è¿™ç§æ–¹å¼æ¯”å•çº¯çš„ç­–ç•¥æ¢¯åº¦æ–¹æ³•æ–¹å·®æ›´å°ï¼ŒåŒæ—¶åˆèƒ½å¤„ç†DQNéš¾ä»¥å¤„ç†çš„è¿ç»­åŠ¨ä½œç©ºé—´ã€‚</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-xl font-bold">åŠ¨æ€æ¼”ç¤ºï¼šä¿¡æ¯ä¸ä¼˜åŠ¿å‡½æ•°æµåŠ¨è¿‡ç¨‹</h3>
                        <p class="text-themed-secondary mb-4">ç‚¹å‡»æ’­æ”¾ä¸‹é¢çš„åŠ¨ç”»ï¼Œè§‚å¯Ÿä¸€ä¸ªå…¸å‹çš„ACæ›´æ–°å‘¨æœŸã€‚ç‰¹åˆ«æ³¨æ„ï¼Œè¯„è®ºå®¶ä¼šè®¡ç®—å‡º**ä¼˜åŠ¿å‡½æ•° $A(s,a) = Q(s,a) - V(s)$**ï¼Œè¿™ä¸ªä¿¡å·æ˜¯æŒ‡å¯¼æ¼”å‘˜æ›´æ–°ç­–ç•¥çš„æ ¸å¿ƒä¾æ®ï¼Œå®ƒå›ç­”äº†"åœ¨çŠ¶æ€sä¸‹ï¼Œæ‰§è¡ŒåŠ¨ä½œaæ¯”å¹³å‡æ¥çœ‹æœ‰å¤šå¥½ï¼Ÿ"è¿™ä¸ªé—®é¢˜ã€‚</p>
                        <div class="text-center mb-4"><button id="play-ac-viz" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">â–¶ï¸ æ’­æ”¾æµç¨‹</button></div>
                        <div id="ac-viz-explanation" class="text-center font-semibold h-10 mb-2"></div>
                        <div id="ac-diagram-container" class="flex justify-center"></div>
                    </div>
                `,
                chapter5: `
                    <h2>ç¬¬5ç« : PPOç®—æ³•è¯¦è§£</h2>
                    <p class="text-lg text-themed-secondary mb-6">è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–ï¼ˆPPOï¼‰æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„RLç®—æ³•ä¹‹ä¸€ï¼Œä»¥å…¶å“è¶Šçš„ç¨³å®šæ€§å’Œæ€§èƒ½è€Œé—»åã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨æ›´æ–°ç­–ç•¥æ—¶ï¼Œæ­¥å­ä¸èƒ½è¿ˆå¾—å¤ªå¤§ã€‚å®ƒé€šè¿‡ä¸€ä¸ª"è£å‰ª"æœºåˆ¶ï¼Œå°†ç­–ç•¥æ›´æ–°é™åˆ¶åœ¨ä¸€ä¸ªå¯ä¿¡çš„"ä¿¡ä»»åŸŸ"å†…ã€‚</p>
                    <div class="card p-6">
                        <h3 class="text-xl font-bold">äº¤äº’å¼ç†è§£ï¼šå¯è°ƒèŠ‚çš„ä¿¡ä»»åŸŸè£å‰ª</h3>
                        <p class="text-themed-secondary mb-4">ä»¤ $r_t(\\theta) = \\frac{\\pi_\\theta(a_t|s_t)}{\\pi_{\\theta_{old}}(a_t|s_t)}$ ä¸ºæ–°æ—§ç­–ç•¥çš„æ¦‚ç‡æ¯”ã€‚è¯·æ‹–åŠ¨ $\\epsilon$ æ»‘å—æ¥è°ƒæ•´ä¿¡ä»»åŸŸå¤§å°ï¼Œå¹¶åˆ‡æ¢"å¥½åŠ¨ä½œ"ï¼ˆä¼˜åŠ¿ $\\hat{A}_t > 0$ï¼‰å’Œ"ååŠ¨ä½œ"ï¼ˆ$\\hat{A}_t < 0$ï¼‰çš„æƒ…æ™¯ï¼Œè§‚å¯Ÿç›®æ ‡å‡½æ•°ï¼ˆè“è‰²å®çº¿ï¼‰å¦‚ä½•è¢«è£å‰ªè¾¹ç•Œï¼ˆçº¢è‰²è™šçº¿ï¼‰æ‰€é™åˆ¶ã€‚</p>
                        <div class="flex justify-center items-center gap-6 mb-4">
                            <button id="ppo-toggle-advantage" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">åˆ‡æ¢åˆ° "ååŠ¨ä½œ"</button>
                            <div class="w-64">
                                 <label for="epsilon-slider" class="font-medium flex justify-between">è£å‰ªèŒƒå›´ $\\epsilon$: <span id="epsilon-value">0.2</span></label>
                                 <input type="range" id="epsilon-slider" min="0.05" max="0.5" step="0.01" value="0.2" class="slider w-full h-2 bg-themed-muted rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>
                        <canvas id="ppo-canvas" class="w-full h-64 bg-themed-muted border border-themed rounded-lg"></canvas>
                        <p id="ppo-explanation" class="text-center mt-2 font-medium"></p>
                    </div>
                     <div class="card p-6 mt-6">
                         <h3 class="text-xl font-bold">PPOæ ¸å¿ƒç»„ä»¶ä¸ä¼ªä»£ç </h3>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                             <div class="space-y-4">
                                 <div class="p-4 bg-blue-500/10 rounded-lg">
                                     <h4 class="font-bold text-blue-600 dark:text-blue-400">è£å‰ªä»£ç†ç›®æ ‡</h4>
                                      <p class="text-sm mt-2">è¿™æ˜¯PPOçš„æ ¸å¿ƒåˆ›æ–°ã€‚å®ƒåœ¨ä¼ ç»Ÿç­–ç•¥æ¢¯åº¦ç›®æ ‡å’Œè£å‰ªç‰ˆæœ¬é—´å–æœ€å°å€¼ï¼Œé™åˆ¶äº†ç­–ç•¥æ›´æ–°çš„å¹…åº¦ï¼Œé¿å…ç­–ç•¥çªå˜ã€‚</p>
                                      <div class="p-2 my-2 bg-themed-muted rounded text-center">$$L^{CLIP}(\\theta) = \\mathbb{E}_t \\left[ \\min\\left(r_t(\\theta)\\hat{A}_t, \\text{clip}(r_t(\\theta), 1-\\epsilon, 1+\\epsilon)\\hat{A}_t\\right) \\right]$$</div>
                                 </div>
                                 <div class="p-4 bg-green-500/10 rounded-lg">
                                     <h4 class="font-bold text-green-600 dark:text-green-400">å¹¿ä¹‰ä¼˜åŠ¿ä¼°è®¡ (GAE)</h4>
                                     <p class="text-sm mt-2">PPOé€šå¸¸é‡‡ç”¨GAEæ¥å‡†ç¡®ä¼°è®¡ä¼˜åŠ¿å‡½æ•° $\\hat{A}_t$ã€‚GAEåœ¨ä½åå·®çš„TDè¯¯å·®å’Œé«˜æ–¹å·®çš„è’™ç‰¹å¡æ´›ä¼°è®¡ä¹‹é—´è¿›è¡Œæƒè¡¡ï¼Œæä¾›æ›´ç¨³å®šçš„ä¼˜åŠ¿ä¿¡å·ã€‚</p>
                                 </div>
                             </div>
                             <div>
                                 <h4 class="font-bold">PPO ä¼ªä»£ç </h4>
                                 <pre><code>Initialize policy and value networks
for iteration = 1, 2, ... do
  // 1. Data Collection
  Run old policy to collect trajectories
  // 2. Advantage & Return Calculation
  Compute advantages (GAE) and returns
  // 3. Optimization
  for K epochs do
    for mini_batch in trajectories do
      Update policy via clipped objective
      Update value function via MSE
    end for
  end for
  Update old policy
end for</code></pre>
                             </div>
                         </div>
                     </div>
                `,
                chapter6: `
                    <h2>ç¬¬6ç« : SACç®—æ³•è¯¦è§£</h2>
                    <p class="text-lg text-themed-secondary mb-6">è½¯æ¼”å‘˜-è¯„è®ºå®¶ï¼ˆSACï¼‰æ˜¯ä¸€ç§åŸºäºæœ€å¤§ç†µå¼ºåŒ–å­¦ä¹ æ¡†æ¶çš„off-policyç®—æ³•ã€‚SACçš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–å¥–åŠ±çš„åŒæ—¶ï¼Œä¹Ÿæœ€å¤§åŒ–ç­–ç•¥çš„**ç†µ**ï¼ˆéšæœºæ€§ï¼‰ã€‚è¿™ä½¿å¾—SACæˆä¸ºä¸€ä¸ªå¼ºå¤§çš„æ¢é™©å®¶ï¼Œå¸¦æ¥äº†æå¼ºçš„é²æ£’æ€§å’Œæ¢ç´¢æ•ˆç‡ã€‚</p>
                    <div class="card p-6">
                        <h3 class="text-xl font-bold">äº¤äº’å¼ç†è§£ï¼šæ¢ç´¢ä¸åˆ©ç”¨çš„æƒè¡¡</h3>
                        <p class="text-themed-secondary mb-4">SACçš„ç›®æ ‡æ˜¯ $J(\\pi) = \\sum \\mathbb{E} [r(s_t, a_t) + \\alpha \\mathcal{H}(\\pi(\\cdot|s_t))]$ã€‚å…¶ä¸­ $\\alpha$ æ˜¯"æ¸©åº¦"å‚æ•°ï¼Œæ§åˆ¶ç†µå¥–åŠ±çš„é‡è¦æ€§ã€‚è¯·è°ƒæ•´æ¸©åº¦å‚æ•° $\\alpha$ï¼Œè§‚å¯Ÿç­–ç•¥ï¼ˆè“è‰²åŒºåŸŸï¼‰æ˜¯å¦‚ä½•åœ¨"æ¢ç´¢"ï¼ˆé«˜$\\alpha$ï¼‰å’Œ"åˆ©ç”¨"ï¼ˆä½$\\alpha$ï¼‰ä¹‹é—´å˜åŒ–çš„ã€‚</p>
                        <canvas id="sac-canvas" class="w-full h-64 bg-themed-muted border border-themed rounded-lg"></canvas>
                        <div class="mt-4">
                            <label for="alpha-slider" class="font-medium flex justify-between">æ¸©åº¦ $\\alpha$: <span id="alpha-value">0.20</span></label>
                            <input type="range" id="alpha-slider" min="0.01" max="1.0" step="0.01" value="0.2" class="slider w-full h-2 bg-themed-muted rounded-lg appearance-none cursor-pointer">
                        </div>
                         <p id="sac-explanation" class="text-center mt-2 font-medium"></p>
                    </div>
                    <div class="card p-6 mt-6">
                        <h3 class="text-xl font-bold">SACæ ¸å¿ƒç»„ä»¶</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="p-4 bg-purple-500/10 rounded-lg">
                                <h4 class="font-bold text-purple-600 dark:text-purple-400">åŒQç½‘ç»œ (Twin Q-Critics)</h4>
                                 <p class="text-sm mt-2">ä¸ºäº†ç¼“è§£ä»·å€¼å‡½æ•°è¢«è¿‡é«˜ä¼°è®¡çš„é—®é¢˜ï¼ŒSACé‡‡ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„Qç½‘ç»œï¼Œåœ¨è®¡ç®—ç›®æ ‡ä»·å€¼æ—¶æ‚²è§‚åœ°å–ä¸¤ä¸ªQç½‘ç»œé¢„æµ‹å€¼çš„è¾ƒå°è€…ï¼Œä½¿å­¦ä¹ è¿‡ç¨‹æ›´ç¨³å®šã€‚</p>
                            </div>
                            <div class="p-4 bg-teal-500/10 rounded-lg">
                                <h4 class="font-bold text-teal-600 dark:text-teal-400">è‡ªåŠ¨ç†µè°ƒä¼˜</h4>
                                <p class="text-sm mt-2">æ‰‹åŠ¨è°ƒæ•´ $\\alpha$ å¾ˆå›°éš¾ã€‚SACèƒ½è‡ªåŠ¨è°ƒæ•´$\\alpha$ã€‚é€šè¿‡è®¾å®šä¸€ä¸ªç›®æ ‡ç†µï¼Œç®—æ³•ä¼šå­¦ä¹ ä¸€ä¸ªåˆé€‚çš„$\\alpha$å€¼ï¼Œä½¿ç­–ç•¥çš„å®é™…ç†µåŠ¨æ€åœ°æ¥è¿‘è¯¥ç›®æ ‡ï¼Œå®ç°äº†æ¢ç´¢å’Œåˆ©ç”¨çš„è‡ªåŠ¨å¹³è¡¡ã€‚</p>
                            </div>
                        </div>
                    </div>
                `,
                chapter7: `
                    <h2>ç¬¬7ç« : CMDPæ„å»ºå®éªŒå®¤</h2>
                    <p class="text-lg text-themed-secondary mb-6">å¯¹äºæ—¢è¦è¿½æ±‚ç»æµæ•ˆç›Šï¼Œåˆå¿…é¡»éµå®ˆå®‰å…¨çº¢çº¿çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¼•å…¥**çº¦æŸé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼ˆCMDPï¼‰**ã€‚CMDPåœ¨æ ‡å‡†MDPä¸Šå¢åŠ äº†"æˆæœ¬å‡½æ•°"å’Œçº¦æŸã€‚æ™ºèƒ½ä½“çš„ç›®æ ‡æ˜¯åœ¨æ»¡è¶³æˆæœ¬çº¦æŸçš„å‰æä¸‹ï¼Œæœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±ã€‚åœ¨è¿™ä¸ªå®éªŒå®¤é‡Œï¼Œè¯·æ‚¨æ‰®æ¼”AIå·¥ç¨‹å¸ˆï¼Œäº²æ‰‹å®šä¹‰çŠ¶æ€ã€åŠ¨ä½œã€å¥–åŠ±å’Œçº¦æŸã€‚</p>
                    <div class="card p-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div id="cmdp-builder-panel">
                                <h3 class="text-xl font-bold">1. æ„å»ºæ‚¨çš„CMDPæ¨¡å‹</h3>
                                <p class="text-themed-secondary mb-6">è¯·å‹¾é€‰æ‚¨å¸Œæœ›çº³å…¥æ¨¡å‹çš„å˜é‡ã€‚<b>å¥–åŠ±</b>æ˜¯æˆ‘ä»¬å¸Œæœ›æœ€å¤§åŒ–çš„æŒ‡æ ‡ï¼Œè€Œ<b>æˆæœ¬/çº¦æŸ</b>æ˜¯æˆ‘ä»¬å¿…é¡»éµå®ˆçš„çº¢çº¿ã€‚</p>
                                <div class="mb-4"><h4 class="font-bold text-lg mb-2 text-indigo-500 dark:text-indigo-400">S - é€‰æ‹©çŠ¶æ€</h4><div class="space-y-2 text-sm p-4 bg-themed-muted rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-nox-meter"> NOxæµ“åº¦</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-co-meter"> COæµ“åº¦</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-efficiency-meter"> çƒ­æ•ˆç‡</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-temp-meter"> å…³é”®å£æ¸©</label></div></div>
                                <div class="mb-4"><h4 class="font-bold text-lg mb-2 text-green-600 dark:text-green-500">A - é€‰æ‹©åŠ¨ä½œ</h4><div class="space-y-2 text-sm p-4 bg-themed-muted rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-air-slider"> æ€»é£é‡</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-tilt-slider"> ç‡ƒçƒ§å™¨æ‘†è§’</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-ofa-slider"> ç‡ƒå°½é£å æ¯”</label></div></div>
                                <div class="mb-4"><h4 class="font-bold text-lg mb-2 text-amber-600 dark:text-amber-500">R - å®šä¹‰å¥–åŠ±</h4><div class="space-y-2 text-sm p-4 bg-themed-muted rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-efficiency-meter" data-type="reward"> å¥–åŠ±ï¼šæå‡çƒ­æ•ˆç‡</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-nox-meter" data-type="reward"> å¥–åŠ±ï¼šé™ä½NOx</label></div></div>
                                <div class="mb-4"><h4 class="font-bold text-lg mb-2 text-red-600 dark:text-red-500">C - å®šä¹‰æˆæœ¬/çº¦æŸ</h4><div class="space-y-2 text-sm p-4 bg-themed-muted rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-temp-meter" data-type="cost"> çº¦æŸï¼šå£æ¸©</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-co-meter" data-type="cost"> çº¦æŸï¼šCOæµ“åº¦</label></div></div>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold">2. å®æ—¶é¢„è§ˆä¸äº¤äº’</h3>
                                <p class="text-themed-secondary mb-6">è¿™é‡Œæ˜¯æ‚¨æ„å»ºçš„è™šæ‹Ÿé”…ç‚‰ã€‚è¢«å®šä¹‰ä¸º"å¥–åŠ±"çš„æ¨¡å—ä¼šä»¥ç»¿è‰²é«˜äº®ï¼Œ"çº¦æŸ"æ¨¡å—ä»¥çº¢è‰²é«˜äº®ã€‚</p>
                                <div class="p-4 rounded-lg bg-slate-700 flex flex-col items-center justify-start min-h-[500px]">
                                    <h4 class="font-bold text-lg mb-2 text-white">ğŸ”¥ è™šæ‹Ÿé”…ç‚‰å®æ—¶è§†å›¾</h4>
                                    <div id="boiler-visual-container-ch7" class="w-48 h-64 bg-slate-800 rounded-t-lg relative overflow-hidden mt-4"><div id="flame-visual-ch7" class="flame-visual"></div></div>
                                    <div id="dashboard-ch7" class="w-full mt-6 space-y-4 p-2">
                                        <div id="component-nox-meter" class="preview-component hidden p-2 rounded-md transition-all duration-300"><label class="font-medium text-white text-sm">NOx</label><div class="w-full bg-slate-500 rounded-full h-3"><div id="nox-meter-fill-ch7" class="bg-red-500 h-3 rounded-full"></div></div></div>
                                        <div id="component-co-meter" class="preview-component hidden p-2 rounded-md transition-all duration-300"><label class="font-medium text-white text-sm">CO</label><div class="w-full bg-slate-500 rounded-full h-3"><div id="co-meter-fill-ch7" class="bg-amber-500 h-3 rounded-full"></div></div></div>
                                        <div id="component-temp-meter" class="preview-component hidden p-2 rounded-md transition-all duration-300"><label class="font-medium text-white text-sm">å£æ¸©</label><div class="w-full bg-slate-500 rounded-full h-3"><div id="temp-meter-fill-ch7" class="bg-orange-500 h-3 rounded-full"></div></div></div>
                                        <div id="component-efficiency-meter" class="preview-component hidden p-2 rounded-md transition-all duration-300"><label class="font-medium text-white text-sm">çƒ­æ•ˆç‡</label><div class="text-right"><span id="efficiency-value-ch7" class="text-xl font-bold text-green-400">92.50</span> %</div></div>
                                    </div>
                                </div>
                                <div id="controls-ch7" class="mt-4 p-4 bg-themed-secondary rounded-lg space-y-4 border border-themed">
                                    <div id="component-air-slider" class="preview-component hidden"><label for="air-slider-ch7" class="font-medium flex justify-between text-sm">æ€»é£é‡: <span id="air-value-ch7">75</span>%</label><input type="range" id="air-slider-ch7" min="50" max="100" value="75" class="slider w-full"></div>
                                    <div id="component-tilt-slider" class="preview-component hidden"><label for="tilt-slider-ch7" class="font-medium flex justify-between text-sm">æ‘†è§’: <span id="tilt-value-ch7">0</span>Â°</label><input type="range" id="tilt-slider-ch7" min="-15" max="15" value="0" class="slider w-full"></div>
                                    <div id="component-ofa-slider" class="preview-component hidden"><label for="ofa-slider-ch7" class="font-medium flex justify-between text-sm">OFAå æ¯”: <span id="ofa-value-ch7">30</span>%</label><input type="range" id="ofa-slider-ch7" min="10" max="50" value="30" class="slider w-full"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 pt-4 border-t border-themed"><h3 class="text-xl font-bold">3. æ‚¨ç”Ÿæˆçš„CMDPæ¨¡å‹</h3>
                              <div id="cmdp-summary-ch7" class="text-sm grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-indigo-500/10 rounded-lg mt-4">
                                  <div><strong>çŠ¶æ€:</strong><ul id="summary-State-ch7" class="list-disc list-inside"></ul></div>
                                  <div><strong>åŠ¨ä½œ:</strong><ul id="summary-Action-ch7" class="list-disc list-inside"></ul></div>
                                  <div><strong>å¥–åŠ±:</strong><ul id="summary-Reward-ch7" class="list-disc list-inside"></ul></div>
                                  <div><strong>æˆæœ¬:</strong><ul id="summary-Cost-ch7" class="list-disc list-inside"></ul></div>
                              </div>
                        </div>
                    </div>
                `,
                chapter8: `
                    <h2>ç¬¬8ç« : æ„å»ºæ•°å­—å­ªç”Ÿ</h2>
                    <p class="text-lg text-themed-secondary mb-6">RLéœ€è¦åœ¨ç¯å¢ƒä¸­è¿›è¡Œæµ·é‡è¯•é”™ï¼Œè¿™åœ¨çœŸå®çš„å·¥ä¸šè®¾å¤‡ä¸Šæ˜¯ä¸å¯è¡Œçš„ã€‚å› æ­¤ï¼Œæ„å»ºä¸€ä¸ªé«˜ä¿çœŸçš„ä»¿çœŸç¯å¢ƒâ€”â€”"æ•°å­—å­ªç”Ÿ"â€”â€”æ˜¯é¡¹ç›®æˆåŠŸçš„å…ˆå†³æ¡ä»¶ï¼Œå®ƒæ˜¯AIæ™ºèƒ½ä½“å®‰å…¨ã€é«˜æ•ˆè®­ç»ƒçš„"è™šæ‹Ÿå¥èº«æˆ¿"ã€‚</p>
                    <div class="card p-6 mb-6">
                        <h3 class="text-xl font-bold">ä»€ä¹ˆæ˜¯æ•°å­—å­ªç”Ÿï¼Ÿ</h3>
                        <p class="text-themed-secondary">æ•°å­—å­ªç”Ÿæ˜¯çœŸå®ç‰©ç†ç³»ç»Ÿçš„è™šæ‹Ÿå‰¯æœ¬ï¼Œèƒ½æ¨¡æ‹ŸçœŸå®é”…ç‚‰çš„åŠ¨æ€å“åº”ã€‚æ„å»ºæ–¹æ³•ä¸»è¦æœ‰ä¸¤ç±»ï¼š</p>
                         <ul class="list-disc list-inside space-y-2 text-themed-secondary">
                            <li><b>æœºç†å»ºæ¨¡</b>ï¼šåŸºäºç‰©ç†å®šå¾‹æ„å»ºæ–¹ç¨‹ç»„ã€‚è§£é‡Šæ€§å¼ºï¼Œä½†å¼€å‘å‘¨æœŸé•¿ã€‚</li>
                            <li><b>æ•°æ®é©±åŠ¨å»ºæ¨¡</b>ï¼šåˆ©ç”¨å†å²æ•°æ®ï¼Œé€šè¿‡æœºå™¨å­¦ä¹ æ–¹æ³•å­¦ä¹ è¾“å…¥ä¸è¾“å‡ºçš„æ˜ å°„å…³ç³»ã€‚å¼€å‘å¿«ï¼Œä½†æ³›åŒ–èƒ½åŠ›ä¾èµ–æ•°æ®è¦†ç›–èŒƒå›´ã€‚</li>
                        </ul>
                        <p class="mt-4 text-themed-secondary">å®è·µä¸­å¸¸é‡‡ç”¨æ··åˆå»ºæ¨¡ï¼Œå°†æœºç†çŸ¥è¯†ä¸æ•°æ®é©±åŠ¨æ–¹æ³•ç›¸ç»“åˆï¼Œä»¥æœŸè·å¾—æœ€ä½³æ•ˆæœã€‚</p>
                    </div>
                    <div class="card p-6 mb-6">
                        <h3 class="text-xl font-bold">"ä»¿çœŸåˆ°ç°å®"çš„é¸¿æ²Ÿ (Sim-to-Real Gap)</h3>
                        <p class="mb-4 text-themed-secondary">ä»»ä½•ä»¿çœŸéƒ½æ— æ³•100%å¤åˆ»ç°å®ï¼Œæ¨¡å‹ä¸ç°å®çš„å·®å¼‚è¢«ç§°ä¸º"Sim-to-Real Gap"ã€‚ç¼©å°è¿™ä¸ªé¸¿æ²Ÿè‡³å…³é‡è¦ã€‚ä¸€ç§æœ‰æ•ˆçš„æŠ€æœ¯æ˜¯**é¢†åŸŸéšæœºåŒ– (Domain Randomization)**ï¼šåœ¨è®­ç»ƒæ—¶ï¼Œæ•…æ„ç»™ä»¿çœŸç¯å¢ƒå¢åŠ å„ç§éšæœºæ€§ï¼ˆå¦‚éšæœºåŒ–æ¨¡å‹å‚æ•°ã€å¢åŠ ä¼ æ„Ÿå™¨å™ªå£°ï¼‰ã€‚è¿™èƒ½è¿«ä½¿AIå­¦ä¹ ä¸€ä¸ªå¯¹ä¸ç¡®å®šæ€§ä¸æ•æ„Ÿçš„ã€æ›´ä¸ºé²æ£’çš„ç­–ç•¥ã€‚</p>
                    </div>
                     <div class="card p-6">
                         <h3 class="text-xl font-bold">äº¤äº’æ¼”ç¤ºï¼šæ¨¡å‹è´¨é‡ä¸é²æ£’æ€§</h3>
                         <p class="text-themed-secondary mb-4">æ‹–åŠ¨æ»‘å—æ¨¡æ‹Ÿæ¨¡å‹ä¸ç°å®çš„åŒ¹é…ç¨‹åº¦ã€‚é»‘è‰²å®çº¿ä»£è¡¨"çœŸå®ä¸–ç•Œ"ï¼Œè“è‰²è™šçº¿ä»£è¡¨æ•°å­—å­ªç”Ÿæ¨¡å‹çš„é¢„æµ‹ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ˜¯é«˜è´¨é‡çš„æ¨¡å‹ï¼Œä¹Ÿæ°¸è¿œå­˜åœ¨å·®è·ã€‚ä¸€ä¸ªé²æ£’çš„AIç­–ç•¥åº”èƒ½åœ¨æ­¤ä¸ç¡®å®šæ€§ä¸‹ä¾ç„¶è¡¨ç°è‰¯å¥½ã€‚</p>
                         <canvas id="sim-real-canvas" class="w-full h-64 bg-themed-muted border border-themed rounded-lg"></canvas>
                         <div><label for="model-quality-slider" class="font-medium flex justify-between">æ¨¡å‹-ç°å®åŒ¹é…åº¦: <span id="model-quality-value">50</span>%</label><input type="range" id="model-quality-slider" min="10" max="98" step="1" value="50" class="slider w-full h-2 bg-themed-muted rounded-lg"></div>
                     </div>
                `,
                chapter9: `
                    <h2>ç¬¬9ç« : è®­ç»ƒå®éªŒä¸è°ƒè¯•</h2>
                    <p class="text-lg text-themed-secondary mb-8">æ¬¢è¿æ¥åˆ°RLè®­ç»ƒå®éªŒå®¤ï¼æˆ‘ä»¬å°†ç»å…¸çš„"å¯»å®"ä¾‹å­å‡çº§ä¸º"é”…ç‚‰çŠ¶æ€ç©ºé—´å¯»ä¼˜"ã€‚æ™ºèƒ½ä½“ï¼ˆè“è‰²åœ†ç‚¹ï¼‰çš„ç›®æ ‡æ˜¯åœ¨ç®€åŒ–çš„çŠ¶æ€ç½‘æ ¼ä¸­ï¼Œä»'S'å‡ºå‘ï¼Œå°½å¿«åˆ°è¾¾'ğŸ†'ï¼ŒåŒæ—¶é¿å¼€å±é™©åŒºåŸŸ'â˜ ï¸'ã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒèŠ‚è¶…å‚æ•°ï¼Œè§‚å¯ŸAIå­¦ä¹ è¡Œä¸ºå’Œæœ€ç»ˆç­–ç•¥çš„å˜åŒ–ã€‚</p>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 card p-6">
                            <h3 class="text-xl font-bold">å‚æ•°è°ƒèŠ‚</h3>
                            <div class="space-y-4">
                                <div><label for="gamma-slider" class="font-medium flex justify-between">è¿œè§ç¨‹åº¦ ($\\gamma$): <span id="gamma-value">0.9</span></label><input type="range" id="gamma-slider" min="0.5" max="0.99" step="0.01" value="0.9" class="slider w-full"></div>
                                <div><label for="lr-slider" class="font-medium flex justify-between">å­¦ä¹ ç‡ ($\\alpha_{lr}$): <span id="lr-value">0.1</span></label><input type="range" id="lr-slider" min="0.01" max="0.5" step="0.01" value="0.1" class="slider w-full"></div>
                                <div><label for="epsilon-slider-ch9" class="font-medium flex justify-between">æ¢ç´¢ç‡ ($\\epsilon$): <span id="epsilon-value-ch9">0.2</span></label><input type="range" id="epsilon-slider-ch9" min="0.05" max="1.0" step="0.05" value="0.2" class="slider w-full"></div>
                            </div>
                            <button id="start-sim" class="mt-6 w-full bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700 transition-colors">å¼€å§‹ / é‡ç½®è®­ç»ƒ</button>
                        </div>
                        <div class="lg:col-span-2 card p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h3 class="text-xl font-bold">çŠ¶æ€ç©ºé—´ (ç­–ç•¥å¯è§†åŒ–)</h3>
                                    <canvas id="rl-canvas" class="w-full bg-themed-muted border border-themed rounded-lg aspect-square"></canvas>
                                     <div class="flex justify-around text-xs mt-2 flex-wrap"><span class="flex items-center"><div class="w-3 h-3 rounded-full bg-blue-500 mr-1"></div>æ™ºèƒ½ä½“</span><span class="flex items-center"><div class="w-3 h-3 rounded-full bg-green-200 mr-1"></div>ç›®æ ‡</span><span class="flex items-center"><div class="w-3 h-3 rounded-full bg-red-200 mr-1"></div>å±é™©</span></div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold">å­¦ä¹ æ›²çº¿ (å¹³å‡å¥–åŠ±)</h3>
                                    <div class="w-full h-64 border border-themed rounded-lg p-2"><canvas id="rewardChart"></canvas></div>
                                    <div class="mt-2 text-center text-sm"><p>å›åˆ: <span id="episode-counter">0</span></p><p>å¹³å‡å¥–åŠ±: <span id="total-reward">0</span></p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                chapter10: `
                    <h2>ç¬¬10ç« : ä¸‰é˜¶æ®µå®‰å…¨éƒ¨ç½²</h2>
                    <p class="text-lg text-themed-secondary mb-6">å°†AIå®‰å…¨åœ°å¼•å…¥åˆ°ç°å®å·¥å‚ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ¯”ç®—æ³•æœ¬èº«æ›´å…·æŒ‘æˆ˜æ€§çš„å·¥ç¨‹é—®é¢˜ã€‚æˆ‘ä»¬å¿…é¡»é‡‡ç”¨ä¸€å¥—å¾ªåºæ¸è¿›çš„ç­–ç•¥ï¼Œå…¶æ ¸å¿ƒæ˜¯å»ºç«‹ä¿¡ä»»ã€ç®¡ç†é£é™©ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤±ã€‚</p>
                    <div class="flex flex-col lg:flex-row gap-6">
                        <div class="w-full lg:w-1/3 space-y-2">
                            <div id="step1" class="p-4 rounded-lg cursor-pointer deployment-step" onclick="selectStep(1)"><h4 class="font-bold text-lg">é˜¶æ®µä¸€ï¼šå»ºè®®æ¨¡å¼</h4><p class="text-sm">AIä½œä¸º"å½±å­é¡¾é—®"ï¼Œé›¶é£é™©éªŒè¯æ€§èƒ½ã€‚</p></div>
                            <div id="step2" class="p-4 rounded-lg cursor-pointer deployment-step" onclick="selectStep(2)"><h4 class="font-bold text-lg">é˜¶æ®µäºŒï¼šç›‘ç£æ§åˆ¶</h4><p class="text-sm">AIè°ƒæ•´PIDè®¾å®šå€¼ï¼Œåˆ©ç”¨ç°æœ‰ç³»ç»Ÿä½œä¸ºå®‰å…¨ç½‘ã€‚</p></div>
                            <div id="step3" class="p-4 rounded-lg cursor-pointer deployment-step" onclick="selectStep(3)"><h4 class="font-bold text-lg">é˜¶æ®µä¸‰ï¼šç›´æ¥æ§åˆ¶</h4><p class="text-sm">AIç›´æ¥è¾“å‡ºæŒ‡ä»¤ï¼Œä½†é¡»é€šè¿‡"å®‰å…¨å±‚"è¿‡æ»¤ã€‚</p></div>
                        </div>
                        <div id="step-content" class="flex-1 card p-6 min-h-[300px]"></div>
                    </div>
                `,
                chapter11: `
                    <h2>ç¬¬11ç« : æ€»ç»“ä¸æœªæ¥</h2>
                    <p class="text-lg text-themed-secondary mb-6">æˆ‘ä»¬ä»é”…ç‚‰åŸç†å‡ºå‘ï¼Œæ¢è®¨äº†å¦‚ä½•å°†å·¥ä¸šé—®é¢˜æŠ½è±¡ä¸ºCMDPæ¨¡å‹ï¼Œä»‹ç»äº†PPOå’ŒSACç­‰ç®—æ³•ï¼Œå¹¶é˜è¿°äº†ä»æ•°å­—å­ªç”Ÿåˆ°ä¸‰é˜¶æ®µå®‰å…¨éƒ¨ç½²çš„å®Œæ•´å·¥ç¨‹å®è·µæ¡†æ¶ã€‚æˆåŠŸçš„å·¥ä¸šAIåº”ç”¨ï¼Œæ˜¯**ç®—æ³•ã€é¢†åŸŸçŸ¥è¯†å’Œå·¥ç¨‹å®è·µ**ä¸‰è€…æ·±åº¦èåˆçš„äº§ç‰©ã€‚</p>
                    <div class="card p-6">
                        <h3 class="text-xl font-bold">æœªæ¥ç ”ç©¶æ–¹å‘</h3>
                        <p class="text-themed-secondary mb-6">é”…ç‚‰ä¼˜åŒ–é¢†åŸŸä»æœ‰å¹¿é˜”çš„æ¢ç´¢ç©ºé—´ï¼š</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="p-4 bg-themed-muted rounded-lg hover:shadow-md transition">
                                <h4 class="font-bold text-lg">å¤šæ™ºèƒ½ä½“ (MARL)</h4>
                                <p class="text-sm mt-2">å°†æ¯ä¸ªç‡ƒçƒ§å™¨è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ™ºèƒ½ä½“ï¼Œå­¦ä¹ ååŒé…åˆï¼Œä»¥å®ç°æ¯”å•æ™ºèƒ½ä½“æ›´ç²¾ç»†çš„æ§åˆ¶ã€‚</p>
                            </div>
                            <div class="p-4 bg-themed-muted rounded-lg hover:shadow-md transition">
                                <h4 class="font-bold text-lg">å¯è§£é‡Šæ€§ (XAI)</h4>
                                <p class="text-sm mt-2">è®©AIä¸å†æ˜¯"é»‘ç®±"ï¼Œèƒ½å¤Ÿè§£é‡Šå…¶å†³ç­–åŸå› ï¼Œå¯¹äºå»ºç«‹æ“ä½œå‘˜ä¿¡ä»»è‡³å…³é‡è¦ã€‚</p>
                            </div>
                            <div class="p-4 bg-themed-muted rounded-lg hover:shadow-md transition">
                                <h4 class="font-bold text-lg">è¿ç§»å­¦ä¹ ä¸ç»ˆèº«å­¦ä¹ </h4>
                                <p class="text-sm mt-2">å°†åœ¨Aæœºç»„ä¸Šè®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¿«é€Ÿé€‚é…åˆ°Bæœºç»„ä¸Šã€‚å¹¶è®©æ¨¡å‹åœ¨ä¸Šçº¿åèƒ½æŒç»­åœ°åœ¨çº¿å­¦ä¹ ï¼Œé€‚åº”æ–°æƒ…å†µã€‚</p>
                            </div>
                        </div>
                    </div>
                `
            };
            
            Object.keys(chapterContents).forEach(key => {
                const section = document.getElementById(key);
                if (section) section.innerHTML = chapterContents[key];
            });


            // --- Global Variables & Selectors ---
            const homeLanding = document.getElementById('home-landing');
            const mainApp = document.getElementById('main-app');
            const startBtn = document.getElementById('start-experience-btn');
            const mainLogo = document.getElementById('main-logo');
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            
            // Modals
            const userPanel = document.getElementById('user-info-panel');
            const userModal = document.getElementById('user-modal');
            const closeUserModalBtn = document.getElementById('close-user-modal-btn');
            const contactBtn = document.getElementById('contact-btn');
            const contactModal = document.getElementById('contact-modal');
            const closeContactModalBtn = document.getElementById('close-contact-modal-btn');
            const contactForm = document.getElementById('contact-form');
            const contactSuccessMsg = document.getElementById('contact-success-msg');
            const contactIntro = document.getElementById('contact-intro');

            // Theme Toggle
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const themeIcon = document.getElementById('theme-icon');
            const themeText = document.getElementById('theme-text');
            
            let currentView = '';
            let activeAnimationFrames = {};

            // --- Theme Management ---
            function applyTheme(theme) {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    themeIcon.classList.replace('fa-moon', 'fa-sun');
                    themeText.textContent = 'åˆ‡æ¢æµ…è‰²æ¨¡å¼';
                } else {
                    document.documentElement.classList.remove('dark');
                    themeIcon.classList.replace('fa-sun', 'fa-moon');
                    themeText.textContent = 'åˆ‡æ¢æ·±è‰²æ¨¡å¼';
                }
                // Re-render any visible canvas that depends on theme
                if(currentView) initializeInteractiveModules(currentView);
            }

            themeToggleBtn.addEventListener('click', () => {
                const isDark = document.documentElement.classList.contains('dark');
                const newTheme = isDark ? 'light' : 'dark';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });
            
            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);


            // --- Core Navigation & App Flow ---
            startBtn.addEventListener('click', () => {
                homeLanding.style.display = 'none';
                mainApp.style.display = 'block';
                navigateTo('chapter1');
            });

            mainLogo.addEventListener('click', () => {
                mainApp.style.display = 'none';
                homeLanding.style.display = 'flex';
                cleanupAnimations();
                currentView = 'home';
                window.history.pushState({view: 'home'}, '', '#');
            });

            // --- Modal Logic ---
            userPanel.addEventListener('click', () => userModal.classList.add('visible'));
            closeUserModalBtn.addEventListener('click', () => userModal.classList.remove('visible'));
            userModal.addEventListener('click', (e) => { if(e.target === userModal) userModal.classList.remove('visible'); });

            contactBtn.addEventListener('click', () => {
                contactSuccessMsg.classList.add('hidden');
                contactForm.classList.remove('hidden');
                contactIntro.classList.remove('hidden');
                contactModal.classList.add('visible');
            });
            closeContactModalBtn.addEventListener('click', () => contactModal.classList.remove('visible'));
            contactModal.addEventListener('click', (e) => { if(e.target === contactModal) contactModal.classList.remove('visible'); });
            contactForm.addEventListener('submit', (e) => {
                e.preventDefault();
                contactForm.classList.add('hidden');
                contactIntro.classList.add('hidden');
                contactSuccessMsg.classList.remove('hidden');
                setTimeout(() => {
                    contactModal.classList.remove('visible');
                    contactForm.reset();
                }, 2500);
            });


            function cleanupAnimations() {
                Object.values(activeAnimationFrames).forEach(id => {
                    if (id) cancelAnimationFrame(id);
                });
                activeAnimationFrames = {};
                if(window.acAnimationTimeoutId) clearTimeout(window.acAnimationTimeoutId);
                if(window.rlSimulationIntervalId) clearInterval(window.rlSimulationIntervalId);
            }

            function navigateTo(viewId) {
                if (!viewId || currentView === viewId) return;
                
                cleanupAnimations();
                currentView = viewId;
                
                navLinks.forEach(link => link.classList.toggle('active', link.dataset.view === viewId));
                contentSections.forEach(section => section.classList.toggle('active', section.id === viewId));
                
                initializeInteractiveModules(viewId);
                if(window.location.hash !== `#${viewId}`) {
                    window.history.pushState({view: viewId}, '', `#${viewId}`);
                }
            }

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo(link.dataset.view);
                });
            });

            window.addEventListener('popstate', (e) => {
                const viewId = e.state?.view || (window.location.hash ? window.location.hash.substring(1) : 'chapter1');
                 if (viewId && viewId !== 'home') {
                    homeLanding.style.display = 'none';
                    mainApp.style.display = 'block';
                    navigateTo(viewId);
                } else {
                    mainApp.style.display = 'none';
                    homeLanding.style.display = 'flex';
                }
            });

            const initialHash = window.location.hash.substring(1);
            if (initialHash && chapterContents[initialHash]) {
                startBtn.click();
                setTimeout(() => navigateTo(initialHash), 50);
            }

            function initializeInteractiveModules(viewId) {
                window.activeAnimationFrames = activeAnimationFrames;
                switch(viewId) {
                    case 'chapter1': initChapter1(); break;
                    case 'chapter2': initChapter2(); break;
                    case 'chapter4': initActorCriticViz(); break;
                    case 'chapter5': initPpoCanvas(); break;
                    case 'chapter6': initSacCanvas(); break;
                    case 'chapter7': initCmdpLab(); break;
                    case 'chapter8': initSimRealCanvas(); break; 
                    case 'chapter9': initRlTrainingLab(); break;
                    case 'chapter10': selectStep(1); break;
                }
                if (window.MathJax) MathJax.typesetPromise();
            }
        });

        // --- All interactive logic functions are defined below ---

        function initChapter1() {
            initBoilerSandbox();
            renderBoilerDiagram();
            renderRankineDiagram();
        }

        function initChapter2() {
            initBellmanGrid();
            renderRlTaxonomy();
        }
        
        function initBoilerSandbox() {
            const sliders = {
                load: document.getElementById('load-slider'),
                air: document.getElementById('air-total-slider'),
                tilt: document.getElementById('burner-tilt-slider'),
                ofa: document.getElementById('o2-dist-slider')
            };
            if (!sliders.load) return;

            const values = {
                load: document.getElementById('load-value'),
                air: document.getElementById('air-total-value'),
                tilt: document.getElementById('burner-tilt-value'),
                ofa: document.getElementById('o2-dist-value')
            };
            const visuals = {
                flame: document.getElementById('flame-visual'),
                nox: document.getElementById('nox-meter-fill'),
                co: document.getElementById('co-meter-fill'),
                efficiency: document.getElementById('efficiency-value')
            };
            
            const paretoCtx = document.getElementById('pareto-chart')?.getContext('2d');
            let paretoChart;
            let workingPointHistory = [];

            function updateBoilerSimulation() {
                const load = parseFloat(sliders.load.value);
                const air = parseFloat(sliders.air.value);
                const tilt = parseFloat(sliders.tilt.value);
                const ofa = parseFloat(sliders.ofa.value);
                
                values.load.textContent = load.toFixed(0);
                values.air.textContent = air.toFixed(0);
                values.tilt.textContent = tilt.toFixed(0);
                values.ofa.textContent = ofa.toFixed(0);

                const load_factor = load / 100;
                let nox_raw = (air * 1.2 - ofa * 1.5 + Math.abs(tilt) * 0.5) * (0.8 + load_factor * 0.4);
                let co_raw = (150 - air + (Math.abs(air - 85) * 0.4)) * (0.9 + load_factor * 0.2);
                let eff_base = 90.5 + load_factor * 2;
                let eff_air = 1 - Math.abs(air - (80 + load_factor * 5)) / 50;
                let eff_ofa = 1 - Math.abs(ofa - 35) / 40;
                let efficiency_raw = eff_base + (eff_air * 1.5) + (eff_ofa * 1) - (co_raw / 150);

                const nox = Math.max(10, Math.min(100, nox_raw));
                const co = Math.max(5, Math.min(100, co_raw));
                const efficiency = Math.max(88, Math.min(94.5, efficiency_raw));
                
                visuals.flame.style.height = `${(40 + (air / 100) * 60) * (0.8 + load_factor * 0.2)}%`;
                visuals.flame.style.transform = `translateY(${tilt * -1.5}px) skewX(${tilt * -0.5}deg)`;
                visuals.nox.style.width = `${nox}%`;
                visuals.co.style.width = `${co}%`;
                visuals.efficiency.textContent = efficiency.toFixed(2);

                updateParetoChart(efficiency, nox);
            }

            function generateParetoFront() {
                const front = [];
                for (let eff = 94.5; eff >= 90; eff -= 0.1) {
                    let nox = 30 + Math.pow(94.5 - eff, 2) * 2;
                    nox += (Math.random() - 0.5) * 5;
                    front.push({x: nox, y: eff});
                }
                return front.sort((a,b) => a.x - b.x);
            }

            function updateParetoChart(efficiency, nox) {
                if (!paretoCtx) return;
                
                const newPoint = {x: nox, y: efficiency};
                workingPointHistory.push(newPoint);
                if (workingPointHistory.length > 20) workingPointHistory.shift();

                if (paretoChart) paretoChart.destroy();
                
                const isDark = document.documentElement.classList.contains('dark');
                const gridColor = isDark ? 'rgba(148, 163, 184, 0.2)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDark ? '#94a3b8' : '#475569';

                paretoChart = new Chart(paretoCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'å¸•ç´¯æ‰˜æœ€ä¼˜å‰æ²¿', data: generateParetoFront(), borderColor: 'rgba(220, 38, 38, 0.5)', borderWidth: 2, borderDash: [5, 5], pointRadius: 0, showLine: true, fill: false,
                        },{
                            label: 'å†å²è½¨è¿¹', data: workingPointHistory, backgroundColor: 'rgba(100, 116, 139, 0.3)', pointRadius: 3,
                        },{
                            label: 'å½“å‰å·¥ä½œç‚¹', data: [newPoint], backgroundColor: 'rgb(79, 70, 229)', pointRadius: 8, pointHoverRadius: 10,
                        }]
                    },
                    options: {
                        animation: false,
                        scales: { 
                            x: { title: { display: true, text: 'NOx æ’æ”¾', color: textColor }, min: 20, max: 100, grid: { color: gridColor }, ticks: { color: textColor } }, 
                            y: { title: { display: true, text: 'çƒ­æ•ˆç‡ (%)', color: textColor }, min: 88, max: 95, grid: { color: gridColor }, ticks: { color: textColor } } 
                        },
                        plugins: { legend: { position: 'bottom', labels: { color: textColor } } }
                    }
                });
            }

            Object.values(sliders).forEach(slider => slider.addEventListener('input', updateBoilerSimulation));
            updateBoilerSimulation();
        }

        function initBellmanGrid() {
            const canvas = document.getElementById('bellman-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const iterateBtn = document.getElementById('iterate-bellman-btn');
            const resetBtn = document.getElementById('reset-bellman-btn');
            const iterCountEl = document.getElementById('bellman-iteration-count');
            const updateInfoEl = document.getElementById('bellman-update-info');
            const methodSelect = document.getElementById('dp-method-select');
            const phaseInfoEl = document.getElementById('pi-phase-info');

            const GRID_SIZE = 5;
            const GAMMA = 0.9;
            const REWARDS = { goal: 1, trap: -1, step: 0 };
            const goal = {x: 4, y: 4};
            const traps = [{x: 2, y: 2}, {x: 1, y: 3}];
            const walls = [{x: 3, y: 1}];

            let values, policy, iterationCount, pi_phase;

            function reset() {
                iterationCount = 0;
                values = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(0));
                policy = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(Math.floor(Math.random() * 4)));
                iterCountEl.textContent = iterationCount;
                updateInfoEl.textContent = 'ç¯å¢ƒå·²é‡ç½®ã€‚';
                pi_phase = 'evaluation';
                updatePhaseDisplay();
                drawGrid();
            }

            function iterate() {
                const method = methodSelect.value;
                if (method === 'vi') { valueIterationStep(); } 
                else { policyIterationStep(); }
                iterationCount++;
                iterCountEl.textContent = iterationCount;
                drawGrid();
            }
            
            function valueIterationStep() {
                let newValues = JSON.parse(JSON.stringify(values));
                let maxChange = 0;
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        if (isWall(x, y) || isTerminal(x, y)) continue;
                        const actionValues = getActionValues(x, y, values);
                        const bestValue = Math.max(...actionValues);
                        newValues[y][x] = REWARDS.step + GAMMA * bestValue;
                        maxChange = Math.max(maxChange, Math.abs(newValues[y][x] - values[y][x]));
                    }
                }
                values = newValues;
                updatePolicyBasedOnValues();
                updateInfoEl.textContent = `ä»·å€¼è¿­ä»£ã€‚æœ€å¤§å˜åŒ–é‡: ${maxChange.toFixed(3)}`;
            }

            function policyIterationStep() {
                if (pi_phase === 'evaluation') {
                    let maxChange = 0;
                    for (let y = 0; y < GRID_SIZE; y++) {
                        for (let x = 0; x < GRID_SIZE; x++) {
                            if (isWall(x, y) || isTerminal(x, y)) continue;
                            const currentAction = policy[y][x];
                            const actionValue = getActionValues(x, y, values)[currentAction];
                            const newValue = REWARDS.step + GAMMA * actionValue;
                            maxChange = Math.max(maxChange, Math.abs(newValue - values[y][x]));
                            values[y][x] = newValue;
                        }
                    }
                    updateInfoEl.textContent = `ç­–ç•¥è¯„ä¼°ã€‚æœ€å¤§å˜åŒ–é‡: ${maxChange.toFixed(3)}`;
                    if (maxChange < 1e-3) pi_phase = 'improvement';
                } else { // improvement phase
                    let policy_stable = true;
                    for (let y = 0; y < GRID_SIZE; y++) {
                        for (let x = 0; x < GRID_SIZE; x++) {
                            if (isTerminal(x, y) || isWall(x, y)) continue;
                            let old_action = policy[y][x];
                            const actionValues = getActionValues(x, y, values);
                            policy[y][x] = actionValues.indexOf(Math.max(...actionValues));
                            if (old_action !== policy[y][x]) policy_stable = false;
                        }
                    }
                    updateInfoEl.textContent = `ç­–ç•¥æå‡ã€‚ç­–ç•¥ç¨³å®š: ${policy_stable}`;
                    pi_phase = 'evaluation';
                }
                updatePhaseDisplay();
            }
            
            function getActionValues(x, y, value_grid) {
                const actions = [[0, -1], [0, 1], [-1, 0], [1, 0]]; // U, D, L, R
                return actions.map(([dx, dy]) => {
                    const nx = x + dx, ny = y + dy;
                    if (nx < 0 || nx >= GRID_SIZE || ny < 0 || ny >= GRID_SIZE || isWall(nx, ny)) {
                        return value_grid[y][x];
                    }
                    return value_grid[ny][nx];
                });
            }
            
            function updatePolicyBasedOnValues() {
                 for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        if (isTerminal(x, y) || isWall(x, y)) continue;
                        const actionValues = getActionValues(x, y, values);
                        policy[y][x] = actionValues.indexOf(Math.max(...actionValues));
                    }
                }
            }

            function isTerminal(x, y) { return (x === goal.x && y === goal.y) || traps.some(t => t.x === x && t.y === y); }
            function isWall(x, y) { return walls.some(w => w.x === x && w.y === y); }
            function updatePhaseDisplay() { phaseInfoEl.textContent = methodSelect.value === 'pi' ? (pi_phase === 'evaluation' ? 'è¯„ä¼°ä¸­' : 'æå‡ä¸­') : 'N/A'; }

            function drawGrid() {
                const cellSize = canvas.width / GRID_SIZE;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const isDark = document.documentElement.classList.contains('dark');

                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        const val = values[y][x];
                        const heat = (val - REWARDS.trap) / (REWARDS.goal - REWARDS.trap);
                        const r = Math.floor(255 * (1 - heat));
                        const g = Math.floor(255 * heat);
                        ctx.fillStyle = `rgb(${r}, ${g}, 100)`;
                        if (isWall(x, y)) ctx.fillStyle = '#555';
                        else if (isTerminal(x, y)) ctx.fillStyle = (x === goal.x && y === goal.y) ? 'rgb(100,255,100)' : 'rgb(255,100,100)';
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                        ctx.strokeStyle = isDark ? '#475569' : '#ccc';
                        ctx.strokeRect(x * cellSize, y * cellSize, cellSize, cellSize);

                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        if (isTerminal(x,y) || isWall(x,y)) {
                            ctx.font = `${cellSize*0.6}px sans-serif`;
                            if(x === goal.x && y === goal.y) ctx.fillText('ğŸ†', x*cellSize+cellSize/2, y*cellSize+cellSize/2);
                            else if(isWall(x, y)) ctx.fillText('ğŸ§±', x*cellSize+cellSize/2, y*cellSize+cellSize/2);
                            else ctx.fillText('â˜ ï¸', x*cellSize+cellSize/2, y*cellSize+cellSize/2);
                        } else {
                            ctx.fillStyle = isDark ? '#f1f5f9' : '#1e293b';
                            ctx.font = `bold ${cellSize*0.25}px sans-serif`;
                            ctx.fillText(val.toFixed(1), x*cellSize+cellSize/2, y*cellSize+cellSize/4);
                            if(policy[y][x] !== -1) {
                                 ctx.font = `${cellSize*0.4}px sans-serif`;
                                 ctx.fillText(['â†‘', 'â†“', 'â†', 'â†’'][policy[y][x]], x*cellSize+cellSize/2, y*cellSize+cellSize*0.7);
                            }
                        }
                    }
                }
            }
            
            iterateBtn.addEventListener('click', iterate);
            resetBtn.addEventListener('click', reset);
            methodSelect.addEventListener('change', reset);
            reset();
        }
        
        function initActorCriticViz() {
            const container = document.getElementById('ac-diagram-container');
            if (!container) return;
            const playBtn = document.getElementById('play-ac-viz');
            const explanationEl = document.getElementById('ac-viz-explanation');
            
            renderAcDiagram(container);
            const svgEl = container.querySelector('svg');
            if (!svgEl) return;

            const allElements = {
                nodes: Array.from(svgEl.querySelectorAll(".ac-node")),
                arrows: Array.from(svgEl.querySelectorAll(".ac-arrow")),
                updateLabel: svgEl.querySelector("#label-update")
            };

            function resetHighlights() {
                allElements.nodes.forEach(el => el.classList.remove('highlight'));
                allElements.arrows.forEach(el => {
                    el.style.stroke = '#9ca3af';
                    el.setAttribute('marker-end', 'url(#arrowhead)');
                });
                if (allElements.updateLabel) allElements.updateLabel.style.fill = 'transparent';
                explanationEl.textContent = "";
            }

            playBtn.addEventListener('click', () => {
                if (playBtn.disabled) return;
                playBtn.disabled = true;
                if(window.acAnimationTimeoutId) clearTimeout(window.acAnimationTimeoutId);

                let stepIndex = 0;
                const steps = [
                    { el: ["node-state"], text: "1. æ™ºèƒ½ä½“è§‚å¯Ÿåˆ°å½“å‰çŠ¶æ€ S" },
                    { el: ["arrow-to-actor"], text: "2. çŠ¶æ€ S è¢«è¾“å…¥ç»™æ¼”å‘˜ (Actor)" },
                    { el: ["node-actor"], text: "3. æ¼”å‘˜æ ¹æ®å…¶ç­–ç•¥ $\\pi(a|S)$ï¼Œé€‰æ‹©ä¸€ä¸ªåŠ¨ä½œ A" },
                    { el: ["arrow-to-action"], text: "4. æ¼”å‘˜è¾“å‡ºåŠ¨ä½œ A" },
                    { el: ["node-action"], text: "5. åŠ¨ä½œ A æ–½åŠ äºç¯å¢ƒ" },
                    { el: ["arrow-to-env"], text: "6. ç¯å¢ƒæ¥æ”¶åŠ¨ä½œå¹¶å‘ç”ŸçŠ¶æ€è½¬ç§»" },
                    { el: ["node-env"], text: "7. ç¯å¢ƒè¿”å›æ–°çŠ¶æ€S'å’Œå¥–åŠ±R" },
                    { el: ["arrow-to-critic"], text: "8. (S, A, R, S') è¢«é€å¾€è¯„è®ºå®¶è¿›è¡Œè¯„ä¼°" },
                    { el: ["node-critic"], text: "9. è¯„è®ºå®¶è®¡ç®—ä¼˜åŠ¿å‡½æ•° A(s,a)" },
                    { el: ["arrow-critic-to-actor", "label-update"], text: "10. ä¼˜åŠ¿å‡½æ•° A(s,a) æŒ‡å¯¼æ¼”å‘˜æ›´æ–°" }
                ];

                function nextStep() {
                    resetHighlights();
                    if (stepIndex >= steps.length) {
                        playBtn.disabled = false;
                        explanationEl.textContent = "æµç¨‹ç»“æŸã€‚";
                        if(window.MathJax) MathJax.typesetPromise();
                        return;
                    }

                    const currentStep = steps[stepIndex];
                    explanationEl.innerHTML = currentStep.text;
                    if(window.MathJax) MathJax.typesetPromise();

                    currentStep.el.forEach(id => {
                        const element = svgEl.querySelector(`#${id}`);
                        if (element) {
                            if (element.tagName.toLowerCase() === 'path') {
                                element.style.stroke = '#f97316';
                                element.setAttribute('marker-end', 'url(#arrowhead-h)');
                            } else if (id.includes('node')) {
                                element.classList.add('highlight');
                            } else if (id === 'label-update') {
                                element.style.fill = '#c2410c';
                            }
                        }
                    });

                    stepIndex++;
                    window.acAnimationTimeoutId = setTimeout(nextStep, 1800);
                }

                resetHighlights();
                nextStep();
            });
        }
            
        function initPpoCanvas() {
            const canvas = document.getElementById('ppo-canvas'); 
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const toggleBtn = document.getElementById('ppo-toggle-advantage');
            const explanationEl = document.getElementById('ppo-explanation');
            const epsilonSlider = document.getElementById('epsilon-slider');
            const epsilonValueEl = document.getElementById('epsilon-value');
            let advantage = 1;
            let epsilon = 0.2;

            function drawPpo(){
                const w = canvas.width, h = canvas.height;
                const isDark = document.documentElement.classList.contains('dark');
                ctx.clearRect(0, 0, w, h);
                
                ctx.strokeStyle = isDark ? '#475569' : '#cbd5e1';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, h/2); ctx.lineTo(w, h/2);
                const r1_x = w * (1 - 0.5) / 1.5;
                ctx.moveTo(r1_x, 0); ctx.lineTo(r1_x, h);
                ctx.stroke();
                ctx.fillStyle = isDark ? '#94a3b8' : '#64748b';
                ctx.font = "12px 'Noto Sans SC'";
                ctx.fillText('r(Î¸)=1', r1_x - 10, h/2 + 15);
                ctx.fillText('ç›®æ ‡ L', w/2 - 20, 15);
                ctx.fillText('æ¦‚ç‡æ¯” r(Î¸)', w - 60, h/2 + 15);
                
                ctx.fillStyle = 'rgba(79, 70, 229, 0.05)';
                const clip_lower_x = w * (1 - epsilon - 0.5) / 1.5;
                const clip_upper_x = w * (1 + epsilon - 0.5) / 1.5;
                ctx.fillRect(clip_lower_x, 0, clip_upper_x - clip_lower_x, h);

                ctx.strokeStyle = '#fca5a5';
                ctx.setLineDash([5, 5]);
                ctx.lineWidth = 1.5;
                const y_clip_upper = h/2 - 50 * (1 + epsilon) * advantage;
                const y_clip_lower = h/2 - 50 * (1 - epsilon) * advantage;
                ctx.beginPath(); ctx.moveTo(0, y_clip_upper); ctx.lineTo(w, y_clip_upper); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0, y_clip_lower); ctx.lineTo(w, y_clip_lower); ctx.stroke();
                ctx.setLineDash([]);
                
                ctx.strokeStyle = '#4f46e5';
                ctx.lineWidth = 3;
                ctx.beginPath();
                for (let i = 0; i <= w; i++) {
                    const ratio = 0.5 + (i / w) * 1.5;
                    const y_unclipped = h/2 - 50 * ratio * advantage;
                    const y_clipped_val = h/2 - 50 * (ratio > 1 ? (1+epsilon) : (1-epsilon)) * advantage;
                    const y_final = (advantage > 0) ? Math.max(y_unclipped, y_clipped_val) : Math.min(y_unclipped, y_clipped_val);
                    i === 0 ? ctx.moveTo(i, y_final) : ctx.lineTo(i, y_final);
                }
                ctx.stroke();

                if (advantage > 0) {
                    explanationEl.innerHTML = 'å½“ä¼˜åŠ¿ $\\hat{A}_t > 0$ (å¥½åŠ¨ä½œ)æ—¶ï¼Œç›®æ ‡å‡½æ•°è¢« <span class="text-green-600 font-semibold">å‘ä¸Šæ¨åŠ¨</span>ï¼Œä½†è¢«ä¸Šé™è£å‰ªï¼Œé˜²æ­¢ç­–ç•¥è¿‡äºæ¿€è¿›ã€‚';
                } else {
                    explanationEl.innerHTML = 'å½“ä¼˜åŠ¿ $\\hat{A}_t < 0$ (ååŠ¨ä½œ)æ—¶ï¼Œç›®æ ‡å‡½æ•°è¢« <span class="text-red-600 font-semibold">å‘ä¸‹æ‹‰åŠ¨</span>ï¼Œä½†è¢«ä¸‹é™è£å‰ªï¼Œé˜²æ­¢ç­–ç•¥æ›´æ–°è¿‡çŒ›ã€‚';
                }
                if(window.MathJax) MathJax.typesetPromise();
            }
            
            toggleBtn.addEventListener('click', () => {
                advantage *= -1;
                toggleBtn.innerHTML = advantage > 0 ? 'åˆ‡æ¢åˆ° "ååŠ¨ä½œ" ($\\hat{A}_t < 0$)' : 'åˆ‡æ¢åˆ° "å¥½åŠ¨ä½œ" ($\\hat{A}_t > 0$)';
                if(window.MathJax) MathJax.typesetPromise();
                drawPpo();
            });
            epsilonSlider.addEventListener('input', (e) => {
                epsilon = parseFloat(e.target.value);
                epsilonValueEl.textContent = epsilon.toFixed(2);
                drawPpo();
            });
            drawPpo();
        }
            
        function initSacCanvas() {
            const sacCanvas = document.getElementById('sac-canvas'); 
            if (!sacCanvas) return;
            const sacCtx = sacCanvas.getContext('2d');
            const slider = document.getElementById('alpha-slider');
            const valueDisp = document.getElementById('alpha-value');
            const explanationEl = document.getElementById('sac-explanation');
            let alpha = 0.2;
            
            slider.addEventListener('input', (e) => {
                alpha = parseFloat(e.target.value);
                valueDisp.textContent = alpha.toFixed(2);
            });
            
            const rewardLandscape = (x_norm) => Math.sin(x_norm * 2 * Math.PI) * 0.5 + Math.cos(x_norm * 3 * Math.PI) * 0.3;
            let animationTime = 0;

            function drawSac() {
                if (!document.getElementById('sac-canvas')) {
                    if (window.activeAnimationFrames.sac) cancelAnimationFrame(window.activeAnimationFrames.sac);
                    return;
                }
                const w = sacCanvas.width, h = sacCanvas.height;
                sacCtx.clearRect(0, 0, w, h);
                
                sacCtx.beginPath();
                sacCtx.strokeStyle = 'rgba(100, 116, 139, 0.4)';
                sacCtx.lineWidth = 2;
                sacCtx.setLineDash([2, 3]);
                for (let x = 0; x <= w; x++) {
                    const y = h/2 - rewardLandscape(x / w) * h/3;
                    x === 0 ? sacCtx.moveTo(x, y) : sacCtx.lineTo(x, y);
                }
                sacCtx.stroke();
                sacCtx.setLineDash([]);
                
                sacCtx.beginPath();
                sacCtx.fillStyle = 'rgba(79, 70, 229, 0.5)';
                const std_dev = 0.05 + alpha * 0.4;
                animationTime += 0.005;
                const mean = w / 2 + Math.sin(animationTime) * w/3;
                
                sacCtx.moveTo(0, h);
                for (let x = 0; x <= w; x++) {
                    const y = Math.exp(-0.5 * Math.pow(((x - mean) / (w/4)) / std_dev, 2)) * (h - 20);
                    sacCtx.lineTo(x, h - y);
                }
                sacCtx.lineTo(w, h);
                sacCtx.closePath();
                sacCtx.fill();
                
                if (alpha > 0.6) explanationEl.textContent = 'é«˜ Î±: ç­–ç•¥éå¸¸å¹³å¦, ç†µå¥–åŠ±ä¸»å¯¼, æ™ºèƒ½ä½“ç§¯ææ¢ç´¢ã€‚';
                else if (alpha < 0.1) explanationEl.textContent = 'ä½ Î±: ç­–ç•¥éå¸¸å°–é”, ä»»åŠ¡å¥–åŠ±ä¸»å¯¼, æ™ºèƒ½ä½“ç§¯æåˆ©ç”¨ã€‚';
                else explanationEl.textContent = 'Î± é€‚ä¸­: åœ¨æ¢ç´¢ä¸åˆ©ç”¨ä¹‹é—´å–å¾—è‰¯å¥½å¹³è¡¡ã€‚';

                window.activeAnimationFrames.sac = requestAnimationFrame(drawSac);
            }
            drawSac();
        }

        function initCmdpLab() {
            const builderPanel = document.getElementById('cmdp-builder-panel');
            if (!builderPanel) return;

            const checkboxes = builderPanel.querySelectorAll('.cmdp-checkbox');
            const controls = {
                air: document.getElementById('air-slider-ch7'),
                tilt: document.getElementById('tilt-slider-ch7'),
                ofa: document.getElementById('ofa-slider-ch7'),
            };
            const valueLabels = {
                air: document.getElementById('air-value-ch7'),
                tilt: document.getElementById('tilt-value-ch7'),
                ofa: document.getElementById('ofa-value-ch7'),
            };
            const visuals = {
                flame: document.getElementById('flame-visual-ch7'),
                noxFill: document.getElementById('nox-meter-fill-ch7'),
                coFill: document.getElementById('co-meter-fill-ch7'),
                tempFill: document.getElementById('temp-meter-fill-ch7'),
                efficiency: document.getElementById('efficiency-value-ch7'),
            };

            function updateSimulation() {
                if (!controls.air || !controls.tilt || !controls.ofa) return;
                const air = parseFloat(controls.air.value);
                const tilt = parseFloat(controls.tilt.value);
                const ofa = parseFloat(controls.ofa.value);

                if (valueLabels.air) valueLabels.air.textContent = air.toFixed(0);
                if (valueLabels.tilt) valueLabels.tilt.textContent = tilt.toFixed(0);
                if (valueLabels.ofa) valueLabels.ofa.textContent = ofa.toFixed(0);

                let nox = 1.1 * air - 1.6 * ofa + 0.4 * Math.abs(tilt);
                let co = 140 - air + 0.5 * Math.abs(air - 80);
                let temp = 60 + (air - 75) + Math.abs(tilt);
                let efficiency = 91.5 + (1 - Math.abs(air - 85) / 50) * 1.5 + (1 - Math.abs(ofa - 35) / 40) * 1 - (co / 100);

                nox = Math.max(10, Math.min(100, nox));
                co = Math.max(5, Math.min(100, co));
                temp = Math.max(20, Math.min(100, temp));
                efficiency = Math.max(90, Math.min(94, efficiency));

                if (visuals.flame) {
                    visuals.flame.style.height = `${30 + (air / 100) * 70}%`;
                    visuals.flame.style.transform = `translateY(${tilt * -1.5}px) skewX(${tilt * -0.5}deg)`;
                }
                if (visuals.noxFill) visuals.noxFill.style.width = `${nox}%`;
                if (visuals.coFill) visuals.coFill.style.width = `${co}%`;
                if (visuals.tempFill) visuals.tempFill.style.width = `${temp}%`;
                if (visuals.efficiency) visuals.efficiency.textContent = efficiency.toFixed(2);
            }

            function updateSummary() {
                const summary = { State: [], Action: [], Reward: [], Cost: [] };
                checkboxes.forEach(cb => {
                    if (cb.checked) {
                        const label = cb.parentElement.textContent.trim();
                        const header = cb.closest('div.space-y-2').previousElementSibling.textContent;
                        if (header.includes('çŠ¶æ€')) summary.State.push(label);
                        else if (header.includes('åŠ¨ä½œ')) summary.Action.push(label);
                        else if (header.includes('å¥–åŠ±')) summary.Reward.push(label);
                        else if (header.includes('æˆæœ¬')) summary.Cost.push(label);
                    }
                });
                
                const renderList = (key) => {
                    const list = summary[key];
                    const el = document.getElementById(`summary-${key}-ch7`);
                    if(el) el.innerHTML = list.length ? list.map(item => `<li>${item}</li>`).join('') : '<li>æœªé€‰</li>';
                }
                ['State', 'Action', 'Reward', 'Cost'].forEach(renderList);
            }

            checkboxes.forEach(cb => {
                cb.addEventListener('change', () => {
                    const targetEl = document.getElementById(cb.dataset.target);
                    if (!targetEl) return;
                    targetEl.classList.toggle('hidden', !cb.checked);
                    
                    targetEl.classList.remove('reward-highlight', 'cost-highlight');
                    if (cb.checked) {
                        if (cb.dataset.type === 'reward') targetEl.classList.add('reward-highlight');
                        else if (cb.dataset.type === 'cost') targetEl.classList.add('cost-highlight');
                    }
                    updateSummary();
                });
            });

            Object.values(controls).forEach(slider => {
                if(slider) slider.addEventListener('input', updateSimulation);
            });
            updateSimulation();
            updateSummary();
        }

        function initSimRealCanvas() {
            const canvas = document.getElementById('sim-real-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const slider = document.getElementById('model-quality-slider');
            const valueDisp = document.getElementById('model-quality-value');
            let quality = 50;

            if (slider) slider.oninput = (e) => {
                quality = parseInt(e.target.value);
                if (valueDisp) valueDisp.textContent = quality;
            };

            let time = 0;
            const draw = () => {
                if(!document.getElementById('sim-real-canvas')) {
                    if(window.activeAnimationFrames.simReal) cancelAnimationFrame(window.activeAnimationFrames.simReal);
                    return;
                }
                const w = canvas.width, h = canvas.height;
                const isDark = document.documentElement.classList.contains('dark');
                ctx.clearRect(0, 0, w, h);
                time += 0.01;

                ctx.beginPath(); 
                ctx.strokeStyle = isDark ? '#f1f5f9' : '#1e293b'; 
                ctx.lineWidth = 3;
                for (let x = 0; x < w; x++) {
                    const y = h / 2 + Math.sin(x * 0.03 + time) * h / 6 + Math.cos(x * 0.07 + time) * h / 8;
                    x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                }
                ctx.stroke();

                ctx.beginPath(); 
                ctx.strokeStyle = '#3b82f6'; 
                ctx.lineWidth = 2; 
                ctx.setLineDash([5, 5]);
                const noise_amplitude = (100 - quality) / 100 * h / 3;
                for (let x = 0; x < w; x++) {
                    const real_y = h / 2 + Math.sin(x * 0.03 + time) * h / 6 + Math.cos(x * 0.07 + time) * h / 8;
                    const sim_y = real_y + (Math.random() - 0.5) * noise_amplitude;
                    x === 0 ? ctx.moveTo(x, sim_y) : ctx.lineTo(x, sim_y);
                }
                ctx.stroke();
                ctx.setLineDash([]);
                
                window.activeAnimationFrames.simReal = requestAnimationFrame(draw);
            };
            draw();
        }

        function initRlTrainingLab() {
            const canvas = document.getElementById('rl-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const chartCtx = document.getElementById('rewardChart')?.getContext('2d');
            if (!chartCtx) return;

            const GRID_SIZE = 8;
            const GOAL = { x: GRID_SIZE - 1, y: GRID_SIZE - 1 };
            const TRAPS = [{x: 2,y: 2},{x: 2,y: 3},{x: 3,y: 2},{x: 5,y: 5},{x: 6,y: 5}];
            
            let agent, q_table, episode, totalReward, rewardHistory, rewardChart, simParams;

            const sliders = {
                gamma: document.getElementById('gamma-slider'),
                lr: document.getElementById('lr-slider'),
                epsilon: document.getElementById('epsilon-slider-ch9'),
            };
            const valueLabels = {
                gamma: document.getElementById('gamma-value'),
                lr: document.getElementById('lr-value'),
                epsilon: document.getElementById('epsilon-value-ch9'),
            };

            function setupParams() {
                simParams = {
                    gamma: parseFloat(sliders.gamma.value),
                    lr: parseFloat(sliders.lr.value),
                    epsilon: parseFloat(sliders.epsilon.value),
                };
                valueLabels.gamma.textContent = simParams.gamma.toFixed(2);
                valueLabels.lr.textContent = simParams.lr.toFixed(2);
                valueLabels.epsilon.textContent = simParams.epsilon.toFixed(2);
            }
            
            function resetSimulation() {
                if (window.rlSimulationIntervalId) clearInterval(window.rlSimulationIntervalId);
                
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                
                q_table = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(0).map(() => [0, 0, 0, 0]));
                episode = 0;
                totalReward = 0;
                rewardHistory = [];

                setupParams();
                resetChart();
                updateCounters();

                window.rlSimulationIntervalId = setInterval(runEpisode, 50);
            }

            function runEpisode() {
                if (episode > 1000) {
                    clearInterval(window.rlSimulationIntervalId);
                    return;
                }
                agent = { x: 0, y: 0 };
                let episodeReward = 0, done = false, steps = 0;

                while (!done && steps < 50) {
                    const state = { x: agent.x, y: agent.y };
                    const action = chooseAction(state);
                    const nextState = getNextState(state, action);
                    const reward = getReward(nextState);
                    
                    const old_q = q_table[state.y][state.x][action];
                    const next_max_q = Math.max(...q_table[nextState.y][nextState.x]);
                    q_table[state.y][state.x][action] = old_q + simParams.lr * (reward + simParams.gamma * next_max_q - old_q);

                    agent = nextState;
                    episodeReward += reward;
                    steps++;
                    done = isTerminal(nextState);
                }
                
                episode++;
                rewardHistory.push(episodeReward);
                updateChart();
                updateCounters();
                drawGrid();
            }

            function chooseAction(state) {
                if (Math.random() < simParams.epsilon) return Math.floor(Math.random() * 4);
                const q_values = q_table[state.y][state.x];
                return q_values.indexOf(Math.max(...q_values));
            }

            function getNextState({x,y}, action) {
                if (action === 0) y = Math.max(0, y - 1);
                else if (action === 1) y = Math.min(GRID_SIZE - 1, y + 1);
                else if (action === 2) x = Math.max(0, x - 1);
                else if (action === 3) x = Math.min(GRID_SIZE - 1, x + 1);
                return { x, y };
            }

            function getReward(state) {
                if (state.x === GOAL.x && state.y === GOAL.y) return 100;
                if (TRAPS.some(t => t.x === state.x && t.y === state.y)) return -100;
                return -1;
            }
            
            function isTerminal(state) {
                return (state.x === GOAL.x && state.y === GOAL.y) || TRAPS.some(t => t.x === state.x && t.y === state.y);
            }
            
            function drawGrid() {
                const cellSize = canvas.width / GRID_SIZE;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const isDark = document.documentElement.classList.contains('dark');

                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        if(TRAPS.some(t => t.x === x && t.y === y)) ctx.fillStyle = isDark ? '#450a0a' : '#fee2e2';
                        else if(GOAL.x === x && GOAL.y === y) ctx.fillStyle = isDark ? '#064e3b' : '#dcfce7';
                        else ctx.fillStyle = isDark ? '#334155' : '#f1f5f9';
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);

                        if (!isTerminal({x,y})) {
                            const max_q = Math.max(...q_table[y][x]);
                            const bestAction = q_table[y][x].indexOf(max_q);
                            ctx.fillStyle = isDark ? '#cbd5e1' : 'rgba(0, 0, 0, 0.6)';
                            ctx.font = `${cellSize * 0.4}px sans-serif`;
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.fillText(['â†‘', 'â†“', 'â†', 'â†’'][bestAction], x * cellSize + cellSize / 2, y * cellSize + cellSize / 2);
                        }
                    }
                }
                
                ctx.font = `${cellSize * 0.6}px sans-serif`;
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText('S', cellSize / 2, cellSize / 2);
                ctx.fillText('ğŸ†', GOAL.x * cellSize + cellSize / 2, GOAL.y * cellSize + cellSize / 2);
                TRAPS.forEach(t => ctx.fillText('â˜ ï¸', t.x * cellSize + cellSize / 2, t.y * cellSize + cellSize / 2));

                ctx.fillStyle = '#3b82f6';
                ctx.beginPath();
                ctx.arc(agent.x * cellSize + cellSize / 2, agent.y * cellSize + cellSize / 2, cellSize / 3.5, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            function resetChart() {
                if (rewardChart) rewardChart.destroy();
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#94a3b8' : '#475569';
                const gridColor = isDark ? 'rgba(148, 163, 184, 0.2)' : 'rgba(0, 0, 0, 0.1)';

                rewardChart = new Chart(chartCtx, {
                    type: 'line',
                    data: { labels: [], datasets: [{ label: 'æœ€è¿‘20å›åˆå¹³å‡å¥–åŠ±', data: [], borderColor: '#16a34a', tension: 0.2, pointRadius: 0, fill: true, backgroundColor: 'rgba(22, 163, 74, 0.1)' }] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { title: { display: true, text: 'å¥–åŠ±', color: textColor }, grid: { color: gridColor }, ticks: { color: textColor } } }, plugins: { legend: { display: false } } }
                });
            }

            function updateChart() {
                if (!rewardChart || episode % 10 !== 0) return;
                const recentRewards = rewardHistory.slice(-20);
                totalReward = recentRewards.reduce((a, b) => a + b, 0) / recentRewards.length;
                
                rewardChart.data.labels.push(episode);
                rewardChart.data.datasets[0].data.push(totalReward);
                if (rewardChart.data.labels.length > 50) {
                    rewardChart.data.labels.shift();
                    rewardChart.data.datasets[0].data.shift();
                }
                rewardChart.update('none');
            }

            function updateCounters() {
                document.getElementById('episode-counter').textContent = episode;
                document.getElementById('total-reward').textContent = totalReward.toFixed(2);
            }
            
            document.getElementById('start-sim').addEventListener('click', resetSimulation);
            Object.values(sliders).forEach(slider => slider.addEventListener('input', setupParams));
            resetSimulation();
        }

        function selectStep(step) {
            const contentEl = document.getElementById('step-content');
            if (!contentEl) return;
            const content = {
                1: { title: "é˜¶æ®µä¸€ï¼šå»ºè®®æ¨¡å¼ (Advisory Mode)", description: "RLæ™ºèƒ½ä½“ä»¥â€œå½±å­æ¨¡å¼â€è¿è¡Œï¼Œå®æ—¶æ¥æ”¶ç”µå‚æ•°æ®å¹¶è®¡ç®—æœ€ä¼˜åŠ¨ä½œã€‚ä½†è¿™äº›åŠ¨ä½œå¹¶<strong>ä¸</strong>ç›´æ¥æ‰§è¡Œï¼Œè€Œæ˜¯ä½œä¸ºæ“ä½œå»ºè®®æ˜¾ç¤ºåœ¨æ“ä½œå‘˜ç«™çš„ç•Œé¢ä¸Šï¼Œç”±ç»éªŒä¸°å¯Œçš„äººå·¥æ“ä½œå‘˜ç¡®è®¤åæ‰§è¡Œã€‚", goals: ["åœ¨é›¶é£é™©ä¸‹éªŒè¯AIç­–ç•¥çš„é•¿æœŸæ€§èƒ½ã€‚", "è®©æ“ä½œå‘˜é€æ­¥ç†Ÿæ‚‰å’Œä¿¡ä»»AIçš„å†³ç­–é€»è¾‘ã€‚", "æ”¶é›†å¯¹æ¯”æ•°æ®ï¼Œé‡åŒ–AIç›¸æ¯”çº¯äººå·¥æ“ä½œçš„å…·ä½“æå‡ã€‚"], risk_mitigation: "æ“ä½œå‘˜æ‹¥æœ‰100%çš„æœ€ç»ˆæ§åˆ¶æƒï¼ŒAIæ— ä»»ä½•ç‰©ç†æ‰§è¡Œèƒ½åŠ›ï¼Œå®ç°ç»å¯¹å®‰å…¨ã€‚" },
                2: { title: "é˜¶æ®µäºŒï¼šç›‘ç£æ§åˆ¶ (Supervisory Control)", description: "AIçš„è¾“å‡ºä¸å†æ˜¯ç›´æ¥çš„é˜€é—¨åŠ¨ä½œï¼Œè€Œæ˜¯è°ƒæ•´DCSä¸­ç°æœ‰PIDæ§åˆ¶å›è·¯çš„<strong>è®¾å®šå€¼</strong>ã€‚ä¾‹å¦‚ï¼ŒAIå†³å®šå°†â€œæ€»é£é‡PIDâ€çš„ç›®æ ‡å€¼ä»50%è°ƒæ•´åˆ°55%ã€‚", goals: ["åœ¨ä¸æ”¹å˜åº•å±‚å¯é æ§åˆ¶ç»“æ„çš„å‰æä¸‹ï¼Œå®ç°æ›´é«˜å±‚çº§çš„ä¼˜åŒ–ã€‚", "åˆ©ç”¨ç°æœ‰DCSç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨è”é”ä½œä¸ºåº•å±‚å®‰å…¨ç½‘ã€‚", "åœ¨çœŸå®çš„é—­ç¯åé¦ˆä¸‹å¯¹æ¨¡å‹è¿›è¡Œåœ¨çº¿å¾®è°ƒã€‚"], risk_mitigation: "æ™ºèƒ½ä½“çš„ä½œç”¨èŒƒå›´è¢«é™åˆ¶åœ¨é«˜å±‚è®¾å®šå€¼ï¼Œåº•å±‚çš„å¿«é€Ÿè°ƒèŠ‚å’Œå®‰å…¨ä¿æŠ¤ä»ç”±ä¹…ç»è€ƒéªŒçš„PIDç³»ç»Ÿå®Œæˆï¼Œæå¤§é™ä½äº†é£é™©ã€‚" },
                3: { title: "é˜¶æ®µä¸‰ï¼šç›´æ¥æ§åˆ¶ (Direct Control)", description: "AIè·å¾—å¯¹æ‰§è¡Œæœºæ„çš„ç›´æ¥æ§åˆ¶æƒã€‚ä½†å…¶è¾“å‡ºçš„æ‰€æœ‰æŒ‡ä»¤åœ¨å‘é€ç»™DCSä¹‹å‰ï¼Œå¿…é¡»å¼ºåˆ¶é€šè¿‡ä¸€ä¸ªæœ€ç»ˆçš„ã€ç¡¬ç¼–ç çš„<strong>å®‰å…¨å±‚ (Safety Layer)</strong>ã€‚", goals: ["å®ç°å®Œå…¨çš„è‡ªä¸»ä¼˜åŒ–ï¼Œå¯¹å·¥å†µå˜åŒ–åšå‡ºæœ€å¿«é€Ÿã€æœ€ç›´æ¥çš„å“åº”ã€‚", "æœ€å¤§åŒ–RLç­–ç•¥çš„æ€§èƒ½ã€‚"], risk_mitigation: "â€œå®‰å…¨å±‚â€æ˜¯ä¸€ä¸ªéAIçš„ã€åŸºäºç®€å•è§„åˆ™çš„ç¨‹åºã€‚å®ƒä¼šæ£€æŸ¥AIçš„æ¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œå¹¶ç«‹å³å¦å†³ä»»ä½•å¯èƒ½è¿åç¡¬æ€§å®‰å…¨çº¦æŸçš„åŠ¨ä½œã€‚è¿™æ˜¯å¯¹æŠ—AIä¸å¯é¢„è§è¡Œä¸ºçš„æœ€åä¸€é“é˜²çº¿ã€‚" }
            };
            for (let i = 1; i <= 3; i++) document.getElementById(`step${i}`)?.classList.toggle('active', i === step);
            const selectedContent = content[step];
            if (selectedContent) {
                contentEl.innerHTML = `<h3 class="text-xl font-bold mb-4">${selectedContent.title}</h3><p class="text-themed-secondary mb-4">${selectedContent.description}</p><h4 class="font-bold text-lg mb-2">ä¸»è¦ç›®æ ‡:</h4><ul class="list-disc list-inside space-y-1 text-themed-secondary mb-4">${selectedContent.goals.map(g => `<li>${g}</li>`).join('')}</ul><h4 class="font-bold text-lg mb-2">é£é™©æ§åˆ¶:</h4><p class="p-3 bg-green-500/10 border border-green-500/20 text-green-700 dark:text-green-300 rounded-lg">${selectedContent.risk_mitigation}</p>`;
            }
        }

        function renderBoilerDiagram() {
            const container = document.getElementById('boiler-diagram-container');
            if (!container) return;
            container.innerHTML = `<svg viewBox="0 0 300 200" xmlns="http://www.w3.org/2000/svg"><style>.txt{font-size:8px; font-family: 'Noto Sans SC', sans-serif; text-anchor: middle; fill: var(--text-secondary);} .line{stroke: var(--text-secondary); fill: none;} .arr{marker-end: url(#arrow); stroke-width: 0.8; stroke: var(--text-secondary); fill: none;}</style><defs><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="var(--text-secondary)"/></marker></defs><rect x="100" y="20" width="100" height="160" fill="var(--bg-muted)" stroke="var(--border-color)" stroke-width="1.5"/><text x="150" y="15" class="txt">é”…ç‚‰</text><path d="M120,20 v-10 h60 v10" class="line" stroke-width="1.5"/><path d="M145,10 v-5 h10 v5" class="line" stroke-width="1.5"/><text x="150" y="7" class="txt" fill="#c2410c">è¿‡çƒ­è’¸æ±½</text><rect x="110" y="100" width="80" height="40" fill="#fef9c3" stroke="#facc15" /><text x="150" y="125" class="txt">ç‡ƒçƒ§åŒº</text><path d="M100,140 h-20 v-10 h20" class="arr" /><text x="65" y="135" class="txt">ç‡ƒæ–™+ç©ºæ°”</text><path d="M200,160 h20 v-10 h-20" class="arr" /><text x="225" y="155" class="txt">ç°æ¸£</text><rect x="230" y="60" width="50" height="80" fill="#dbeafe" stroke="#60a5fa" stroke-width="1"/><text x="255" y="55" class="txt">æ±½è½®æœº</text><path d="M150,25 h80 v40" class="arr" /><rect x="230" y="150" width="50" height="30" fill="#e0f2fe" stroke="#38bdf8" stroke-width="1"/><text x="255" y="145" class="txt">å†·å‡å™¨</text><path d="M255,140 v-35" class="arr" /><rect x="40" y="160" width="50" height="20" fill="#dcfce7" stroke="#4ade80" stroke-width="1"/><text x="65" y="155" class="txt">ç»™æ°´æ³µ</text><path d="M255,180 h-190 v-15" class="arr" /><path d="M40,170 h-10 v-20 h80" class="arr" /></svg>`;
        }

        function renderRankineDiagram() {
            const container = document.getElementById('rankine-diagram-container');
            if (!container) return;
            container.innerHTML = `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg"><style>.txt{font-size:7px; font-family: 'Noto Sans SC', sans-serif; fill: var(--text-primary);} .lbl{font-size:6px; fill: var(--text-secondary);} .line{stroke-width:1; stroke:var(--text-secondary); fill:none;} .cycle{stroke-width:1.5; stroke:#ef4444; fill:none; marker-end: url(#arrow-red);}</style><defs><marker id="arrow-red" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="3" markerHeight="3" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#ef4444"/></marker></defs><path d="M20,140 L20,10 L180,10" class="line" /><text x="15" y="15" class="txt" text-anchor="end">T</text><text x="180" y="15" class="txt" text-anchor="end">s</text><path d="M40,120 C 80,120 80,40 120,40" class="line" /><text x="80" y="30" class="lbl">é¥±å’Œè’¸æ±½çº¿</text><path d="M40,120 C 30,80 30,40 40,30" class="line" /><text x="35" y="25" class="lbl">é¥±å’Œæ¶²ä½“çº¿</text><path d="M45,115 L45,80" class="cycle"/><text x="38" y="100" class="txt">1â†’2</text><text x="52" y="100" class="lbl">(æ³µ)</text><path d="M45,80 C60,78 140,75 160,45" class="cycle"/><text x="40" y="78" class="txt"></text><text x="90" y="65" class="lbl">(é”…ç‚‰)</text><path d="M160,45 L170,105" class="cycle"/><text x="158" y="40" class="txt">2â†’3</text><text x="175" y="70" class="lbl">(æ±½è½®æœº)</text><path d="M170,105 L45,115" class="cycle"/><text x="173" y="108" class="txt">3â†’4</text><text x="110" y="120" class="lbl">(å†·å‡å™¨)</text></svg>`;
        }

        function renderRlTaxonomy() {
            const container = document.getElementById('rl-taxonomy-container');
            if (!container) return;
            container.innerHTML = `<svg viewBox="0 0 250 150" xmlns="http://www.w3.org/2000/svg"><style>.box{fill:var(--bg-secondary); stroke:var(--accent-color); rx:3;} .txt{font-size:8px; font-family: 'Noto Sans SC', sans-serif; text-anchor:middle; fill: var(--text-primary);} .line{stroke:var(--text-secondary); stroke-width:0.5;}</style><rect x="85" y="5" width="80" height="15" class="box" /><text x="125" y="14" class="txt">å¼ºåŒ–å­¦ä¹ </text><line x1="125" y1="20" x2="125" y2="30" class="line" /><line x1="60" y1="30" x2="190" y2="30" class="line" /><line x1="60" y1="30" x2="60" y2="40" class="line" /><line x1="190" y1="30" x2="190" y2="40" class="line" /><rect x="20" y="40" width="80" height="15" class="box" /><text x="60" y="49" class="txt">åŸºäºæ¨¡å‹</text><rect x="150" y="40" width="80" height="15" class="box" /><text x="190" y="49" class="txt">æ— æ¨¡å‹</text><line x1="190" y1="55" x2="190" y2="65" class="line" /><line x1="155" y1="65" x2="225" y2="65" class="line" /><line x1="155" y1="65" x2="155" y2="75" class="line" /><line x1="225" y1="65" x2="225" y2="75" class="line" /><rect x="115" y="75" width="80" height="15" class="box" /><text x="155" y="84" class="txt">åŸºäºç­–ç•¥</text><rect x="185" y="75" width="80" height="15" class="box" /><text x="225" y="84" class="txt">åŸºäºä»·å€¼</text><line x1="155" y1="90" x2="155" y2="100" class="line" /><rect x="115" y="100" width="80" height="15" style="fill:#dcfce7; stroke:#4ade80;" /><text x="155" y="109" class="txt">PPO</text><line x1="225" y1="90" x2="225" y2="100" class="line" /><rect x="185" y="100" width="80" height="15" style="fill:#fef9c3; stroke:#facc15;" /><text x="225" y="109" class="txt">DQN</text><path d="M155,90 C175,95 205,95 225,90" fill="none" class="line"/><line x1="190" y1="92.5" x2="190" y2="120" class="line"/><text x="190" y="108" class="txt">æ¼”å‘˜-è¯„è®ºå®¶</text><rect x="150" y="120" width="80" height="15" style="fill:#fbcfe8; stroke:#f472b6;" /><text x="190" y="129" class="txt">SAC / DDPG</text></svg>`;
        }

        function renderAcDiagram(container) {
            if (!container) return;
            container.innerHTML = `<svg id="ac-viz-svg" viewBox="0 0 400 300" class="w-full max-w-lg"><defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="5" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#9ca3af" /></marker><marker id="arrowhead-h" markerWidth="10" markerHeight="7" refX="5" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#f97316" /></marker></defs><style>.ac-node rect { transition: all 0.3s ease; transform-origin: center; } .ac-node.highlight rect { stroke-width:3; transform: scale(1.05); stroke: #f97316; } .ac-arrow { transition: stroke 0.3s ease; } text { fill: var(--text-primary); font-size:12px; font-family: 'Noto Sans SC', sans-serif; text-anchor: middle; }</style><g class="ac-node" id="node-state"><rect x="10" y="30" width="80" height="40" rx="5" fill="var(--bg-secondary)" stroke="var(--border-color)" stroke-width="2" /></g><text x="50" y="25">çŠ¶æ€ S</text><path class="ac-arrow" id="arrow-to-actor" d="M95,50 C140,50 140,90 185,90" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-node" id="node-actor"><rect x="185" y="85" width="80" height="40" rx="20" fill="#eff6ff" stroke="#60a5fa" stroke-width="2" /></g><text x="225" y="80">æ¼”å‘˜ Actor</text><path class="ac-arrow" id="arrow-to-action" d="M225,130 Q225,150 225,170" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-node" id="node-action"><rect x="185" y="170" width="80" height="40" rx="5" fill="var(--bg-secondary)" stroke="var(--border-color)" stroke-width="2" /></g><text x="225" y="165">åŠ¨ä½œ A</text><path class="ac-arrow" id="arrow-to-env" d="M180,190 C140,190 140,230 105,230" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-node" id="node-env"><rect x="25" y="225" width="80" height="40" rx="20" fill="#fff7ed" stroke="#fb923c" stroke-width="2" /></g><text x="65" y="220">ç¯å¢ƒ Env</text><path class="ac-arrow" id="arrow-to-critic" d="M110,245 C160,245 250,245 295,245" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><text x="200" y="265" font-size="10">å¥–åŠ± R, æ–°çŠ¶æ€ S'</text><g class="ac-node" id="node-critic"><rect x="300" y="225" width="80" height="40" rx="20" fill="#f0fdf4" stroke="#4ade80" stroke-width="2" /></g><text x="340" y="220">è¯„è®ºå®¶ Critic</text><path class="ac-arrow" id="arrow-critic-to-actor" d="M340,220 C340,150 270,150 265,125" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5" /><g id="label-update"><text x="310" y="170" font-weight="bold" font-size="12" fill="transparent">ä¼˜åŠ¿ A(s,a)</text></g></svg>`;
        }

    </script>
</body>
</html>
