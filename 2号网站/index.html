<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½é”…ç‚‰å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–å¹³å° (Proç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']]
          }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --bg-primary: #f8fafc; --bg-secondary: #ffffff; --bg-muted: #f1f5f9;
            --text-primary: #1e293b; --text-secondary: #475569; --border-color: #e2e8f0;
            --accent-color: #4f46e5; --accent-text: #ffffff;
            --card-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.07), 0 2px 4px -2px rgb(0 0 0 / 0.07);
            --card-shadow-hover: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --glow-color: rgba(79, 70, 229, 0.2);
        }
        .dark {
            --bg-primary: #0f172a; --bg-secondary: #1e293b; --bg-muted: #334155;
            --text-primary: #f1f5f9; --text-secondary: #94a3b8; --border-color: #334155;
            --accent-color: #6366f1; --accent-text: #ffffff;
            --card-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --card-shadow-hover: 0 10px 15px -3px rgb(0 0 0 / 0.2), 0 4px 6px -4px rgb(0 0 0 / 0.2);
            --glow-color: rgba(99, 102, 241, 0.3);
        }
        html { scroll-padding-top: 80px; }
        body { 
            font-family: 'Noto Sans SC', sans-serif; 
            background-color: var(--bg-primary); 
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Animations & Transitions */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        #content-container { animation: fadeIn 0.5s ease-out; }

        /* Navigation */
        .dropdown-menu { display: none; animation: fadeIn 0.2s ease-out; }
        .dropdown.open .dropdown-menu { display: block; }
        .nav-link.active { font-weight: bold; color: var(--accent-color); }
        .nav-link-completed::after {
            content: 'âœ”'; color: #22c55e; font-weight: bold; margin-left: auto;
        }
        .nav-dropdown-btn.active {
            background-color: var(--bg-muted); color: var(--accent-color);
        }

        /* Components */
        .card { 
            background-color: var(--bg-secondary); border-radius: 0.75rem; 
            box-shadow: var(--card-shadow); transition: all 0.3s ease-in-out; 
            border: 1px solid var(--border-color); 
        }
        .card:hover { 
            transform: translateY(-4px); box-shadow: var(--card-shadow-hover), 0 0 20px var(--glow-color); 
        }
        h2 { 
            border-bottom: 2px solid var(--border-color); color: var(--text-primary); 
            font-size: 2.25rem; font-weight: 800; padding-bottom: 0.5rem; margin-bottom: 1.5rem;
        }
        h3 { 
            color: var(--text-primary); font-size: 1.5rem; font-weight: 700; 
            margin-top: 2rem; margin-bottom: 1rem;
        }
        
        /* Modal styles */
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 50; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-backdrop.visible { opacity: 1; pointer-events: auto; }
        .modal-content { background-color: var(--bg-secondary); padding: 2rem; border-radius: 0.75rem; max-width: 90%; width: 420px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.visible .modal-content { transform: scale(1); }

        /* Other visual styles */
        .flame-visual { position: absolute; bottom: 0; left: 50%; transform-origin: bottom center; width: 60%; margin-left: -30%; background: linear-gradient(to top, #ffde00, #ff8c00, rgba(255,140,0,0)); border-radius: 50% 50% 10% 10% / 100% 100% 20% 20%; transition: all 0.4s ease-in-out; animation: flicker-animation 0.3s infinite alternate; }
        #boiler-visual-container, #boiler-visual-container-ch7 { box-shadow: inset 0 0 15px rgba(0,0,0,0.5); border: 3px solid #475569; }
        @keyframes flicker-animation { 
            0% { transform: scaleY(1) skewX(0deg); opacity: 0.9; filter: brightness(1); } 
            50% { transform: scaleY(0.95) skewX(3deg); opacity: 1; filter: brightness(1.1); } 
            100% { transform: scaleY(1.05) skewX(-3deg); opacity: 0.95; filter: brightness(1.2); } 
        }
        .deployment-step { transition: all 0.3s ease; border-left-width: 4px; border-color: transparent; }
        .deployment-step.active { border-color: var(--accent-color); background-color: rgba(79, 70, 229, 0.1); }
        pre { background-color: var(--bg-muted); padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-family: 'Courier New', Courier, monospace; font-size: 0.9em; color: var(--text-primary); position: relative; }
        .copy-btn { position: absolute; top: 0.5rem; right: 0.5rem; background-color: var(--border-color); color: var(--text-secondary); border: none; padding: 0.25rem 0.5rem; border-radius: 0.25rem; cursor: pointer; opacity: 0.5; transition: opacity 0.2s; }
        pre:hover .copy-btn { opacity: 1; }
        .preview-component.hidden { display: none; }
        .preview-component.reward-highlight { background-color: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e; padding-left: 8px;}
        .preview-component.cost-highlight { background-color: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; padding-left: 8px; }
        .slider::-webkit-slider-thumb { background: var(--accent-color); box-shadow: 0 0 0 3px var(--bg-secondary), 0 0 0 4px var(--accent-color); }
        #back-to-top { transition: opacity 0.3s, transform 0.3s; }

        /* Landing page background animation */
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; }
        }
        .animated-gradient {
            background: linear-gradient(270deg, #f3e8ff, #e0e7ff, #f0f9ff);
            background-size: 600% 600%;
            animation: gradient-animation 16s ease infinite;
        }
        .dark .animated-gradient {
             background: linear-gradient(270deg, #1e1b4b, #1e293b, #0c4a6e);
             background-size: 600% 600%;
             animation: gradient-animation 16s ease infinite;
        }

    </style>
</head>
<body>
    <!-- Revamped Landing Page -->
    <section id="home-landing" class="min-h-screen flex flex-col justify-center items-center p-4 animated-gradient">
        <div class="max-w-4xl text-center">
            <h1 class="text-5xl md:text-7xl font-extrabold text-indigo-700 dark:text-indigo-400 mb-6" style="animation: fadeInUp 0.8s ease-out both;">
                æ™ºèƒ½é”…ç‚‰å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–å¹³å°
            </h1>
            <p class="text-lg text-slate-600 dark:text-slate-300 mb-10 max-w-3xl mx-auto" style="animation: fadeInUp 0.8s ease-out 0.2s both;">
                èåˆæ·±åº¦å¼ºåŒ–å­¦ä¹ ä¸å·¥ä¸šæœºç†ï¼Œé©±åŠ¨ä¼ ç»Ÿèƒ½æºçš„æ™ºèƒ½åŒ–å˜é©ã€‚æˆ‘ä»¬æä¾›ä»ç†è®ºå­¦ä¹ ã€ä»¿çœŸå®éªŒåˆ°éƒ¨ç½²ç­–ç•¥çš„å…¨é“¾è·¯è§£å†³æ–¹æ¡ˆã€‚
            </p>
            <button id="start-experience-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-indigo-700 hover:shadow-xl transform hover:-translate-y-1 transition-all text-xl" style="animation: fadeInUp 0.8s ease-out 0.4s both;">
                <i class="fa-solid fa-rocket mr-2"></i>å¼€å¯å­¦ä¹ ä¹‹æ—…
            </button>
        </div>
        <div class="max-w-6xl mx-auto mt-20 grid md:grid-cols-3 gap-8 px-4" style="animation: fadeInUp 0.8s ease-out 0.6s both;">
            <div class="card p-6 text-left hover:-translate-y-2">
                <i class="fa-solid fa-book-open text-3xl text-indigo-500 mb-4"></i>
                <h3 class="text-xl font-bold mt-0 mb-2">ç³»ç»ŸåŒ–ç†è®º</h3>
                <p class="text-themed-secondary text-sm">ä»MDPåˆ°PPO/SACï¼Œå±‚å±‚é€’è¿›ï¼Œæ„å»ºåšå®çš„ç†è®ºåŸºç¡€ã€‚</p>
            </div>
            <div class="card p-6 text-left hover:-translate-y-2">
                <i class="fa-solid fa-flask-vial text-3xl text-indigo-500 mb-4"></i>
                <h3 class="text-xl font-bold mt-0 mb-2">äº¤äº’å¼å®éªŒ</h3>
                <p class="text-themed-secondary text-sm">åœ¨å¤šä¸ªå¯è§†åŒ–æ²™ç®±ä¸­ï¼Œäº²æ‰‹è°ƒèŠ‚å‚æ•°ï¼Œç›´è§‚æ„Ÿå—ç®—æ³•æ ¸å¿ƒã€‚</p>
            </div>
            <div class="card p-6 text-left hover:-translate-y-2">
                <i class="fa-solid fa-cogs text-3xl text-indigo-500 mb-4"></i>
                <h3 class="text-xl font-bold mt-0 mb-2">å·¥ç¨‹åŒ–å®è·µ</h3>
                <p class="text-themed-secondary text-sm">å­¦ä¹ ä»æ•°å­—å­ªç”Ÿåˆ°ä¸‰é˜¶æ®µå®‰å…¨éƒ¨ç½²çš„å®Œæ•´å·¥ä¸šè½åœ°æµç¨‹ã€‚</p>
            </div>
        </div>
        <footer class="text-center text-slate-500 dark:text-slate-400 text-sm py-6 w-full absolute bottom-0 border-t border-slate-200 dark:border-slate-700">
            &copy; 2025 æ™ºèƒ½é”…ç‚‰ä¼˜åŒ–å¹³å° | æŠ€æœ¯æ”¯æŒï¼šHGCå›¢é˜Ÿ | 
            <i class="fa-solid fa-eye"></i> è®¿é—®é‡: <span id="visitor-count">åŠ è½½ä¸­...</span>
        </footer>
    </section>

    <!-- Main App Interface -->
    <div id="main-app" class="hidden">
        <header class="bg-themed-secondary/80 dark:bg-themed-secondary/80 backdrop-blur-sm sticky top-0 z-40 w-full border-b border-themed">
            <div class="container mx-auto flex items-center justify-between p-4">
                <div class="flex items-center gap-3 cursor-pointer" id="main-logo">
                    <img src="image/seu-logo.png" alt="ä¸œå—å¤§å­¦logo" class="h-10 w-10 rounded-full bg-white p-0.5" onerror="this.onerror=null;this.src='https://placehold.co/64x64/ffffff/000000?text=SEU';" />
                    <h1 class="text-xl font-bold text-indigo-500 dark:text-indigo-400 hidden sm:block">RLé”…ç‚‰ä¼˜åŒ–å¹³å°</h1>
                </div>
                <div class="relative hidden md:block" id="search-container">
                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-themed-secondary"></i>
                    <input type="text" id="search-input" placeholder="æœç´¢ç« èŠ‚..." class="w-64 bg-themed-muted border border-themed rounded-lg py-1.5 pl-9 pr-4 focus:outline-none focus:ring-2 focus:ring-accent-color">
                    <div id="search-results" class="hidden absolute top-full left-0 mt-2 w-full bg-themed-secondary rounded-lg shadow-xl border border-themed p-2 z-50"></div>
                </div>
                <nav class="hidden md:flex items-center gap-2" id="desktop-nav"></nav>
                <div class="flex items-center gap-4">
                    <div id="auth-section"></div>
                    <button id="theme-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-themed-muted transition-colors">
                        <i id="theme-icon" class="fa-solid fa-moon"></i>
                    </button>
                    <button id="mobile-menu-btn" class="md:hidden w-10 h-10 flex items-center justify-center rounded-lg hover:bg-themed-muted transition-colors">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>
            </div>
            <div id="mobile-menu" class="hidden md:hidden border-t border-themed p-4"></div>
        </header>
        
        <main class="container mx-auto p-4 md:p-8">
            <div id="breadcrumb" class="mb-4 text-sm text-themed-secondary"></div>
            <div id="content-container"></div>
        </main>
    </div>

    <!-- Modals -->
    <div id="auth-modal" class="modal-backdrop"></div>
    
    <!-- Back to Top Button -->
    <button id="back-to-top" class="fixed bottom-5 right-5 w-12 h-12 rounded-full bg-indigo-600 text-white shadow-lg flex items-center justify-center opacity-0 transform translate-y-4 pointer-events-none">
        <i class="fa-solid fa-arrow-up"></i>
    </button>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, runTransaction, arrayUnion } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- App State ---
        const state = { currentUser: null, userProgress: [], currentView: '', activeAnimationFrames: {} };

        // --- Firebase Configuration and Initialization ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'rl-boiler-app-pro';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        let app, auth, db;

        if (firebaseConfig) {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                setupAuthListener();
                incrementAndShowVisitorCount();
            } catch (e) { console.error("Firebase initialization failed:", e); }
        } else {
            console.warn("Firebase config not found. Some features like user progress and visitor count will be disabled.");
        }

        // --- Authentication & User Progress ---
        function setupAuthListener() {
            onAuthStateChanged(auth, async user => {
                if (user) {
                    state.currentUser = { uid: user.uid, email: user.email };
                    await fetchUserProgress(user.uid);
                } else {
                    state.currentUser = null;
                    state.userProgress = [];
                }
                renderAuthSection();
                renderNav();
            });
        }
        
        async function fetchUserProgress(userId) {
            if (!db) return;
            const progressRef = doc(db, `artifacts/${appId}/users/${userId}/progress`, 'main');
            const docSnap = await getDoc(progressRef);
            state.userProgress = docSnap.exists() ? docSnap.data().completedChapters || [] : [];
        }

        async function markChapterAsCompleted(chapterId) {
            if (!state.currentUser || state.userProgress.includes(chapterId) || !db) return;
            if (chapterId.startsWith('quiz')) return; // Do not mark quizzes as completed
            state.userProgress.push(chapterId);
            renderNav();
            const progressRef = doc(db, `artifacts/${appId}/users/${state.currentUser.uid}/progress`, 'main');
            try {
                await setDoc(progressRef, { completedChapters: arrayUnion(chapterId) }, { merge: true });
            } catch (error) { console.error("Error updating progress:", error); }
        }

        // --- Visitor Counter ---
        async function incrementAndShowVisitorCount() {
            const visitorCountEl = document.getElementById('visitor-count');
            if (!db) {
                if(visitorCountEl) visitorCountEl.textContent = 'N/A';
                return;
            }
            const counterRef = doc(db, `artifacts/${appId}/public/data/analytics`, 'page_views');
            try {
                await runTransaction(db, async (transaction) => {
                    const counterDoc = await transaction.get(counterRef);
                    const newCount = (counterDoc.data()?.count || 0) + 1;
                    transaction.set(counterRef, { count: newCount });
                });
                const finalDoc = await getDoc(counterRef);
                if (finalDoc.exists() && visitorCountEl) visitorCountEl.textContent = finalDoc.data().count;
            } catch (e) { 
                console.error("Failed to update visitor count:", e); 
                if(visitorCountEl) visitorCountEl.textContent = 'Error';
            }
        }

        // --- UI Element Selectors ---
        const contentContainer = document.getElementById('content-container');
        const desktopNav = document.getElementById('desktop-nav');
        const mobileMenu = document.getElementById('mobile-menu');
        const authSection = document.getElementById('auth-section');
        const authModalContainer = document.getElementById('auth-modal');
        const backToTopBtn = document.getElementById('back-to-top');
        const breadcrumb = document.getElementById('breadcrumb');
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');

        // --- Navigation Structure ---
        const navStructure = [
            { title: 'åŸºç¡€ç¯‡', chapters: ['chapter1', 'chapter2'] },
            { title: 'æ ¸å¿ƒç®—æ³•', chapters: ['chapter3', 'chapter4', 'chapter5', 'chapter6', 'quiz1'] },
            { title: 'å®è·µç¯‡', chapters: ['chapter7', 'chapter8', 'chapter9'] },
            { title: 'éƒ¨ç½²ä¸æœªæ¥', chapters: ['chapter10', 'chapter11', 'chapter12'] },
            { title: 'å…³äº', chapters: ['glossary', 'team', 'resources'] }
        ];
        const chapterDetails = {
            'chapter1': 'é”…ç‚‰ç³»ç»ŸåŸç†', 'chapter2': 'å¼ºåŒ–å­¦ä¹ ä¸–ç•Œè§‚', 'chapter3': 'ä»RLåˆ°æ·±åº¦RL',
            'chapter4': 'æ¼”å‘˜-è¯„è®ºå®¶æ¶æ„', 'chapter5': 'PPOç®—æ³•è¯¦è§£', 'chapter6': 'SACç®—æ³•è¯¦è§£',
            'quiz1': 'é˜¶æ®µå°æµ‹ (æ ¸å¿ƒç®—æ³•)',
            'chapter7': 'CMDPæ„å»ºå®éªŒå®¤', 'chapter8': 'æ„å»ºæ•°å­—å­ªç”Ÿ', 'chapter9': 'è®­ç»ƒå®éªŒä¸è°ƒè¯•',
            'chapter10': 'ä¸‰é˜¶æ®µå®‰å…¨éƒ¨ç½²', 'chapter11': 'æ€»ç»“ä¸æœªæ¥', 'chapter12': 'é«˜çº§ä¸»é¢˜-ç¦»çº¿RL',
            'glossary': 'å…³é”®æœ¯è¯­è¡¨',
            'team': 'å›¢é˜Ÿä»‹ç»', 'resources': 'å…³é”®èµ„æº'
        };

        // --- UI Rendering Functions ---
        function renderNav() {
            const navHtml = navStructure.map(group => `
                <div class="dropdown relative">
                    <button class="nav-dropdown-btn p-2 rounded-lg hover:bg-themed-muted transition-colors flex items-center gap-1" data-group="${group.title}">${group.title} <i class="fa-solid fa-chevron-down text-xs"></i></button>
                    <div class="dropdown-menu hidden absolute top-full left-0 mt-2 w-64 bg-themed-secondary rounded-lg shadow-xl border border-themed p-2 z-50">
                        ${group.chapters.map(id => `<a href="#${id}" data-view="${id}" class="nav-link flex items-center p-2 rounded-md text-sm ${state.userProgress.includes(id) ? 'nav-link-completed' : ''}">${chapterDetails[id]}</a>`).join('')}
                    </div>
                </div>`).join('');
            desktopNav.innerHTML = navHtml;
            mobileMenu.innerHTML = navStructure.flatMap(group => 
                [`<div class="px-2 py-1 text-sm font-semibold text-themed-secondary">${group.title}</div>`]
                .concat(group.chapters.map(id => `<a href="#${id}" data-view="${id}" class="nav-link block p-2 rounded-md text-sm ${state.userProgress.includes(id) ? 'nav-link-completed' : ''}">${chapterDetails[id]}</a>`))
            ).join('');
            updateNavActiveState();
        }

        function renderAuthSection() {
            authSection.innerHTML = state.currentUser ? `
                <div class="dropdown relative">
                    <button class="nav-dropdown-btn w-10 h-10 flex items-center justify-center rounded-full bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-300 font-semibold">
                        ${state.currentUser.email ? state.currentUser.email[0].toUpperCase() : 'A'}
                    </button>
                    <div class="dropdown-menu hidden absolute top-full right-0 mt-2 w-48 bg-themed-secondary rounded-lg shadow-xl border border-themed p-2 z-50">
                        <div class="px-2 py-1 text-xs text-themed-secondary truncate">${state.currentUser.email || 'åŒ¿åç”¨æˆ·'}</div>
                        <div class="my-1 border-t border-themed"></div>
                        <button id="logout-btn" class="w-full text-left p-2 rounded-md text-sm hover:bg-themed-muted">é€€å‡ºç™»å½•</button>
                    </div>
                </div>` : `
                <div class="flex items-center gap-2">
                    <button id="login-btn" class="px-3 py-1.5 text-sm rounded-lg hover:bg-themed-muted transition-colors">ç™»å½•</button>
                    <button id="register-btn" class="px-3 py-1.5 text-sm rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition-colors">æ³¨å†Œ</button>
                </div>`;
        }
        
        function showAuthModal(isLogin = true) {
            authModalContainer.innerHTML = `
                <div class="modal-content">
                    <h3 class="text-xl font-bold text-indigo-500 dark:text-indigo-400 mb-2">${isLogin ? 'ç™»å½•å¹³å°' : 'åˆ›å»ºè´¦æˆ·'}</h3>
                    <p class="text-themed-secondary mb-6 text-sm">å¼€å§‹æ‚¨çš„æ™ºèƒ½ä¼˜åŒ–å­¦ä¹ ä¹‹æ—…ã€‚</p>
                    <div id="auth-error" class="hidden p-3 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800"></div>
                    <form id="auth-form">
                        <div class="space-y-4">
                            <div><label for="auth-email" class="block text-sm font-medium text-themed-secondary">é‚®ç®±</label><input type="email" id="auth-email" required class="mt-1 block w-full bg-themed-muted border border-themed rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></div>
                            <div><label for="auth-password" class="block text-sm font-medium text-themed-secondary">å¯†ç </label><input type="password" id="auth-password" required class="mt-1 block w-full bg-themed-muted border border-themed rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></div>
                        </div>
                        <div class="mt-6 flex items-center justify-between">
                            <button type="button" id="auth-switch-btn" class="text-sm text-indigo-600 hover:underline">${isLogin ? 'æ²¡æœ‰è´¦æˆ·ï¼Ÿå»æ³¨å†Œ' : 'å·²æœ‰è´¦æˆ·ï¼Ÿå»ç™»å½•'}</button>
                            <button type="submit" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">${isLogin ? 'ç™»å½•' : 'æ³¨å†Œ'}</button>
                        </div>
                    </form>
                </div>`;
            authModalContainer.classList.add('visible');
        }

        // --- Event Listeners & App Flow ---
        document.body.addEventListener('click', e => {
            if (e.target.id === 'logout-btn') signOut(auth);
            if (e.target.id === 'login-btn') showAuthModal(true);
            if (e.target.id === 'register-btn') showAuthModal(false);
            if (e.target.id === 'auth-switch-btn') showAuthModal(e.target.textContent.includes('æ³¨å†Œ'));
            
            if (e.target.closest('.modal-backdrop') && !e.target.closest('.modal-content')) e.target.closest('.modal-backdrop').classList.remove('visible');

            const navLink = e.target.closest('.nav-link');
            if (navLink) {
                e.preventDefault();
                navigateTo(navLink.dataset.view);
                mobileMenu.classList.add('hidden');
                document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('open'));
                searchResults.classList.add('hidden');
                searchInput.value = '';
            }
            
            const dropdownBtn = e.target.closest('.nav-dropdown-btn');
            if (dropdownBtn) {
                const parentDropdown = dropdownBtn.closest('.dropdown');
                const wasOpen = parentDropdown.classList.contains('open');
                document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('open'));
                if (!wasOpen) parentDropdown.classList.add('open');
            } else if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('open'));
            }

            if (e.target.closest('.copy-btn')) {
                const pre = e.target.closest('pre');
                const code = pre.querySelector('code').innerText;
                navigator.clipboard.writeText(code).then(() => {
                    e.target.innerHTML = '<i class="fa-solid fa-check"></i> å·²å¤åˆ¶!';
                    setTimeout(() => { e.target.innerHTML = '<i class="fa-solid fa-copy"></i> å¤åˆ¶'; }, 2000);
                });
            }
        });

        authModalContainer.addEventListener('submit', async e => {
            if (e.target.id !== 'auth-form') return;
            e.preventDefault();
            const email = e.target.querySelector('#auth-email').value;
            const password = e.target.querySelector('#auth-password').value;
            const isLogin = e.target.querySelector('#auth-switch-btn').textContent.includes('æ³¨å†Œ');
            const errorDiv = e.target.querySelector('#auth-error');
            try {
                if (isLogin) await signInWithEmailAndPassword(auth, email, password);
                else await createUserWithEmailAndPassword(auth, email, password);
                authModalContainer.classList.remove('visible');
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.remove('hidden');
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const homeLanding = document.getElementById('home-landing');
            const mainApp = document.getElementById('main-app');
            const startBtn = document.getElementById('start-experience-btn');
            const mainLogo = document.getElementById('main-logo');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const themeIcon = document.getElementById('theme-icon');

            renderNav();
            renderAuthSection();

            startBtn.addEventListener('click', () => {
                homeLanding.style.display = 'none';
                mainApp.style.display = 'block';
                navigateTo(window.location.hash.substring(1) || 'chapter1');
            });
            mainLogo.addEventListener('click', () => {
                mainApp.style.display = 'none';
                homeLanding.style.display = 'flex';
                cleanupAnimations();
                state.currentView = 'home';
                window.history.pushState({view: 'home'}, '', '#');
            });
            mobileMenuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

            function applyTheme(theme) {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    themeIcon.classList.replace('fa-moon', 'fa-sun');
                } else {
                    document.documentElement.classList.remove('dark');
                    themeIcon.classList.replace('fa-sun', 'fa-moon');
                }
                if(state.currentView) initializeInteractiveModules(state.currentView);
            }
            themeToggleBtn.addEventListener('click', () => {
                const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });
            applyTheme(localStorage.getItem('theme') || 'light');

            const initialHash = window.location.hash.substring(1);
            if (initialHash && chapterDetails[initialHash]) {
                startBtn.click();
            }
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopBtn.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
                } else {
                    backToTopBtn.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
                }
            });
            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            searchInput.addEventListener('input', () => {
                const query = searchInput.value.toLowerCase().trim();
                if (!query) {
                    searchResults.classList.add('hidden');
                    return;
                }
                const results = Object.entries(chapterDetails).filter(([id, title]) => title.toLowerCase().includes(query) || id.toLowerCase().includes(query));
                if (results.length > 0) {
                    searchResults.innerHTML = results.map(([id, title]) => 
                        `<a href="#${id}" data-view="${id}" class="nav-link block p-2 rounded-md text-sm hover:bg-themed-muted">${title}</a>`
                    ).join('');
                    searchResults.classList.remove('hidden');
                } else {
                    searchResults.innerHTML = `<div class="p-2 text-sm text-themed-secondary">æ— åŒ¹é…ç»“æœ</div>`;
                    searchResults.classList.remove('hidden');
                }
            });
            document.addEventListener('click', (e) => {
                if (!document.getElementById('search-container').contains(e.target)) {
                    searchResults.classList.add('hidden');
                }
            });
        });

        function cleanupAnimations() {
            Object.values(state.activeAnimationFrames).forEach(id => { if (id) cancelAnimationFrame(id); });
            state.activeAnimationFrames = {};
            if(window.acAnimationTimeoutId) clearTimeout(window.acAnimationTimeoutId);
            if(window.rlSimulationIntervalId) clearInterval(window.rlSimulationIntervalId);
            if(window.bellmanInterval) clearInterval(window.bellmanInterval);
            if(window.rlAgentIntervalId) clearInterval(window.rlAgentIntervalId);
        }

        function navigateTo(viewId) {
            if (!viewId) return;
            cleanupAnimations();
            state.currentView = viewId;
            contentContainer.innerHTML = chapterContents[viewId] || `<div class="card p-8"><h2>å†…å®¹å³å°†ä¸Šçº¿</h2><p>æˆ‘ä»¬æ­£åœ¨åŠªåŠ›å‡†å¤‡è¿™ä¸€ç« èŠ‚çš„å†…å®¹ï¼Œæ•¬è¯·æœŸå¾…ï¼</p></div>`;
            updateNavActiveState();
            updateBreadcrumb(viewId);
            addCopyToCodeBlocks();
            initializeInteractiveModules(viewId);
            markChapterAsCompleted(viewId);
            if(window.location.hash !== `#${viewId}`) window.history.pushState({view: viewId}, '', `#${viewId}`);
            window.scrollTo(0, 0);
        }

        function updateBreadcrumb(viewId) {
            const chapterTitle = chapterDetails[viewId];
            const group = navStructure.find(g => g.chapters.includes(viewId));
            if (chapterTitle && group) {
                breadcrumb.innerHTML = `<a href="#" data-view="${group.chapters[0]}" class="nav-link hover:text-accent-color">${group.title}</a> &raquo; <span>${chapterTitle}</span>`;
            } else {
                breadcrumb.innerHTML = '';
            }
        }

        function addCopyToCodeBlocks() {
            const pres = contentContainer.querySelectorAll('pre');
            pres.forEach(pre => {
                const btn = document.createElement('button');
                btn.className = 'copy-btn';
                btn.innerHTML = '<i class="fa-solid fa-copy"></i> å¤åˆ¶';
                pre.appendChild(btn);
            });
        }
        
        function updateNavActiveState() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.toggle('active', link.dataset.view === state.currentView);
            });
            document.querySelectorAll('.nav-dropdown-btn').forEach(btn => btn.classList.remove('active'));
            const activeLink = document.querySelector(`.nav-link[data-view="${state.currentView}"]`);
            if (activeLink) {
                const parentDropdownBtn = activeLink.closest('.dropdown')?.querySelector('.nav-dropdown-btn');
                if (parentDropdownBtn) parentDropdownBtn.classList.add('active');
            }
        }
        
        function initializeInteractiveModules(viewId) {
            window.activeAnimationFrames = state.activeAnimationFrames;
            switch(viewId) {
                case 'chapter1': initChapter1(); break;
                case 'chapter2': initChapter2(); break;
                case 'chapter4': initActorCriticViz(); break;
                case 'chapter5': initPpoCanvas(); break;
                case 'chapter6': initSacCanvas(); break;
                case 'quiz1': initQuiz(); break;
                case 'chapter7': initCmdpLab(); break;
                case 'chapter8': initSimRealCanvas(); break; 
                case 'chapter9': initRlTrainingLab(); break;
                case 'chapter10': selectStep(1); break;
                case 'chapter12': renderOfflineRLDiagram(); break;
            }
            if (window.MathJax) MathJax.typesetPromise();
        }

        // --- All Chapter Content and Interactive Logic ---
        const chapterContents = {
            'chapter1': `<h2>ç¬¬1ç« : é”…ç‚‰ç³»ç»ŸåŸç†</h2><p class="text-lg text-themed-secondary mb-6">åœ¨åº”ç”¨ä»»ä½•é«˜çº§ç®—æ³•ä¹‹å‰ï¼Œå¿…é¡»å¯¹è¢«æ§å¯¹è±¡â€”â€”é”…ç‚‰ï¼Œæœ‰æ·±åˆ»çš„ç‰©ç†å’Œå·¥ç¨‹ç†è§£ã€‚æœ¬ç« å°†å¸¦æ‚¨æ·±å…¥äº†è§£é”…ç‚‰èƒŒåçš„æ ¸å¿ƒçŸ›ç›¾ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªè¿›åŒ–ç‰ˆçš„äº’åŠ¨æ²™ç®±ï¼Œè®©æ‚¨äº²æ‰‹æ„Ÿå—åœ¨åŠ¨æ€å·¥å†µä¸‹æ§åˆ¶é”…ç‚‰çš„æŒ‘æˆ˜ã€‚</p><div class="card p-6 mb-6"><h3 class="text-xl font-bold">ç³»ç»Ÿç»„ä»¶ä¸çƒ­åŠ›å¾ªç¯</h3><p class="text-themed-secondary mb-4">é”…ç‚‰å¹¶éå­¤ç«‹è®¾å¤‡ï¼Œè€Œæ˜¯å‘ç”µå‚çƒ­åŠ›ç³»ç»Ÿçš„æ ¸å¿ƒã€‚å®ƒé€šè¿‡ç‡ƒçƒ§ç‡ƒæ–™ï¼ˆå¦‚ç…¤ç²‰ï¼‰äº§ç”Ÿé«˜æ¸©é«˜å‹è’¸æ±½ï¼Œé©±åŠ¨æ±½è½®æœºåšåŠŸå‘ç”µã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨çƒ­åŠ›å­¦ä¸Šéµå¾ªç»å…¸çš„**æœ—è‚¯å¾ªç¯**ã€‚</p><div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center"><div id="boiler-diagram-container" class="p-2 bg-themed-secondary rounded-lg shadow-inner"></div><div id="rankine-diagram-container" class="p-2 bg-themed-secondary rounded-lg shadow-inner"></div></div></div><div class="card p-6"><h3 class="text-xl font-bold">åŠ¨æ€å·¥å†µé”…ç‚‰æ²™ç®±</h3><p class="text-themed-secondary mb-6">æ‚¨çš„ä»»åŠ¡æ˜¯åœ¨ä¸åŒè´Ÿè·ä¸‹ï¼Œé€šè¿‡è°ƒèŠ‚æ§åˆ¶å˜é‡ï¼ˆåŠ¨ä½œï¼‰ï¼Œä½¿å„é¡¹æŒ‡æ ‡ï¼ˆçŠ¶æ€ï¼‰å°½å¯èƒ½æ¥è¿‘ç›®æ ‡å€¼ï¼Œä½“éªŒå¤šç›®æ ‡ä¼˜åŒ–çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚</p><div class="grid grid-cols-1 lg:grid-cols-5 gap-6"><div class="lg:col-span-2 bg-themed-muted p-6 rounded-lg"><h4 class="font-bold text-lg mb-4">ğŸ•¹ï¸ æ§åˆ¶ä¸å·¥å†µé¢æ¿</h4><div class="space-y-6"><div><label for="load-slider" class="font-medium flex justify-between">é”…ç‚‰è´Ÿè· (æ‰°åŠ¨): <span id="load-value" class="font-bold text-red-500">75</span>%</label><input type="range" id="load-slider" min="50" max="100" value="75" class="slider w-full"></div><div class="border-t border-themed pt-4"><label for="air-total-slider" class="font-medium flex justify-between">æ€»é£é‡ (åŠ¨ä½œ): <span id="air-total-value">75</span>%</label><input type="range" id="air-total-slider" min="50" max="100" value="75" class="slider w-full"></div><div><label for="burner-tilt-slider" class="font-medium flex justify-between">ç‡ƒçƒ§å™¨æ‘†è§’ (åŠ¨ä½œ): <span id="burner-tilt-value">0</span>Â°</label><input type="range" id="burner-tilt-slider" min="-15" max="15" value="0" class="slider w-full"></div><div><label for="o2-dist-slider" class="font-medium flex justify-between">ç‡ƒå°½é£(OFA)å æ¯” (åŠ¨ä½œ): <span id="o2-dist-value">30</span>%</label><input type="range" id="o2-dist-slider" min="10" max="50" value="30" class="slider w-full"></div></div></div><div class="lg:col-span-3"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div class="p-4 rounded-lg bg-slate-700 flex flex-col items-center justify-center min-h-[300px]"><h4 class="font-bold text-lg mb-2 text-white">ğŸ”¥ ç‚‰è†›ç«ç„°</h4><div id="boiler-visual-container" class="w-48 h-64 bg-slate-800 rounded-t-lg relative overflow-hidden"><div id="flame-visual" class="flame-visual"></div></div></div><div class="p-4 rounded-lg bg-themed-muted flex flex-col justify-between"><h4 class="font-bold text-lg mb-4">ğŸ“ˆ å…³é”®æŒ‡æ ‡</h4><div class="space-y-4"><div><label class="font-medium flex justify-between">æ°®æ°§åŒ–ç‰© (NOx) <span class="text-sm text-themed-secondary">ç›®æ ‡: &lt;50</span></label><div class="w-full bg-slate-200 dark:bg-slate-600 rounded-full h-4"><div id="nox-meter-fill" class="bg-red-500 h-4 rounded-full transition-all duration-300"></div></div></div><div><label class="font-medium flex justify-between">ä¸€æ°§åŒ–ç¢³ (CO) <span class="text-sm text-themed-secondary">ç›®æ ‡: &lt;40</span></label><div class="w-full bg-slate-200 dark:bg-slate-600 rounded-full h-4"><div id="co-meter-fill" class="bg-amber-500 h-4 rounded-full transition-all duration-300"></div></div></div><div><label class="font-medium flex justify-between">é”…ç‚‰çƒ­æ•ˆç‡ <span class="text-sm text-themed-secondary">ç›®æ ‡: &gt;93%</span></label><div class="text-right"><span id="efficiency-value" class="text-2xl font-bold text-green-600">92.50</span> %</div></div></div></div></div></div></div></div><div class="card p-6 mt-6"><h3 class="text-xl font-bold">æ ¸å¿ƒçŸ›ç›¾ï¼šå¸•ç´¯æ‰˜æœ€ä¼˜å‰æ²¿</h3><p class="text-themed-secondary mb-6">é”…ç‚‰ä¼˜åŒ–çš„æœ¬è´¨æ˜¯åœ¨å¤šä¸ªç›¸äº’å†²çªçš„ç›®æ ‡ä¹‹é—´å¯»æ‰¾æœ€ä½³å¹³è¡¡ç‚¹ã€‚ä¾‹å¦‚ï¼Œé™ä½NOxæ’æ”¾é€šå¸¸éœ€è¦é™ä½ç‡ƒçƒ§æ¸©åº¦ï¼Œä½†è¿™å¯èƒ½å¯¼è‡´COå¢åŠ å’Œçƒ­æ•ˆç‡ä¸‹é™ã€‚è¿™ä¸ªæœ€ä½³å¹³è¡¡ç‚¹çš„é›†åˆè¢«ç§°ä¸º"å¸•ç´¯æ‰˜æœ€ä¼˜å‰æ²¿"ã€‚RLæ™ºèƒ½ä½“çš„ä»»åŠ¡ï¼Œå°±æ˜¯æ‰¾åˆ°å¹¶ç»´æŒåœ¨è¿™ä¸€å‰æ²¿ä¸Šçš„æœ€ä¼˜å·¥ä½œç‚¹ã€‚</p><div class="p-4 bg-themed-muted rounded-lg"><canvas id="pareto-chart" height="120"></canvas></div></div>`,
            'chapter2': `<h2>ç¬¬2ç« : å¼ºåŒ–å­¦ä¹ ä¸–ç•Œè§‚</h2><p class="text-lg text-themed-secondary mb-6">å¼ºåŒ–å­¦ä¹ (RL)æ˜¯ä¸€ç§é€šè¿‡"è¯•é”™"æ¥å­¦ä¹ çš„æœºå™¨å­¦ä¹ èŒƒå¼ã€‚æ™ºèƒ½ä½“(Agent)åœ¨ä¸ç¯å¢ƒ(Environment)çš„äº¤äº’ä¸­ï¼Œæ ¹æ®è·å¾—çš„å¥–åŠ±(Reward)æˆ–æƒ©ç½šæ¥å­¦ä¹ å¦‚ä½•é€‰æ‹©åŠ¨ä½œ(Action)ï¼Œä»¥æœ€å¤§åŒ–é•¿æœŸç´¯ç§¯å¥–åŠ±ã€‚</p><div class="card p-6 mb-6"><h3 class="text-xl font-bold">2.1 é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ (MDP)</h3><p class="text-themed-secondary mb-4">RLé—®é¢˜é€šå¸¸è¢«æ•°å­¦åŒ–åœ°æè¿°ä¸ºé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ (MDP)ï¼Œä¸€ä¸ªç”±äº”å…ƒç»„æ„æˆçš„æ¨¡å‹ï¼š $(S, A, P, R, \\gamma)$</p><ul class="list-disc list-inside space-y-2 text-themed-secondary bg-themed-muted p-4 rounded-lg"><li><b>S (State)</b>: çŠ¶æ€é›†åˆã€‚åœ¨é”…ç‚‰ä¸­ï¼Œè¿™å¯ä»¥æ˜¯åŒ…å«ä¸»è’¸æ±½å‹åŠ›ã€æ¸©åº¦ã€å«æ°§é‡ç­‰çš„å¤šç»´å‘é‡ã€‚</li><li><b>A (Action)</b>: åŠ¨ä½œé›†åˆã€‚ä¾‹å¦‚ï¼Œè°ƒèŠ‚ç»™ç…¤é‡ã€æ€»é£é‡ã€ç‡ƒçƒ§å™¨æ‘†è§’ç­‰ã€‚</li><li><b>P (Transition Probability)</b>: çŠ¶æ€è½¬ç§»æ¦‚ç‡ $P(s'|s,a)$ã€‚æè¿°äº†åœ¨çŠ¶æ€ $s$ æ‰§è¡ŒåŠ¨ä½œ $a$ åï¼Œè½¬ç§»åˆ°çŠ¶æ€ $s'$ çš„æ¦‚ç‡ã€‚åœ¨ç°å®å·¥ä¸šä¸­ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯æœªçŸ¥ä¸”å¤æ‚çš„ã€‚</li><li><b>R (Reward Function)</b>: å¥–åŠ±å‡½æ•° $R(s,a,s')$ã€‚è¿™æ˜¯æˆ‘ä»¬å®šä¹‰RLç›®æ ‡çš„æ ¸å¿ƒï¼Œä¾‹å¦‚ï¼Œé«˜æ•ˆå‘ç”µæ˜¯æ­£å¥–åŠ±ï¼ŒNOxè¶…æ ‡æ˜¯è´Ÿå¥–åŠ±ã€‚</li><li><b>$\\gamma$ (Discount Factor)</b>: æŠ˜æ‰£å› å­ï¼Œå–å€¼åœ¨[0, 1]ä¹‹é—´ï¼Œç”¨äºå¹³è¡¡çŸ­æœŸå¥–åŠ±å’Œé•¿æœŸå¥–åŠ±çš„é‡è¦æ€§ã€‚</li></ul></div><div class="card p-6 mb-6"><h3 class="text-xl font-bold">2.2 è´å°”æ›¼æ–¹ç¨‹ï¼šä»·å€¼å­¦ä¹ çš„æ ¸å¿ƒ</h3><p class="text-themed-secondary mb-4">RLçš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜ç­–ç•¥ $\\pi^*(a|s)$ï¼Œå®ƒèƒ½å‘Šè¯‰æˆ‘ä»¬åœ¨ä»»ä½•çŠ¶æ€ä¸‹åº”è¯¥é‡‡å–ä»€ä¹ˆåŠ¨ä½œæ¥æœ€å¤§åŒ–æœŸæœ›å›æŠ¥ã€‚ä¸ºäº†è¯„ä¼°ä¸€ä¸ªç­–ç•¥æœ‰å¤šå¥½ï¼Œæˆ‘ä»¬å®šä¹‰äº†çŠ¶æ€ä»·å€¼å‡½æ•° $V^\\pi(s)$ï¼Œå®ƒä»£è¡¨ä»çŠ¶æ€ $s$ å¼€å§‹ï¼Œéµå¾ªç­–ç•¥ $\\pi$ æ‰€èƒ½è·å¾—çš„æœŸæœ›å›æŠ¥ã€‚å®ƒéµå¾ªè‘—åçš„è´å°”æ›¼æœŸæœ›æ–¹ç¨‹ï¼š</p><div class="p-4 my-2 bg-themed-muted rounded text-center text-lg">$$V^\\pi(s) = \\mathbb{E}_{\\pi} [R_{t+1} + \\gamma V^\\pi(S_{t+1}) | S_t=s]$$</div><p class="text-themed-secondary mt-4">è¿™ä¸ªå…¬å¼æ˜¯æ‰€æœ‰ä»·å€¼å­¦ä¹ ç®—æ³•çš„åŸºçŸ³ï¼Œå®ƒå°†å½“å‰çŠ¶æ€çš„ä»·å€¼ä¸åç»­çŠ¶æ€çš„ä»·å€¼è”ç³»åœ¨äº†ä¸€èµ·ã€‚</p></div><div class="card p-6 mb-6"><h3 class="text-xl font-bold">2.3 RLç®—æ³•å…¨æ™¯å›¾</h3><p class="text-themed-secondary mb-4">RLç®—æ³•ç§ç±»ç¹å¤šï¼Œä½†å¯ä»¥æ ¹æ®å‡ ä¸ªå…³é”®ç»´åº¦è¿›è¡Œåˆ’åˆ†ã€‚ä¸‹å›¾ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„åˆ†ç±»æ¡†æ¶ï¼Œå¸®åŠ©æ‚¨ç†è§£æˆ‘ä»¬åç»­å°†è¦ä»‹ç»çš„PPOã€SACç­‰ç®—æ³•åœ¨æ•´ä¸ªç‰ˆå›¾ä¸­çš„ä½ç½®ã€‚</p><div id="rl-taxonomy-container" class="p-4 bg-themed-muted rounded-lg flex justify-center"></div></div><div class="card p-6 mb-6"><h3 class="text-xl font-bold">2.4 äº¤äº’å¼åŠ¨æ€è§„åˆ’æ±‚è§£å™¨ (å‡çº§ç‰ˆ)</h3><p class="text-slate-600 dark:text-slate-300 mb-4">åœ¨é”…ç‚‰ç‡ƒçƒ§ä¼˜åŒ–ä¸­ï¼ŒåŠ¨æ€è§„åˆ’å¯ç”¨äºæ±‚è§£æœ€ä¼˜æ§åˆ¶ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†é”…ç‚‰çš„ç‡ƒçƒ§çŠ¶æ€ï¼ˆå¦‚æ¸©åº¦ã€å‹åŠ›ã€æ±¡æŸ“ç‰©æµ“åº¦ï¼‰å®šä¹‰ä¸ºçŠ¶æ€ç©ºé—´ï¼Œå°†è°ƒèŠ‚é£é—¨å¼€åº¦ã€ç‡ƒæ–™ä¾›ç»™é‡ç­‰æ“ä½œå®šä¹‰ä¸ºåŠ¨ä½œç©ºé—´ï¼Œå°†ç‡ƒçƒ§æ•ˆç‡æœ€å¤§åŒ–å’Œæ±¡æŸ“ç‰©æ’æ”¾æœ€å°åŒ–å®šä¹‰ä¸ºå¥–åŠ±å‡½æ•°ã€‚</p>
                        <p class="text-slate-600 dark:text-slate-300 mb-4">åŠ¨æ€è§„åˆ’(DP)æ˜¯è§£å†³å·²çŸ¥æ¨¡å‹ï¼ˆå³ $P$ å’Œ $R$ éƒ½å·²çŸ¥ï¼‰MDPçš„åŸºç¡€æ–¹æ³•ã€‚è™½ç„¶åœ¨é”…ç‚‰ä¼˜åŒ–ä¸­æˆ‘ä»¬æ— æ³•ç›´æ¥ä½¿ç”¨DPï¼Œä½†ç†è§£å®ƒçš„å·¥ä½œåŸç†æ˜¯ç†è§£æ›´é«˜çº§ç®—æ³•çš„åŸºçŸ³ã€‚ä¸‹é¢ï¼Œæ‚¨å¯ä»¥äº²æ‰‹æ“ä½œæˆ–è§‚çœ‹ç»å…¸çš„DPç®—æ³•ï¼š<b>ä»·å€¼è¿­ä»£</b>å’Œ<b>ç­–ç•¥è¿­ä»£</b>ï¼Œæ˜¯å¦‚ä½•æ‰¾åˆ°æœ€ä¼˜ç­–ç•¥çš„ã€‚</p>
                        <div class="flex flex-col md:flex-row gap-6 items-start">
                            <div class="flex-shrink-0">
                                <canvas id="bellman-canvas" width="400" height="400" class="border rounded-lg bg-white dark:bg-slate-800 shadow-inner"></canvas>
                                <div id="bellman-step-info" class="mt-2 text-sm p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg min-h-[60px]"></div>
                            </div>
                            <div class="flex-grow space-y-4">
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="iterate-bellman-btn" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors"><i class="fa-solid fa-shoe-prints"></i> è¿­ä»£ä¸€æ­¥</button>
                                    <button id="solve-bellman-btn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors"><i class="fa-solid fa-robot"></i> è‡ªåŠ¨æ±‚è§£</button>
                                </div>
                                <button id="reset-bellman-btn" class="w-full bg-slate-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-600 transition-colors"><i class="fa-solid fa-arrow-rotate-left"></i> é‡ç½®</button>
                                 <div class="p-3 bg-themed-muted rounded-lg">
                                     <label for="dp-method-select" class="text-sm font-bold text-themed-secondary">é€‰æ‹©ç®—æ³•:</label>
                                     <select id="dp-method-select" class="w-full p-2 rounded border-gray-300 dark:bg-slate-700 dark:border-slate-600 mt-1">
                                         <option value="vi">ä»·å€¼è¿­ä»£ (Value Iteration)</option>
                                         <option value="pi">ç­–ç•¥è¿­ä»£ (Policy Iteration)</option>
                                     </select>
                                 </div>
                                <div class="text-sm p-4 bg-slate-50 dark:bg-slate-800 rounded-lg">
                                    <p><strong>è¿­ä»£æ¬¡æ•°:</strong> <span id="bellman-iteration-count">0</span></p>
                                    <p><strong>å½“å‰é˜¶æ®µ:</strong> <span id="pi-phase-info">--</span></p>
                                    <p><strong>æŠ˜æ‰£å› å­ $\\gamma$:</strong> 0.9</p>
                                    <div id="bellman-update-info" class="text-center font-mono h-12 mt-2 p-2 bg-slate-100 dark:bg-slate-700 rounded flex items-center justify-center">è¯·å¼€å§‹è¿­ä»£...</div>
                                </div>
                            </div>
                        </div>
                    </div>`,
            'chapter3': `<h2>ç¬¬3ç« : ä»RLåˆ°æ·±åº¦RL</h2><p class="text-lg text-themed-secondary mb-6">ç»å…¸RLæ–¹æ³•ä½¿ç”¨è¡¨æ ¼ï¼ˆå¦‚Q-Tableï¼‰å­˜å‚¨æ¯ä¸ªçŠ¶æ€æˆ–çŠ¶æ€-åŠ¨ä½œå¯¹çš„ä»·å€¼ã€‚ä½†è¿™åœ¨çŠ¶æ€ç©ºé—´å·¨å¤§æ—¶ï¼ˆä¾‹å¦‚ï¼Œé”…ç‚‰çŠ¶æ€ç”±å¤šä¸ªè¿ç»­å˜é‡æ„æˆï¼‰ä¼šé¢ä¸´"ç»´åº¦ç¾éš¾"ï¼Œè¡¨æ ¼ä¼šå˜å¾—æ— é™å¤§ã€‚æ·±åº¦å­¦ä¹ é€šè¿‡ä½¿ç”¨ç¥ç»ç½‘ç»œä½œä¸ºå¼ºå¤§çš„å‡½æ•°é€¼è¿‘å™¨ï¼Œå‚¬ç”Ÿäº†æ·±åº¦å¼ºåŒ–å­¦ä¹ ï¼ˆDRLï¼‰ï¼Œå½»åº•æ”¹å˜äº†è¿™ä¸€é¢†åŸŸã€‚</p><div class="card p-6 mb-6"><h3 class="text-xl font-bold">å‡½æ•°é€¼è¿‘çš„å¿…è¦æ€§</h3><p class="text-themed-secondary mb-4">é”…ç‚‰çš„çŠ¶æ€ç”±ä¸»è’¸æ±½å‹åŠ›ã€æ¸©åº¦ã€å£æ¸©ã€æ°§é‡ç­‰å¤šä¸ªè¿ç»­å˜é‡æè¿°ï¼Œç†è®ºä¸Šå­˜åœ¨æ— é™ä¸ªçŠ¶æ€ã€‚æˆ‘ä»¬ä¸å¯èƒ½ç”¨ä¸€å¼ è¡¨æ¥å­˜å‚¨æ‰€æœ‰çŠ¶æ€çš„ä»·å€¼ã€‚ç¥ç»ç½‘ç»œï¼ˆNNï¼‰çš„å¼ºå¤§æ³›åŒ–èƒ½åŠ›ä½¿å…¶èƒ½å¤Ÿä»æœ‰é™çš„ç»éªŒä¸­å­¦ä¹ ï¼Œå¯¹æœªæ›¾è§è¿‡çš„çŠ¶æ€ä¹Ÿèƒ½åšå‡ºåˆç†çš„ä»·å€¼ä¼°è®¡ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªå¸¦å‚æ•° $\\theta$ çš„ç½‘ç»œ $Q(s, a; \\theta)$ æ¥è¿‘ä¼¼çœŸå®çš„Qå€¼ã€‚</p></div><div class="card p-6"><h3 class="text-xl font-bold">æ·±åº¦Qç½‘ç»œ (DQN)</h3><p class="text-themed-secondary mb-4">DQNæ˜¯DRLçš„å¼€åˆ›æ€§å·¥ä½œï¼Œå®ƒæˆåŠŸåœ°å°†æ·±åº¦å·ç§¯ç½‘ç»œä¸Q-Learningç»“åˆï¼Œåœ¨é›…è¾¾åˆ©æ¸¸æˆä¸Šè¾¾åˆ°äº†è¶…è¶Šäººç±»çš„æ°´å¹³ã€‚DQNå¼•å…¥äº†ä¸¤ä¸ªå…³é”®æŠ€æœ¯æ¥è§£å†³ä½¿ç”¨éçº¿æ€§å‡½æ•°é€¼è¿‘å™¨ï¼ˆç¥ç»ç½‘ç»œï¼‰æ—¶è®­ç»ƒä¸ç¨³å®šçš„é—®é¢˜ï¼š</p><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="p-4 bg-blue-500/10 rounded-lg"><h4 class="font-bold text-blue-600 dark:text-blue-400">ç»éªŒå›æ”¾ (Experience Replay)</h4><p class="text-sm mt-2">æ™ºèƒ½ä½“ä¸ç¯å¢ƒäº¤äº’çš„ç»éªŒå…ƒç»„ $(s_t, a_t, r_t, s_{t+1})$ è¢«å­˜å‚¨åœ¨ä¸€ä¸ªå›ºå®šå¤§å°çš„"å›æ”¾æ± "ï¼ˆReplay Bufferï¼‰ä¸­ã€‚è®­ç»ƒæ—¶ï¼Œä¸å†ä½¿ç”¨åˆšäº§ç”Ÿçš„å•ä¸ªç»éªŒï¼Œè€Œæ˜¯ä»æ± ä¸­éšæœºé‡‡æ ·ä¸€ä¸ªå°æ‰¹é‡ï¼ˆmini-batchï¼‰çš„æ•°æ®è¿›è¡Œæ›´æ–°ã€‚è¿™æ‰“ç ´äº†ç»éªŒæ•°æ®ä¹‹é—´çš„æ—¶é—´ç›¸å…³æ€§ï¼Œä½¿æ ·æœ¬æ›´æ¥è¿‘ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œå¹¶æå¤§åœ°æé«˜äº†æ•°æ®åˆ©ç”¨æ•ˆç‡ã€‚</p></div><div class="p-4 bg-green-500/10 rounded-lg"><h4 class="font-bold text-green-600 dark:text-green-400">ç›®æ ‡ç½‘ç»œ (Target Network)</h4><p class="text-sm mt-2">ä½¿ç”¨ä¸¤ä¸ªç»“æ„ç›¸åŒä½†å‚æ•°ä¸åŒçš„Qç½‘ç»œï¼šä¸€ä¸ªæ˜¯åœ¨çº¿ç½‘ç»œï¼ˆOnline Network, å‚æ•° $\\theta$ï¼‰ï¼Œç”¨äºé€‰æ‹©åŠ¨ä½œå’Œåœ¨æ¯æ­¥éƒ½æ›´æ–°ï¼›å¦ä¸€ä¸ªæ˜¯ç›®æ ‡ç½‘ç»œï¼ˆTarget Network, å‚æ•° $\\theta^-$ï¼‰ï¼Œç”¨äºè®¡ç®—TDç›®æ ‡ã€‚ç›®æ ‡ç½‘ç»œçš„å‚æ•°ä¸ä¼šæ¯æ­¥éƒ½æ›´æ–°ï¼Œè€Œæ˜¯å®šæœŸä»åœ¨çº¿ç½‘ç»œå¤åˆ¶è¿‡æ¥ã€‚è¿™ä½¿å¾—TDç›®æ ‡åœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒç¨³å®šï¼Œé¿å…äº†"è¿½é€è‡ªå·±å°¾å·´"çš„é—®é¢˜ã€‚</p></div></div><div class="mt-6 p-4 bg-themed-muted rounded-lg"><h4 class="font-bold text-lg mb-2">DQNçš„æŸå¤±å‡½æ•°</h4><p class="text-themed-secondary mb-2">DQNçš„æ›´æ–°ç›®æ ‡æ˜¯è®©åœ¨çº¿ç½‘ç»œé¢„æµ‹çš„Qå€¼ $Q(s, a; \\theta)$ é€¼è¿‘"TDç›®æ ‡" $y_t$ã€‚è¿™ä¸ªç›®æ ‡æ˜¯ä½¿ç”¨æ—§çš„ç›®æ ‡ç½‘ç»œè®¡ç®—çš„ï¼š</p><div class="p-2 my-2 bg-themed-secondary rounded text-center text-md">$$ y_t = r_t + \\gamma \\max_{a'} Q(s_{t+1}, a'; \\theta^-) $$</div><p class="text-themed-secondary mt-2">å› æ­¤ï¼ŒæŸå¤±å‡½æ•°æ˜¯ä¸€ä¸ªç®€å•çš„å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰ï¼š</p><div class="p-2 my-2 bg-themed-secondary rounded text-center text-md">$$ L(\\theta) = \\mathbb{E}_{(s,a,r,s') \\sim D} \\left[ (y_t - Q(s, a; \\theta))^2 \\right] $$</div></div></div>`,
            'chapter4': `<h2>ç¬¬4ç« : æ¼”å‘˜-è¯„è®ºå®¶æ¶æ„</h2><p class="text-lg text-themed-secondary mb-6">æ¼”å‘˜-è¯„è®ºå®¶ï¼ˆActor-Critic, ACï¼‰æ–¹æ³•æ˜¯ç°ä»£RLç®—æ³•çš„æ”¯æŸ±ï¼Œå®ƒç»“åˆäº†ç­–ç•¥å­¦ä¹ ï¼ˆPolicy-Basedï¼‰å’Œä»·å€¼å­¦ä¹ ï¼ˆValue-Basedï¼‰çš„ä¼˜ç‚¹ï¼Œèƒ½å¤Ÿå¤„ç†è¿ç»­åŠ¨ä½œç©ºé—´é—®é¢˜ï¼Œå¹¶é€šå¸¸å…·æœ‰æ›´ç¨³å®šçš„æ”¶æ•›æ€§ã€‚</p><div class="card p-6 mb-6"><h3 class="text-xl font-bold">æ¼”å‘˜ä¸è¯„è®ºå®¶çš„è§’è‰²åˆ†å·¥</h3><ul class="list-disc list-inside space-y-2 text-themed-secondary"><li><b>æ¼”å‘˜ (Actor)</b>: æ¼”å‘˜æ˜¯ä¸€ä¸ªå‚æ•°åŒ–çš„ç­–ç•¥ $\\pi_\\theta(a|s)$ï¼Œè´Ÿè´£æ ¹æ®å½“å‰çŠ¶æ€ $s$ è¾“å‡ºä¸€ä¸ªåŠ¨ä½œï¼ˆæˆ–åŠ¨ä½œçš„æ¦‚ç‡åˆ†å¸ƒï¼‰ã€‚å®ƒçš„ç›®æ ‡æ˜¯å­¦ä¹ ä¸€ä¸ªå¥½çš„ç­–ç•¥ï¼Œæ‰€ä»¥è¢«ç§°ä¸º"ç­–ç•¥ç½‘ç»œ"ã€‚</li><li><b>è¯„è®ºå®¶ (Critic)</b>: è¯„è®ºå®¶æ˜¯ä¸€ä¸ªå‚æ•°åŒ–çš„ä»·å€¼å‡½æ•° $Q_\\phi(s,a)$ æˆ– $V_\\phi(s)$ï¼Œè´Ÿè´£è¯„ä»·æ¼”å‘˜é€‰æ‹©çš„åŠ¨ä½œæœ‰å¤šå¥½ã€‚å®ƒä¸äº§å‡ºåŠ¨ä½œï¼Œåªä¸ºæ¼”å‘˜æä¾›åé¦ˆä¿¡å·ï¼Œæ‰€ä»¥è¢«ç§°ä¸º"ä»·å€¼ç½‘ç»œ"ã€‚</li></ul><p class="text-themed-secondary mt-4">ä¸¤è€…ååŒå·¥ä½œï¼šæ¼”å‘˜åœ¨å°ä¸Šè¡¨æ¼”ï¼ˆé€‰æ‹©åŠ¨ä½œï¼‰ï¼Œè¯„è®ºå®¶åœ¨å°ä¸‹æ‰“åˆ†ï¼ˆè¯„ä¼°åŠ¨ä½œå¥½åï¼‰ã€‚æ¼”å‘˜æ ¹æ®è¯„è®ºå®¶çš„åˆ†æ•°æ¥è°ƒæ•´è‡ªå·±çš„è¡¨æ¼”ç­–ç•¥ï¼ŒåŠ›æ±‚è·å¾—æ›´é«˜çš„åˆ†æ•°ã€‚</p></div><div class="card p-6"><h3 class="text-xl font-bold">åŠ¨æ€æ¼”ç¤ºï¼šä¿¡æ¯ä¸ä¼˜åŠ¿å‡½æ•°æµåŠ¨è¿‡ç¨‹</h3><p class="text-themed-secondary mb-4">ç‚¹å‡»æ’­æ”¾ä¸‹é¢çš„åŠ¨ç”»ï¼Œè§‚å¯Ÿä¸€ä¸ªå…¸å‹çš„ACæ›´æ–°å‘¨æœŸã€‚è¯„è®ºå®¶ä¼šè®¡ç®—å‡º**ä¼˜åŠ¿å‡½æ•° $A(s,a) = Q(s,a) - V(s)$**ï¼Œè¿™ä¸ªä¿¡å·æ˜¯æŒ‡å¯¼æ¼”å‘˜æ›´æ–°ç­–ç•¥çš„æ ¸å¿ƒä¾æ®ã€‚å¦‚æœä¼˜åŠ¿ä¸ºæ­£ï¼Œè¯´æ˜è¿™ä¸ªåŠ¨ä½œæ¯”å¹³å‡æ°´å¹³è¦å¥½ï¼Œæ¼”å‘˜å°±å¢åŠ é€‰æ‹©è¿™ä¸ªåŠ¨ä½œçš„æ¦‚ç‡ï¼›åä¹‹åˆ™é™ä½æ¦‚ç‡ã€‚</p><div class="text-center mb-4"><button id="play-ac-viz" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">â–¶ï¸ æ’­æ”¾æµç¨‹</button></div><div id="ac-viz-explanation" class="text-center font-semibold h-10 mb-2"></div><div id="ac-diagram-container" class="flex justify-center"></div></div>`,
            'chapter5': `<h2>ç¬¬5ç« : PPOç®—æ³•è¯¦è§£</h2><p class="text-lg text-themed-secondary mb-6">è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–ï¼ˆPPOï¼‰æ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„RLç®—æ³•ä¹‹ä¸€ï¼Œç”±OpenAIæå‡ºï¼Œä»¥å…¶å“è¶Šçš„ç¨³å®šæ€§å’Œæ€§èƒ½è€Œé—»åã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨æ›´æ–°ç­–ç•¥æ—¶ï¼Œæ­¥å­ä¸èƒ½è¿ˆå¾—å¤ªå¤§ï¼Œé¿å…æ–°æ—§ç­–ç•¥å·®å¼‚è¿‡å¤§å¯¼è‡´è®­ç»ƒå´©æºƒã€‚</p><div class="card p-6"><h3 class="text-xl font-bold">äº¤äº’å¼ç†è§£ï¼šå¯è°ƒèŠ‚çš„ä¿¡ä»»åŸŸè£å‰ª</h3><p class="text-themed-secondary mb-4">ä»¤ $r_t(\\theta) = \\frac{\\pi_\\theta(a_t|s_t)}{\\pi_{\\theta_{old}}(a_t|s_t)}$ ä¸ºæ–°æ—§ç­–ç•¥çš„æ¦‚ç‡æ¯”ã€‚PPOé€šè¿‡è£å‰ªï¼ˆClippingï¼‰æ¥é™åˆ¶è¿™ä¸ªæ¯”ç‡åœ¨ä¸€ä¸ªé¢„è®¾çš„èŒƒå›´ $[1-\\epsilon, 1+\\epsilon]$ å†…ã€‚è¯·æ‹–åŠ¨ $\\epsilon$ æ»‘å—æ¥è°ƒæ•´ä¿¡ä»»åŸŸå¤§å°ï¼Œå¹¶åˆ‡æ¢"å¥½åŠ¨ä½œ"ä¸"ååŠ¨ä½œ"çš„æƒ…æ™¯ï¼Œè§‚å¯Ÿç›®æ ‡å‡½æ•°å¦‚ä½•è¢«è£å‰ªã€‚</p><div class="flex justify-center items-center gap-6 mb-4"><button id="ppo-toggle-advantage" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors">åˆ‡æ¢åˆ° "ååŠ¨ä½œ"</button><div class="w-64"><label for="epsilon-slider" class="font-medium flex justify-between">è£å‰ªèŒƒå›´ $\\epsilon$: <span id="epsilon-value">0.2</span></label><input type="range" id="epsilon-slider" min="0.05" max="0.5" step="0.01" value="0.2" class="slider w-full h-2 bg-themed-muted rounded-lg appearance-none cursor-pointer"></div></div><canvas id="ppo-canvas" class="w-full h-64 bg-themed-muted border border-themed rounded-lg"></canvas><p id="ppo-explanation" class="text-center mt-2 font-medium"></p></div><div class="card p-6 mt-6"><h3 class="text-xl font-bold">PPOæ ¸å¿ƒç»„ä»¶ä¸ä¼ªä»£ç </h3><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="space-y-4"><div class="p-4 bg-blue-500/10 rounded-lg"><h4 class="font-bold text-blue-600 dark:text-blue-400">è£å‰ªä»£ç†ç›®æ ‡</h4><p class="text-sm mt-2">è¿™æ˜¯PPOçš„æ ¸å¿ƒåˆ›æ–°ï¼Œå®ƒé€šè¿‡å–æœªè£å‰ªå’Œå·²è£å‰ªç›®æ ‡çš„è¾ƒå°å€¼ï¼Œæ‚²è§‚åœ°é™åˆ¶äº†ç­–ç•¥æ›´æ–°çš„å¹…åº¦ï¼Œé¿å…ç­–ç•¥çªå˜ã€‚</p><div class="p-2 my-2 bg-themed-secondary rounded text-center">$$L^{CLIP}(\\theta) = \\mathbb{E}_t \\left[ \\min\\left(r_t(\\theta)\\hat{A}_t, \\text{clip}(r_t(\\theta), 1-\\epsilon, 1+\\epsilon)\\hat{A}_t\\right) \\right]$$</div></div><div class="p-4 bg-green-500/10 rounded-lg"><h4 class="font-bold text-green-600 dark:text-green-400">å¹¿ä¹‰ä¼˜åŠ¿ä¼°è®¡ (GAE)</h4><p class="text-sm mt-2">PPOé€šå¸¸é‡‡ç”¨GAEæ¥å‡†ç¡®ä¼°è®¡ä¼˜åŠ¿å‡½æ•°ã€‚GAEé€šè¿‡åŠ æƒå¹³å‡å¤šä¸ªæ—¶é—´æ­¥çš„TDè¯¯å·®ï¼Œæœ‰æ•ˆé™ä½äº†ä¼˜åŠ¿ä¼°è®¡çš„æ–¹å·®ï¼Œæä¾›äº†æ›´ç¨³å®šçš„ä¼˜åŠ¿ä¿¡å·ã€‚</p></div></div><div><h4 class="font-bold">PPO ä¼ªä»£ç </h4><pre><code>Initialize policy and value networks
for iteration = 1, 2, ... do
  // 1. Data Collection
  Run old policy to collect trajectories
  // 2. Advantage & Return Calculation
  Compute advantages (GAE) and returns
  // 3. Optimization
  for K epochs do
    for mini_batch in trajectories do
      Update policy via clipped objective
      Update value function via MSE
    end for
  end for
  Update old policy
end for</code></pre></div></div></div>`,
            'chapter6': `<h2>ç¬¬6ç« : SACç®—æ³•è¯¦è§£</h2><p class="text-lg text-themed-secondary mb-6">è½¯æ¼”å‘˜-è¯„è®ºå®¶ï¼ˆSACï¼‰æ˜¯ä¸€ç§åŸºäºæœ€å¤§ç†µå¼ºåŒ–å­¦ä¹ æ¡†æ¶çš„off-policyç®—æ³•ã€‚SACçš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–å¥–åŠ±çš„åŒæ—¶ï¼Œä¹Ÿæœ€å¤§åŒ–ç­–ç•¥çš„**ç†µ**ï¼ˆéšæœºæ€§ï¼‰ï¼Œå¸¦æ¥äº†æå¼ºçš„é²æ£’æ€§å’Œæ¢ç´¢æ•ˆç‡ï¼Œåœ¨è®¸å¤šè¿ç»­æ§åˆ¶ä»»åŠ¡ä¸­è¡¨ç°ä¼˜å¼‚ã€‚</p><div class="card p-6"><h3 class="text-xl font-bold">äº¤äº’å¼ç†è§£ï¼šæ¢ç´¢ä¸åˆ©ç”¨çš„æƒè¡¡</h3><p class="text-themed-secondary mb-4">SACçš„ç›®æ ‡å‡½æ•°æ˜¯ $J(\\pi) = \\sum \\mathbb{E} [r(s_t, a_t) + \\alpha \\mathcal{H}(\\pi(\\cdot|s_t))]$ã€‚å…¶ä¸­ $\\mathcal{H}$ æ˜¯ç­–ç•¥çš„ç†µï¼Œ$\\alpha$ æ˜¯æ§åˆ¶ç†µé‡è¦æ€§çš„æ¸©åº¦å‚æ•°ã€‚è¯·è°ƒæ•´æ¸©åº¦å‚æ•° $\\alpha$ï¼Œè§‚å¯Ÿç­–ç•¥ï¼ˆè“è‰²åŒºåŸŸï¼‰çš„å˜åŒ–ã€‚é«˜ $\\alpha$ é¼“åŠ±æ¢ç´¢ï¼Œä½ $\\alpha$ é¼“åŠ±åˆ©ç”¨ã€‚</p><canvas id="sac-canvas" class="w-full h-64 bg-themed-muted border border-themed rounded-lg"></canvas><div class="mt-4"><label for="alpha-slider" class="font-medium flex justify-between">æ¸©åº¦ $\\alpha$: <span id="alpha-value">0.20</span></label><input type="range" id="alpha-slider" min="0.01" max="1.0" step="0.01" value="0.2" class="slider w-full h-2 bg-themed-muted rounded-lg appearance-none cursor-pointer"></div><p id="sac-explanation" class="text-center mt-2 font-medium"></p></div><div class="card p-6 mt-6"><h3 class="text-xl font-bold">SACæ ¸å¿ƒç»„ä»¶</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="p-4 bg-purple-500/10 rounded-lg"><h4 class="font-bold text-purple-600 dark:text-purple-400">åŒQç½‘ç»œ (Twin Q-Critics)</h4><p class="text-sm mt-2">ä¸ºäº†ç¼“è§£ä»·å€¼å‡½æ•°åœ¨off-policyå­¦ä¹ ä¸­è¢«è¿‡é«˜ä¼°è®¡çš„é—®é¢˜ï¼ˆQ-value overestimationï¼‰ï¼ŒSACé‡‡ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„Qç½‘ç»œï¼Œå¹¶åœ¨è®¡ç®—TDç›®æ ‡æ—¶æ‚²è§‚åœ°å–å…¶è¾ƒå°å€¼ï¼Œä½¿å­¦ä¹ è¿‡ç¨‹æ›´ç¨³å®šã€‚</p></div><div class="p-4 bg-teal-500/10 rounded-lg"><h4 class="font-bold text-teal-600 dark:text-teal-400">è‡ªåŠ¨ç†µè°ƒä¼˜</h4><p class="text-sm mt-2">æ‰‹åŠ¨é€‰æ‹©ä¸€ä¸ªå›ºå®šçš„ $\\alpha$ å¾ˆå›°éš¾ã€‚SACèƒ½å°† $\\alpha$ ä½œä¸ºä¸€ä¸ªå¯è®­ç»ƒå‚æ•°ï¼Œè‡ªåŠ¨è°ƒæ•´å®ƒä»¥ä½¿ç­–ç•¥çš„å®é™…ç†µåŠ¨æ€åœ°æ¥è¿‘ä¸€ä¸ªé¢„è®¾çš„ç›®æ ‡ç†µï¼Œå®ç°äº†æ¢ç´¢å’Œåˆ©ç”¨çš„è‡ªåŠ¨å¹³è¡¡ã€‚</p></div></div></div>`,
            'quiz1': `<h2>é˜¶æ®µå°æµ‹: æ ¸å¿ƒç®—æ³•</h2><p class="text-lg text-themed-secondary mb-6">æ£€éªŒä¸€ä¸‹æ‚¨å¯¹æ ¸å¿ƒç®—æ³•ç« èŠ‚çš„ç†è§£ç¨‹åº¦å§ï¼</p><div id="quiz-container" class="card p-6"></div>`,
            'chapter7': `<h2>ç¬¬7ç« : CMDPæ„å»ºå®éªŒå®¤</h2><p class="text-lg text-themed-secondary mb-6">å¯¹äºæ—¢è¦è¿½æ±‚ç»æµæ•ˆç›Šï¼Œåˆå¿…é¡»éµå®ˆå®‰å…¨çº¢çº¿çš„ä»»åŠ¡ï¼ˆå¦‚é”…ç‚‰å£æ¸©ä¸èƒ½è¶…é™ï¼‰ï¼Œæˆ‘ä»¬å¼•å…¥**çº¦æŸé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼ˆCMDPï¼‰**ã€‚æ™ºèƒ½ä½“çš„ç›®æ ‡æ˜¯åœ¨æ»¡è¶³æˆæœ¬çº¦æŸçš„å‰æä¸‹ï¼Œæœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±ã€‚</p><div class="card p-6"><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div id="cmdp-builder-panel"><h3 class="text-xl font-bold">1. æ„å»ºæ‚¨çš„CMDPæ¨¡å‹</h3><p class="text-themed-secondary mb-6">è¯·å‹¾é€‰æ‚¨å¸Œæœ›çº³å…¥æ¨¡å‹çš„å˜é‡ã€‚<b>å¥–åŠ±</b>æ˜¯æˆ‘ä»¬å¸Œæœ›æœ€å¤§åŒ–çš„æŒ‡æ ‡ï¼Œè€Œ<b>æˆæœ¬/çº¦æŸ</b>æ˜¯æˆ‘ä»¬å¿…é¡»éµå®ˆçš„çº¢çº¿ã€‚</p><div class="mb-4"><h4 class="font-bold text-lg mb-2 text-indigo-500 dark:text-indigo-400">S - é€‰æ‹©çŠ¶æ€</h4><div class="space-y-2 text-sm p-4 bg-themed-muted rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-nox-meter" checked> NOxæµ“åº¦</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-co-meter" checked> COæµ“åº¦</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-efficiency-meter" checked> çƒ­æ•ˆç‡</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-temp-meter" checked> å…³é”®å£æ¸©</label></div></div><div class="mb-4"><h4 class="font-bold text-lg mb-2 text-green-600 dark:text-green-500">A - é€‰æ‹©åŠ¨ä½œ</h4><div class="space-y-2 text-sm p-4 bg-themed-muted rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-air-slider" checked> æ€»é£é‡</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-tilt-slider" checked> ç‡ƒçƒ§å™¨æ‘†è§’</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-ofa-slider" checked> ç‡ƒå°½é£å æ¯”</label></div></div><div class="mb-4"><h4 class="font-bold text-lg mb-2 text-amber-600 dark:text-amber-500">R - å®šä¹‰å¥–åŠ±</h4><div class="space-y-2 text-sm p-4 bg-themed-muted rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-efficiency-meter" data-type="reward" checked> å¥–åŠ±ï¼šæå‡çƒ­æ•ˆç‡</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-nox-meter" data-type="reward"> å¥–åŠ±ï¼šé™ä½NOx</label></div></div><div class="mb-4"><h4 class="font-bold text-lg mb-2 text-red-600 dark:text-red-500">C - å®šä¹‰æˆæœ¬/çº¦æŸ</h4><div class="space-y-2 text-sm p-4 bg-themed-muted rounded-lg"><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-temp-meter" data-type="cost" checked> çº¦æŸï¼šå£æ¸©</label><label class="flex items-center"><input type="checkbox" class="mr-2 cmdp-checkbox" data-target="component-co-meter" data-type="cost"> çº¦æŸï¼šCOæµ“åº¦</label></div></div></div><div><h3 class="text-xl font-bold">2. å®æ—¶é¢„è§ˆä¸äº¤äº’</h3><p class="text-themed-secondary mb-6">è¿™é‡Œæ˜¯æ‚¨æ„å»ºçš„è™šæ‹Ÿé”…ç‚‰ã€‚è¢«å®šä¹‰ä¸º"å¥–åŠ±"çš„æ¨¡å—ä¼šä»¥ç»¿è‰²é«˜äº®ï¼Œ"çº¦æŸ"æ¨¡å—ä»¥çº¢è‰²é«˜äº®ã€‚</p><div class="p-4 rounded-lg bg-slate-700 flex flex-col items-center justify-start min-h-[500px]"><h4 class="font-bold text-lg mb-2 text-white">ğŸ”¥ è™šæ‹Ÿé”…ç‚‰å®æ—¶è§†å›¾</h4><div id="boiler-visual-container-ch7" class="w-48 h-64 bg-slate-800 rounded-t-lg relative overflow-hidden mt-4"><div id="flame-visual-ch7" class="flame-visual"></div></div><div id="dashboard-ch7" class="w-full mt-6 space-y-4 p-2"><div id="component-nox-meter" class="preview-component p-2 rounded-md transition-all duration-300"><label class="font-medium text-white text-sm">NOx</label><div class="w-full bg-slate-500 rounded-full h-3"><div id="nox-meter-fill-ch7" class="bg-red-500 h-3 rounded-full"></div></div></div><div id="component-co-meter" class="preview-component p-2 rounded-md transition-all duration-300"><label class="font-medium text-white text-sm">CO</label><div class="w-full bg-slate-500 rounded-full h-3"><div id="co-meter-fill-ch7" class="bg-amber-500 h-3 rounded-full"></div></div></div><div id="component-temp-meter" class="preview-component p-2 rounded-md transition-all duration-300"><label class="font-medium text-white text-sm">å£æ¸©</label><div class="w-full bg-slate-500 rounded-full h-3"><div id="temp-meter-fill-ch7" class="bg-orange-500 h-3 rounded-full"></div></div></div><div id="component-efficiency-meter" class="preview-component p-2 rounded-md transition-all duration-300"><label class="font-medium text-white text-sm">çƒ­æ•ˆç‡</label><div class="text-right"><span id="efficiency-value-ch7" class="text-xl font-bold text-green-400">92.50</span> %</div></div></div></div><div id="controls-ch7" class="mt-4 p-4 bg-themed-secondary rounded-lg space-y-4 border border-themed"><div id="component-air-slider" class="preview-component"><label for="air-slider-ch7" class="font-medium flex justify-between text-sm">æ€»é£é‡: <span id="air-value-ch7">75</span>%</label><input type="range" id="air-slider-ch7" min="50" max="100" value="75" class="slider w-full"></div><div id="component-tilt-slider" class="preview-component"><label for="tilt-slider-ch7" class="font-medium flex justify-between text-sm">æ‘†è§’: <span id="tilt-value-ch7">0</span>Â°</label><input type="range" id="tilt-slider-ch7" min="-15" max="15" value="0" class="slider w-full"></div><div id="component-ofa-slider" class="preview-component"><label for="ofa-slider-ch7" class="font-medium flex justify-between text-sm">OFAå æ¯”: <span id="ofa-value-ch7">30</span>%</label><input type="range" id="ofa-slider-ch7" min="10" max="50" value="30" class="slider w-full"></div></div></div></div><div class="mt-8 pt-4 border-t border-themed"><h3 class="text-xl font-bold">3. æ‚¨ç”Ÿæˆçš„CMDPæ¨¡å‹</h3><div id="cmdp-summary-ch7" class="text-sm grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-indigo-500/10 rounded-lg mt-4"><div><strong>çŠ¶æ€:</strong><ul id="summary-State-ch7" class="list-disc list-inside"></ul></div><div><strong>åŠ¨ä½œ:</strong><ul id="summary-Action-ch7" class="list-disc list-inside"></ul></div><div><strong>å¥–åŠ±:</strong><ul id="summary-Reward-ch7" class="list-disc list-inside"></ul></div><div><strong>æˆæœ¬:</strong><ul id="summary-Cost-ch7" class="list-disc list-inside"></ul></div></div></div></div>`,
            'chapter8': `<h2>ç¬¬8ç« : æ„å»ºæ•°å­—å­ªç”Ÿ</h2><p class="text-lg text-themed-secondary mb-6">RLéœ€è¦åœ¨ç¯å¢ƒä¸­è¿›è¡Œæµ·é‡è¯•é”™ï¼Œè¿™åœ¨çœŸå®çš„å·¥ä¸šè®¾å¤‡ä¸Šæ˜¯ä¸å¯è¡Œçš„ã€‚å› æ­¤ï¼Œæ„å»ºä¸€ä¸ªé«˜ä¿çœŸçš„ä»¿çœŸç¯å¢ƒâ€”â€”"æ•°å­—å­ªç”Ÿ"â€”â€”æ˜¯é¡¹ç›®æˆåŠŸçš„å…ˆå†³æ¡ä»¶ã€‚</p><div class="card p-6 mb-6"><h3 class="text-xl font-bold">ä»€ä¹ˆæ˜¯æ•°å­—å­ªç”Ÿï¼Ÿ</h3><p class="text-themed-secondary">æ•°å­—å­ªç”Ÿæ˜¯çœŸå®ç‰©ç†ç³»ç»Ÿçš„è™šæ‹Ÿå‰¯æœ¬ï¼Œèƒ½æ¨¡æ‹ŸçœŸå®é”…ç‚‰çš„åŠ¨æ€å“åº”ã€‚æ„å»ºæ–¹æ³•ä¸»è¦æœ‰ä¸¤ç±»ï¼š</p><ul class="list-disc list-inside space-y-2 text-themed-secondary"><li><b>æœºç†å»ºæ¨¡</b>ï¼šåŸºäºç‰©ç†å®šå¾‹ï¼ˆå¦‚æµä½“åŠ›å­¦ã€ä¼ çƒ­å­¦ã€åŒ–å­¦ååº”åŠ¨åŠ›å­¦ï¼‰æ„å»ºå¤æ‚çš„å¾®åˆ†æ–¹ç¨‹ç»„ã€‚ä¼˜ç‚¹æ˜¯æ³›åŒ–æ€§å¼ºï¼Œå¯è§£é‡Šæ€§å¥½ï¼›ç¼ºç‚¹æ˜¯å»ºæ¨¡éš¾åº¦å¤§ï¼Œè®¡ç®—é‡å·¨å¤§ã€‚</li><li><b>æ•°æ®é©±åŠ¨å»ºæ¨¡</b>ï¼šåˆ©ç”¨ç”µå‚DCSç³»ç»Ÿç§¯ç´¯çš„å†å²æ•°æ®ï¼Œé€šè¿‡æœºå™¨å­¦ä¹ æ–¹æ³•ï¼ˆå¦‚LSTMã€Transformerï¼‰å­¦ä¹ è¾“å…¥ï¼ˆæ§åˆ¶åŠ¨ä½œï¼‰ä¸è¾“å‡ºï¼ˆçŠ¶æ€æŒ‡æ ‡ï¼‰çš„æ˜ å°„å…³ç³»ã€‚ä¼˜ç‚¹æ˜¯å»ºæ¨¡å¿«é€Ÿï¼›ç¼ºç‚¹æ˜¯ä¾èµ–æ•°æ®è´¨é‡ï¼Œæ³›åŒ–èƒ½åŠ›å’Œå¯è§£é‡Šæ€§å¯èƒ½è¾ƒå·®ã€‚</li></ul><p class="text-themed-secondary mt-4">åœ¨å®è·µä¸­ï¼Œé€šå¸¸å°†ä¸¤è€…ç»“åˆï¼Œç”¨æœºç†æ¨¡å‹æ­å»ºåŸºç¡€æ¡†æ¶ï¼Œå†ç”¨æ•°æ®é©±åŠ¨æ¨¡å‹ä¿®æ­£å’Œæ‹Ÿåˆæœºç†æ¨¡å‹ä¸ç°å®çš„åå·®ã€‚</p></div><div class="card p-6 mb-6"><h3 class="text-xl font-bold">"ä»¿çœŸåˆ°ç°å®"çš„é¸¿æ²Ÿ (Sim-to-Real Gap)</h3><p class="mb-4 text-themed-secondary">ä»»ä½•ä»¿çœŸéƒ½æ— æ³•100%å¤åˆ»ç°å®ã€‚ç¼©å°è¿™ä¸ªé¸¿æ²Ÿè‡³å…³é‡è¦ã€‚ä¸€ç§æœ‰æ•ˆçš„æŠ€æœ¯æ˜¯**é¢†åŸŸéšæœºåŒ– (Domain Randomization)**ï¼šåœ¨è®­ç»ƒæ—¶ï¼Œæ•…æ„ç»™ä»¿çœŸç¯å¢ƒå¢åŠ å„ç§éšæœºæ€§ï¼ˆå¦‚ä¼ æ„Ÿå™¨å™ªå£°ã€æ‰§è¡Œå™¨å»¶è¿Ÿã€ç…¤è´¨æ³¢åŠ¨ç­‰ï¼‰ï¼Œè¿«ä½¿AIå­¦ä¹ ä¸€ä¸ªå¯¹è¿™äº›ä¸ç¡®å®šæ€§ä¸æ•æ„Ÿçš„ã€æ›´ä¸ºé²æ£’çš„ç­–ç•¥ã€‚</p></div><div class="card p-6"><h3 class="text-xl font-bold">äº¤äº’æ¼”ç¤ºï¼šæ¨¡å‹è´¨é‡ä¸é²æ£’æ€§</h3><p class="text-themed-secondary mb-4">æ‹–åŠ¨æ»‘å—æ¨¡æ‹Ÿæ¨¡å‹ä¸ç°å®çš„åŒ¹é…ç¨‹åº¦ã€‚é»‘è‰²å®çº¿ä»£è¡¨"çœŸå®ä¸–ç•Œ"ï¼Œè“è‰²è™šçº¿ä»£è¡¨æ•°å­—å­ªç”Ÿæ¨¡å‹çš„é¢„æµ‹ã€‚åŒ¹é…åº¦è¶Šä½ï¼Œ"Sim-to-Real"çš„é¸¿æ²Ÿè¶Šå¤§ã€‚</p><canvas id="sim-real-canvas" class="w-full h-64 bg-themed-muted border border-themed rounded-lg"></canvas><div><label for="model-quality-slider" class="font-medium flex justify-between">æ¨¡å‹-ç°å®åŒ¹é…åº¦: <span id="model-quality-value">50</span>%</label><input type="range" id="model-quality-slider" min="10" max="98" step="1" value="50" class="slider w-full h-2 bg-themed-muted rounded-lg"></div></div>`,
            'chapter9': `<h2>ç¬¬9ç« : è®­ç»ƒå®éªŒä¸è°ƒè¯•</h2><p class="text-lg text-themed-secondary mb-8">æ¬¢è¿æ¥åˆ°RLè®­ç»ƒå®éªŒå®¤ï¼æ™ºèƒ½ä½“ï¼ˆè“è‰²åœ†ç‚¹ï¼‰çš„ç›®æ ‡æ˜¯åœ¨ç®€åŒ–çš„çŠ¶æ€ç½‘æ ¼ä¸­ï¼Œä»'S'å‡ºå‘ï¼Œå°½å¿«åˆ°è¾¾'ğŸ†'ï¼ŒåŒæ—¶é¿å¼€å±é™©åŒºåŸŸ'â˜ ï¸'ã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒèŠ‚è¶…å‚æ•°ï¼Œè§‚å¯ŸAIå­¦ä¹ è¡Œä¸ºå’Œæœ€ç»ˆç­–ç•¥çš„å˜åŒ–ã€‚è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„Q-Learningç¤ºä¾‹ã€‚</p><div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-1 card p-6"><h3 class="text-xl font-bold">å‚æ•°è°ƒèŠ‚</h3><div class="space-y-4"><div><label for="gamma-slider" class="font-medium flex justify-between">è¿œè§ç¨‹åº¦ ($\\gamma$): <span id="gamma-value">0.9</span></label><input type="range" id="gamma-slider" min="0.5" max="0.99" step="0.01" value="0.9" class="slider w-full"></div><div><label for="lr-slider" class="font-medium flex justify-between">å­¦ä¹ ç‡ ($\\alpha_{lr}$): <span id="lr-value">0.1</span></label><input type="range" id="lr-slider" min="0.01" max="0.5" step="0.01" value="0.1" class="slider w-full"></div><div><label for="epsilon-slider-ch9" class="font-medium flex justify-between">æ¢ç´¢ç‡ ($\\epsilon$): <span id="epsilon-value-ch9">0.2</span></label><input type="range" id="epsilon-slider-ch9" min="0.05" max="1.0" step="0.05" value="0.2" class="slider w-full"></div></div><button id="start-sim" class="mt-6 w-full bg-indigo-600 text-white font-bold py-3 rounded-lg hover:bg-indigo-700 transition-colors">å¼€å§‹ / é‡ç½®è®­ç»ƒ</button></div><div class="lg:col-span-2 card p-6"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><h3 class="text-xl font-bold">çŠ¶æ€ç©ºé—´ (ç­–ç•¥å¯è§†åŒ–)</h3><canvas id="rl-canvas" class="w-full bg-themed-muted border border-themed rounded-lg aspect-square"></canvas><div class="flex justify-around text-xs mt-2 flex-wrap"><span class="flex items-center"><div class="w-3 h-3 rounded-full bg-blue-500 mr-1"></div>æ™ºèƒ½ä½“</span><span class="flex items-center"><div class="w-3 h-3 rounded-full bg-green-200 mr-1"></div>ç›®æ ‡</span><span class="flex items-center"><div class="w-3 h-3 rounded-full bg-red-200 mr-1"></div>å±é™©</span></div></div><div><h3 class="text-xl font-bold">å­¦ä¹ æ›²çº¿ (å¹³å‡å¥–åŠ±)</h3><div class="w-full h-64 border border-themed rounded-lg p-2"><canvas id="rewardChart"></canvas></div><div class="mt-2 text-center text-sm"><p>å›åˆ: <span id="episode-counter">0</span></p><p>å¹³å‡å¥–åŠ±: <span id="total-reward">0</span></p></div></div></div></div></div>`,
            'chapter10': `<h2>ç¬¬10ç« : ä¸‰é˜¶æ®µå®‰å…¨éƒ¨ç½²</h2><p class="text-lg text-themed-secondary mb-6">å°†AIå®‰å…¨åœ°å¼•å…¥åˆ°ç°å®å·¥å‚ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ¯”ç®—æ³•æœ¬èº«æ›´å…·æŒ‘æˆ˜æ€§çš„å·¥ç¨‹é—®é¢˜ã€‚æˆ‘ä»¬å¿…é¡»é‡‡ç”¨ä¸€å¥—å¾ªåºæ¸è¿›çš„ç­–ç•¥ï¼Œå…¶æ ¸å¿ƒæ˜¯å»ºç«‹ä¿¡ä»»ã€ç®¡ç†é£é™©ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤±ã€‚</p><div class="flex flex-col lg:flex-row gap-6"><div class="w-full lg:w-1/3 space-y-2"><div id="step1" class="p-4 rounded-lg cursor-pointer deployment-step" onclick="selectStep(1)"><h4 class="font-bold text-lg">é˜¶æ®µä¸€ï¼šå»ºè®®æ¨¡å¼</h4><p class="text-sm">AIä½œä¸º"å½±å­é¡¾é—®"ï¼Œé›¶é£é™©éªŒè¯æ€§èƒ½ã€‚</p></div><div id="step2" class="p-4 rounded-lg cursor-pointer deployment-step" onclick="selectStep(2)"><h4 class="font-bold text-lg">é˜¶æ®µäºŒï¼šç›‘ç£æ§åˆ¶</h4><p class="text-sm">AIè°ƒæ•´PIDè®¾å®šå€¼ï¼Œåˆ©ç”¨ç°æœ‰ç³»ç»Ÿä½œä¸ºå®‰å…¨ç½‘ã€‚</p></div><div id="step3" class="p-4 rounded-lg cursor-pointer deployment-step" onclick="selectStep(3)"><h4 class="font-bold text-lg">é˜¶æ®µä¸‰ï¼šç›´æ¥æ§åˆ¶</h4><p class="text-sm">AIç›´æ¥è¾“å‡ºæŒ‡ä»¤ï¼Œä½†é¡»é€šè¿‡"å®‰å…¨å±‚"è¿‡æ»¤ã€‚</p></div></div><div id="step-content" class="flex-1 card p-6 min-h-[300px]"></div></div>`,
            'chapter11': `<h2>ç¬¬11ç« : æ€»ç»“ä¸æœªæ¥</h2><p class="text-lg text-themed-secondary mb-6">æˆ‘ä»¬ä»é”…ç‚‰åŸç†å‡ºå‘ï¼Œæ¢è®¨äº†å¦‚ä½•å°†å·¥ä¸šé—®é¢˜æŠ½è±¡ä¸ºCMDPæ¨¡å‹ï¼Œä»‹ç»äº†PPOå’ŒSACç­‰ç®—æ³•ï¼Œå¹¶é˜è¿°äº†ä»æ•°å­—å­ªç”Ÿåˆ°ä¸‰é˜¶æ®µå®‰å…¨éƒ¨ç½²çš„å®Œæ•´å·¥ç¨‹å®è·µæ¡†æ¶ã€‚æˆåŠŸçš„å·¥ä¸šAIåº”ç”¨ï¼Œæ˜¯**ç®—æ³•ã€é¢†åŸŸçŸ¥è¯†å’Œå·¥ç¨‹å®è·µ**ä¸‰è€…æ·±åº¦èåˆçš„äº§ç‰©ã€‚</p><div class="card p-6"><h3 class="text-xl font-bold">æœªæ¥ç ”ç©¶æ–¹å‘</h3><p class="text-themed-secondary mb-6">é”…ç‚‰ä¼˜åŒ–é¢†åŸŸä»æœ‰å¹¿é˜”çš„æ¢ç´¢ç©ºé—´ï¼š</p><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div class="p-4 bg-themed-muted rounded-lg hover:shadow-md transition"><h4 class="font-bold text-lg">å¤šæ™ºèƒ½ä½“ (MARL)</h4><p class="text-sm mt-2">å°†æ¯ä¸ªç‡ƒçƒ§å™¨è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ™ºèƒ½ä½“ï¼Œå­¦ä¹ ååŒé…åˆï¼Œä»¥å®ç°æ¯”å•æ™ºèƒ½ä½“æ›´ç²¾ç»†çš„æ§åˆ¶ã€‚</p></div><div class="p-4 bg-themed-muted rounded-lg hover:shadow-md transition"><h4 class="font-bold text-lg">å¯è§£é‡Šæ€§ (XAI)</h4><p class="text-sm mt-2">è®©AIä¸å†æ˜¯"é»‘ç®±"ï¼Œèƒ½å¤Ÿè§£é‡Šå…¶å†³ç­–åŸå› ï¼Œå¯¹äºå»ºç«‹æ“ä½œå‘˜ä¿¡ä»»è‡³å…³é‡è¦ã€‚</p></div><div class="p-4 bg-themed-muted rounded-lg hover:shadow-md transition"><h4 class="font-bold text-lg">è¿ç§»å­¦ä¹ ä¸ç»ˆèº«å­¦ä¹ </h4><p class="text-sm mt-2">å°†åœ¨Aæœºç»„ä¸Šè®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œå¿«é€Ÿé€‚é…åˆ°Bæœºç»„ä¸Šã€‚å¹¶è®©æ¨¡å‹åœ¨ä¸Šçº¿åèƒ½æŒç»­åœ°åœ¨çº¿å­¦ä¹ ï¼Œé€‚åº”æ–°æƒ…å†µã€‚</p></div></div></div>`,
            'chapter12': `<h2>ç¬¬12ç« : é«˜çº§ä¸»é¢˜ - ç¦»çº¿å¼ºåŒ–å­¦ä¹ </h2><p class="text-lg text-themed-secondary mb-6">åœ¨è®¸å¤šç°å®ä¸–ç•Œçš„å·¥ä¸šåº”ç”¨ä¸­ï¼Œè®©ä¸€ä¸ªæœªç»è®­ç»ƒçš„æ™ºèƒ½ä½“è‡ªç”±åœ°ä¸ç¯å¢ƒï¼ˆå¦‚çœŸå®çš„é”…ç‚‰ï¼‰äº¤äº’æ¥è¿›è¡Œ"è¯•é”™"å­¦ä¹ æ˜¯ä¸å¯è¡Œçš„â€”â€”æˆæœ¬é«˜æ˜‚ä¸”é£é™©å·¨å¤§ã€‚ç¦»çº¿å¼ºåŒ–å­¦ä¹ ï¼ˆOffline Reinforcement Learningï¼‰æ­£æ˜¯åœ¨è¿™ç§èƒŒæ™¯ä¸‹åº”è¿è€Œç”Ÿçš„ä¸€å¥—å…³é”®æŠ€æœ¯ã€‚</p><div class="card p-6 mb-6"><h3 class="text-xl font-bold">ä»€ä¹ˆæ˜¯ç¦»çº¿RLï¼Ÿ</h3><p class="text-themed-secondary mb-4">ä¸ä¼ ç»Ÿçš„åœ¨çº¿RLï¼ˆOnline RLï¼‰åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å¯ä»¥ä¸æ–­ä¸ç¯å¢ƒäº¤äº’å¹¶æ”¶é›†æ–°æ•°æ®ä¸åŒï¼Œç¦»çº¿RLçš„ç›®æ ‡æ˜¯**ä»…ä»ä¸€ä¸ªé¢„å…ˆæ”¶é›†å¥½çš„ã€å›ºå®šçš„å†å²æ•°æ®é›†ä¸­å­¦ä¹ å‡ºä¸€ä¸ªæœ‰æ•ˆçš„ç­–ç•¥**ã€‚è¿™ä¸ªæ•°æ®é›†å¯èƒ½æ¥è‡ªäºäººç±»ä¸“å®¶çš„æ“ä½œè®°å½•ã€ä¼ ç»Ÿæ§åˆ¶å™¨ï¼ˆå¦‚PIDï¼‰çš„è¿è¡Œæ—¥å¿—ï¼Œæˆ–è€…ä¹‹å‰å…¶ä»–ç­–ç•¥çš„è¿è¡Œæ•°æ®ã€‚</p><div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center"><div class="p-4 bg-blue-500/10 rounded-lg"><h4 class="font-bold text-blue-600 dark:text-blue-400">åœ¨çº¿RL (Online RL)</h4><p class="text-sm mt-2">æ™ºèƒ½ä½“ä¸ç¯å¢ƒæ„æˆä¸€ä¸ªé—­ç¯ã€‚æ™ºèƒ½ä½“æ‰§è¡ŒåŠ¨ä½œ -> ç¯å¢ƒåé¦ˆ -> æ™ºèƒ½ä½“æ›´æ–°ç­–ç•¥ -> æ‰§è¡Œæ–°åŠ¨ä½œ... è¿™ä¸ªå¾ªç¯ä¸æ–­è¿›è¡Œã€‚</p></div><div class="p-4 bg-green-500/10 rounded-lg"><h4 class="font-bold text-green-600 dark:text-green-400">ç¦»çº¿RL (Offline RL)</h4><p class="text-sm mt-2">å­¦ä¹ è¿‡ç¨‹ä¸æ•°æ®æ”¶é›†è¿‡ç¨‹å®Œå…¨åˆ†ç¦»ã€‚æˆ‘ä»¬åªæœ‰ä¸€ä¸ªå›ºå®šçš„æ•°æ®é›† $D = \\{(s, a, r, s')\\}$ï¼Œå¹¶ä¸”åœ¨å­¦ä¹ æœŸé—´æ— æ³•ä¸ç¯å¢ƒè¿›è¡Œä»»ä½•æ–°çš„äº¤äº’ã€‚</p></div></div></div><div class="card p-6"><h3 class="text-xl font-bold">æ ¸å¿ƒæŒ‘æˆ˜ï¼šåˆ†å¸ƒå¤–æ¨è¯¯å·®</h3><p class="text-themed-secondary mb-4">ç¦»çº¿RLçš„ä¸»è¦æŒ‘æˆ˜æ¥è‡ªäº**åˆ†å¸ƒåç§»ï¼ˆDistributional Shiftï¼‰**ã€‚å½“å­¦ä¹ çš„ç­–ç•¥ $\\pi_\\theta$ æƒ³è¦å°è¯•ä¸€ä¸ªåŠ¨ä½œ $a$ï¼Œè€Œè¿™ä¸ªåŠ¨ä½œåœ¨æ•°æ®é›†çš„è¡Œä¸ºç­–ç•¥ $\\pi_\\beta$ ä¸­å¾ˆå°‘æˆ–ä»æœªå‡ºç°è¿‡æ—¶ï¼Œä»·å€¼å‡½æ•°å¯¹è¿™ä¸ª"åˆ†å¸ƒå¤–"ï¼ˆOut-of-Distribution, OODï¼‰åŠ¨ä½œçš„ä¼°è®¡å°±ä¼šå˜å¾—éå¸¸ä¸å‡†ç¡®ï¼Œäº§ç”Ÿå·¨å¤§çš„å¤–æ¨è¯¯å·®ã€‚ç°ä»£ç¦»çº¿RLç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯**ç­–ç•¥çº¦æŸï¼ˆPolicy Constraintï¼‰**ï¼Œå³å­¦ä¹ çš„ç­–ç•¥åº”è¯¥è¢«çº¦æŸï¼Œä½¿å…¶å°½å¯èƒ½åœ°ä¸æ•°æ®é›†ä¸­çš„è¡Œä¸ºç­–ç•¥ä¿æŒæ¥è¿‘ã€‚</p><div id="offline-rl-diagram" class="p-4 bg-themed-muted rounded-lg flex justify-center items-center mt-4"></div></div>`,
            'glossary': `<h2>å…³é”®æœ¯è¯­è¡¨ (Glossary)</h2><p class="text-lg text-themed-secondary mb-6">è¿™é‡Œæ±‡æ€»äº†æœ¬å¹³å°ä¸­å‡ºç°çš„å…³é”®å¼ºåŒ–å­¦ä¹ æœ¯è¯­ï¼Œæ–¹ä¾¿æ‚¨éšæ—¶æŸ¥é˜…ã€‚</p>
                        <div class="space-y-4">
                            <div class="card p-4"><h3 class="text-lg font-bold mt-0">Model-Based vs. Model-Free (åŸºäºæ¨¡å‹ vs. æ— æ¨¡å‹)</h3><p class="text-sm text-themed-secondary">åŸºäºæ¨¡å‹çš„RLå°è¯•å­¦ä¹ ç¯å¢ƒçš„æ¨¡å‹ï¼ˆå³çŠ¶æ€è½¬ç§»å‡½æ•°På’Œå¥–åŠ±å‡½æ•°Rï¼‰ï¼Œç„¶ååˆ©ç”¨è¿™ä¸ªæ¨¡å‹è¿›è¡Œè§„åˆ’ã€‚æ— æ¨¡å‹çš„RLåˆ™ä¸å­¦ä¹ æ¨¡å‹ï¼Œç›´æ¥å­¦ä¹ ä¸€ä¸ªç­–ç•¥æˆ–ä»·å€¼å‡½æ•°ã€‚PPOå’ŒSACéƒ½æ˜¯æ— æ¨¡å‹ç®—æ³•ã€‚</p></div>
                            <div class="card p-4"><h3 class="text-lg font-bold mt-0">On-Policy vs. Off-Policy (åŒç­–ç•¥ vs. å¼‚ç­–ç•¥)</h3><p class="text-sm text-themed-secondary">åŒç­–ç•¥ç®—æ³•ä½¿ç”¨å½“å‰ç­–ç•¥äº§ç”Ÿçš„æ•°æ®æ¥æ›´æ–°å½“å‰ç­–ç•¥ï¼ˆå¦‚PPOï¼‰ã€‚å¼‚ç­–ç•¥ç®—æ³•å¯ä»¥ä½¿ç”¨è¿‡å»ç­–ç•¥ï¼ˆç”šè‡³äººç±»ä¸“å®¶ï¼‰äº§ç”Ÿçš„æ•°æ®æ¥æ›´æ–°å½“å‰ç­–ç•¥ï¼ˆå¦‚DQN, SACï¼‰ï¼Œè¿™é€šå¸¸èƒ½å¸¦æ¥æ›´é«˜çš„æ•°æ®æ•ˆç‡ã€‚</p></div>
                            <div class="card p-4"><h3 class="text-lg font-bold mt-0">Exploration vs. Exploitation (æ¢ç´¢ vs. åˆ©ç”¨)</h3><p class="text-sm text-themed-secondary">æ¢ç´¢æ˜¯æŒ‡å°è¯•æ–°çš„ã€æœªçŸ¥çš„åŠ¨ä½œä»¥å‘ç°å¯èƒ½æ›´å¥½çš„å¥–åŠ±ï¼›åˆ©ç”¨æ˜¯æŒ‡æ‰§è¡Œå½“å‰å·²çŸ¥çš„æœ€ä¼˜åŠ¨ä½œä»¥æœ€å¤§åŒ–çŸ­æœŸå¥–åŠ±ã€‚åœ¨RLä¸­æ‰¾åˆ°äºŒè€…çš„å¹³è¡¡è‡³å…³é‡è¦ã€‚</p></div>
                            <div class="card p-4"><h3 class="text-lg font-bold mt-0">Credit Assignment Problem (ä¿¡åº¦åˆ†é…é—®é¢˜)</h3><p class="text-sm text-themed-secondary">æŒ‡åœ¨ä¸€ä¸ªé•¿åºåˆ—çš„åŠ¨ä½œä¹‹åè·å¾—äº†ä¸€ä¸ªå¥–åŠ±ï¼ˆæˆ–æƒ©ç½šï¼‰ï¼Œå¦‚ä½•åˆ¤æ–­è¿™ä¸ªç»“æœæ˜¯å“ªä¸ªï¼ˆæˆ–å“ªäº›ï¼‰åŠ¨ä½œçš„åŠŸåŠ³ï¼ˆæˆ–è¿‡é”™ï¼‰ã€‚</p></div>
                            <div class="card p-4"><h3 class="text-lg font-bold mt-0">Sim-to-Real Gap (ä»¿çœŸåˆ°ç°å®çš„é¸¿æ²Ÿ)</h3><p class="text-sm text-themed-secondary">æŒ‡åœ¨ä»¿çœŸç¯å¢ƒä¸­è®­ç»ƒå‡ºçš„ç­–ç•¥ï¼Œåœ¨éƒ¨ç½²åˆ°çœŸå®ç‰©ç†ä¸–ç•Œæ—¶æ€§èƒ½ä¸‹é™çš„ç°è±¡ã€‚è¿™æ˜¯å› ä¸ºä»¿çœŸç¯å¢ƒæ— æ³•100%ç²¾ç¡®åœ°æ¨¡æ‹ŸçœŸå®ä¸–ç•Œã€‚ç¼©å°è¿™ä¸€é¸¿æ²Ÿæ˜¯å·¥ç¨‹å®è·µä¸­çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚</p></div>
                        </div>`,
            'team': `<h2>å›¢é˜Ÿä»‹ç»</h2><p class="text-lg text-themed-secondary mb-6">æˆ‘ä»¬æ˜¯ä¸€æ”¯è‡´åŠ›äºå°†å‰æ²¿äººå·¥æ™ºèƒ½æŠ€æœ¯ä¸å·¥ä¸šå®è·µç›¸ç»“åˆçš„å›¢é˜Ÿï¼Œä¸“æ³¨äºä¸ºèƒ½æºã€åˆ¶é€ ç­‰å…³é”®é¢†åŸŸæä¾›é«˜æ•ˆã€å¯é çš„æ™ºèƒ½åŒ–è§£å†³æ–¹æ¡ˆã€‚</p><div class="flex flex-col items-center"><img src="image/seu-logo.png" alt="ä¸œå—å¤§å­¦logo" style="width:96px;max-width:30vw;" class="mb-6"><div class="card text-center p-10" style="max-width:420px;"><img class="w-48 h-48 rounded-full mx-auto mb-6 border-4 border-indigo-200" src="image/my-photo.jpg" alt="ä¾¯å† è¾°"><h3 class="text-2xl font-bold m-0 mb-2">ä¾¯å† è¾°</h3><p class="text-indigo-500 dark:text-indigo-400 text-lg mb-2">é¡¹ç›®è´Ÿè´£äºº & ç®—æ³•å·¥ç¨‹å¸ˆ</p><p class="text-base text-themed-secondary">è´Ÿè´£æ ¸å¿ƒå¼ºåŒ–å­¦ä¹ ç®—æ³•çš„ç ”å‘ã€æ¨¡å‹è®­ç»ƒä¸éƒ¨ç½²ç­–ç•¥åˆ¶å®šã€‚</p></div></div>`,
            'resources': `<h2>å…³é”®èµ„æº</h2><p class="text-lg text-themed-secondary mb-6">æœ¬å¹³å°å†…å®¹æ·±å—ä»¥ä¸‹ç»å…¸ç ”ç©¶ä¸èµ„æ–™çš„å¯å‘ã€‚æˆ‘ä»¬å¼ºçƒˆæ¨èå¸Œæœ›æ·±å…¥å­¦ä¹ çš„åŒå­¦é˜…è¯»å’Œæ¢ç´¢ã€‚</p><div class="space-y-8"><div><h3 class="text-xl font-bold">å¥ åŸºæ€§è®ºæ–‡</h3><ul class="list-disc list-inside space-y-2 mt-4 text-themed-secondary"><li>Mnih, V., et al. (2015). <a href="https://www.nature.com/articles/nature14236" target="_blank" class="text-indigo-500 hover:underline">Human-level control through deep reinforcement learning</a>. Nature. (DQN)</li><li>Schulman, J., et al. (2017). <a href="https://arxiv.org/abs/1707.06347" target="_blank" class="text-indigo-500 hover:underline">Proximal Policy Optimization Algorithms</a>. arXiv. (PPO)</li><li>Haarnoja, T., et al. (2018). <a href="https://arxiv.org/abs/1812.05905" target="_blank" class="text-indigo-500 hover:underline">Soft Actor-Critic Algorithms and Applications</a>. arXiv. (SAC)</li><li>Levine, S., et al. (2020). <a href="https://arxiv.org/abs/2004.07219" target="_blank" class="text-indigo-500 hover:underline">Offline Reinforcement Learning: Tutorial, Review, and Perspectives on Open Problems</a>. arXiv. (Offline RL)</li></ul></div><div><h3 class="text-xl font-bold">æ¨èä¹¦ç±</h3><ul class="list-disc list-inside space-y-2 mt-4 text-themed-secondary"><li>Sutton, R. S., & Barto, A. G. (2018). <a href="http://incompleteideas.net/book/the-book-2nd.html" target="_blank" class="text-indigo-500 hover:underline">Reinforcement Learning: An Introduction</a>. MIT press. (è¢«èª‰ä¸ºRLé¢†åŸŸçš„"åœ£ç»")</li><li>Goodfellow, I., Bengio, Y., & Courville, A. (2016). <a href="https://www.deeplearningbook.org/" target="_blank" class="text-indigo-500 hover:underline">Deep Learning</a>. MIT press. (æ·±åº¦å­¦ä¹ é¢†åŸŸçš„æƒå¨è‘—ä½œ)</li></ul></div><div><h3 class="text-xl font-bold">åœ¨çº¿è¯¾ç¨‹ä¸èµ„æº</h3><ul class="list-disc list-inside space-y-2 mt-4 text-themed-secondary"><li><a href="https://spinningup.openai.com/en/latest/" target="_blank" class="text-indigo-500 hover:underline">OpenAI Spinning Up in Deep RL</a>: OpenAIå‡ºå“çš„ä¼˜ç§€æ·±åº¦å¼ºåŒ–å­¦ä¹ å…¥é—¨æ•™ç¨‹ã€‚</li><li><a href="https://huggingface.co/deep-rl-course/unit0/introduction" target="_blank" class="text-indigo-500 hover:underline">Hugging Face Deep RL Course</a>: Hugging Faceæ¨å‡ºçš„å…è´¹æ·±åº¦å¼ºåŒ–å­¦ä¹ è¯¾ç¨‹ã€‚</li></ul></div></div>`
        };

        function initChapter1() {
            initBoilerSandbox();
            renderBoilerDiagram();
            renderRankineDiagram();
        }
        function initChapter2() {
            initBellmanGrid();
            renderRlTaxonomy();
        }
        function initBoilerSandbox() {
            const sliders = {
                load: document.getElementById('load-slider'),
                air: document.getElementById('air-total-slider'),
                tilt: document.getElementById('burner-tilt-slider'),
                ofa: document.getElementById('o2-dist-slider')
            };
            if (!sliders.load) return;

            const values = {
                load: document.getElementById('load-value'),
                air: document.getElementById('air-total-value'),
                tilt: document.getElementById('burner-tilt-value'),
                ofa: document.getElementById('o2-dist-value')
            };
            const visuals = {
                flame: document.getElementById('flame-visual'),
                nox: document.getElementById('nox-meter-fill'),
                co: document.getElementById('co-meter-fill'),
                efficiency: document.getElementById('efficiency-value')
            };
            
            const paretoCtx = document.getElementById('pareto-chart')?.getContext('2d');
            let paretoChart;
            let workingPointHistory = [];

            function updateBoilerSimulation() {
                const load = parseFloat(sliders.load.value);
                const air = parseFloat(sliders.air.value);
                const tilt = parseFloat(sliders.tilt.value);
                const ofa = parseFloat(sliders.ofa.value);
                
                values.load.textContent = load.toFixed(0);
                values.air.textContent = air.toFixed(0);
                values.tilt.textContent = tilt.toFixed(0);
                values.ofa.textContent = ofa.toFixed(0);

                const load_factor = load / 100;
                let nox_raw = (air * 1.2 - ofa * 1.5 + Math.abs(tilt) * 0.8) * (0.8 + load_factor * 0.4);
                let co_raw = (150 - air + (Math.abs(air - 85) * 0.5)) * (0.9 + load_factor * 0.2);
                let eff_base = 90.5 + load_factor * 2;
                let eff_air = 1 - Math.abs(air - (80 + load_factor * 5)) / 50;
                let eff_ofa = 1 - Math.abs(ofa - 35) / 40;
                let efficiency_raw = eff_base + (eff_air * 1.5) + (eff_ofa * 1) - (co_raw / 150);

                const nox = Math.max(10, Math.min(100, nox_raw));
                const co = Math.max(5, Math.min(100, co_raw));
                const efficiency = Math.max(88, Math.min(94.5, efficiency_raw));
                
                // --- å¢å¼ºç«ç„°åŠ¨ç”» ---
                const flameHeight = (30 + (air / 100) * 80) * (0.7 + load_factor * 0.4);
                const flameSkew = tilt * -0.8;
                visuals.flame.style.height = `${flameHeight}%`;
                visuals.flame.style.transform = `translateY(${tilt * -2}px) skewX(${flameSkew}deg)`;
                // --- ç»“æŸå¢å¼º ---
                
                visuals.nox.style.width = `${nox}%`;
                visuals.co.style.width = `${co}%`;
                visuals.efficiency.textContent = efficiency.toFixed(2);

                updateParetoChart(efficiency, nox);
            }

            function generateParetoFront() {
                const front = [];
                for (let eff = 94.5; eff >= 90; eff -= 0.1) {
                    let nox = 30 + Math.pow(94.5 - eff, 2) * 2;
                    nox += (Math.random() - 0.5) * 5;
                    front.push({x: nox, y: eff});
                }
                return front.sort((a,b) => a.x - b.x);
            }

            function updateParetoChart(efficiency, nox) {
                if (!paretoCtx) return;
                
                const newPoint = {x: nox, y: efficiency};
                workingPointHistory.push(newPoint);
                if (workingPointHistory.length > 20) workingPointHistory.shift();

                if (paretoChart) paretoChart.destroy();
                
                const isDark = document.documentElement.classList.contains('dark');
                const gridColor = isDark ? 'rgba(148, 163, 184, 0.2)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDark ? '#94a3b8' : '#475569';

                paretoChart = new Chart(paretoCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'å¸•ç´¯æ‰˜æœ€ä¼˜å‰æ²¿', data: generateParetoFront(), borderColor: 'rgba(220, 38, 38, 0.5)', borderWidth: 2, borderDash: [5, 5], pointRadius: 0, showLine: true, fill: false,
                        },{
                            label: 'å†å²è½¨è¿¹', data: workingPointHistory, backgroundColor: 'rgba(100, 116, 139, 0.3)', pointRadius: 3,
                        },{
                            label: 'å½“å‰å·¥ä½œç‚¹', data: [newPoint], backgroundColor: 'rgb(79, 70, 229)', pointRadius: 8, pointHoverRadius: 10,
                        }]
                    },
                    options: {
                        animation: false,
                        scales: { 
                            x: { title: { display: true, text: 'NOx æ’æ”¾', color: textColor }, min: 20, max: 100, grid: { color: gridColor }, ticks: { color: textColor } }, 
                            y: { title: { display: true, text: 'çƒ­æ•ˆç‡ (%)', color: textColor }, min: 88, max: 95, grid: { color: gridColor }, ticks: { color: textColor } } 
                        },
                        plugins: { legend: { position: 'bottom', labels: { color: textColor } } }
                    }
                });
            }

            Object.values(sliders).forEach(slider => slider.addEventListener('input', updateBoilerSimulation));
            updateBoilerSimulation();
        }
        
        function initBellmanGrid() {
            const canvas = document.getElementById('bellman-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const iterateBtn = document.getElementById('iterate-bellman-btn');
            const solveBtn = document.getElementById('solve-bellman-btn');
            const resetBtn = document.getElementById('reset-bellman-btn');
            const iterCountEl = document.getElementById('bellman-iteration-count');
            const updateInfoEl = document.getElementById('bellman-update-info');
            const methodSelect = document.getElementById('dp-method-select');
            const phaseInfoEl = document.getElementById('pi-phase-info');

            const GRID_SIZE = 5;
            const GAMMA = 0.9;
            const REWARDS = { goal: 1, trap: -1, step: 0 };
            const goal = {x: 4, y: 4};
            const traps = [{x: 2, y: 2}, {x: 1, y: 3}];
            const walls = [{x: 3, y: 1}];

            let values, policy, iterationCount, pi_phase, convergence_threshold = 1e-4;
            let currentValues, targetValues;

            function reset() {
                if (window.bellmanInterval) clearInterval(window.bellmanInterval);
                if (state.activeAnimationFrames.bellman) cancelAnimationFrame(state.activeAnimationFrames.bellman);
                
                solveBtn.disabled = false;
                iterateBtn.disabled = false;
                solveBtn.innerHTML = '<i class="fa-solid fa-robot"></i> è‡ªåŠ¨æ±‚è§£';
                iterationCount = 0;
                values = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(0));
                policy = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(Math.floor(Math.random() * 4)));
                
                currentValues = JSON.parse(JSON.stringify(values));
                targetValues = JSON.parse(JSON.stringify(values));

                iterCountEl.textContent = iterationCount;
                updateInfoEl.textContent = 'ç¯å¢ƒå·²é‡ç½®ã€‚è¯·å¼€å§‹è¿­ä»£...';
                pi_phase = 'evaluation';
                updatePhaseDisplay();
                
                animateGrid();
            }

            function iterate() {
                const method = methodSelect.value;
                let is_converged = false;
                if (method === 'vi') { is_converged = valueIterationStep(); } 
                else { is_converged = policyIterationStep(); }
                iterationCount++;
                iterCountEl.textContent = iterationCount;
                targetValues = JSON.parse(JSON.stringify(values));
                return is_converged;
            }
            
            function autoSolve() {
                solveBtn.disabled = true;
                iterateBtn.disabled = true;
                solveBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> æ±‚è§£ä¸­...';
                if (window.bellmanInterval) clearInterval(window.bellmanInterval);
                window.bellmanInterval = setInterval(() => {
                    const converged = iterate();
                    if (converged) {
                        clearInterval(window.bellmanInterval);
                        solveBtn.innerHTML = '<i class="fa-solid fa-check"></i> æ±‚è§£å®Œæˆ';
                        const method = methodSelect.value === 'vi' ? 'ä»·å€¼è¿­ä»£' : 'ç­–ç•¥è¿­ä»£';
                        updateInfoEl.textContent = `${method}å·²æ”¶æ•›ï¼`;
                    }
                }, 100);
            }

            function valueIterationStep() {
                let newValues = JSON.parse(JSON.stringify(values));
                let maxChange = 0;
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        if (isWall(x, y) || isTerminal(x, y)) continue;
                        const actionValues = getActionValues(x, y, values);
                        const bestValue = Math.max(...actionValues);
                        newValues[y][x] = REWARDS.step + GAMMA * bestValue;
                        maxChange = Math.max(maxChange, Math.abs(newValues[y][x] - values[y][x]));
                    }
                }
                values = newValues;
                updatePolicyBasedOnValues();
                updateInfoEl.textContent = `ä»·å€¼è¿­ä»£ | æœ€å¤§å˜åŒ–: ${maxChange.toFixed(5)}`;
                return maxChange < convergence_threshold;
            }

            function policyIterationStep() {
                let policy_stable = true;
                if (pi_phase === 'evaluation') {
                    let maxChange = 0;
                    for (let sweep = 0; sweep < 5; sweep++) { 
                        let currentMaxChange = 0;
                        for (let y = 0; y < GRID_SIZE; y++) {
                            for (let x = 0; x < GRID_SIZE; x++) {
                                if (isWall(x, y) || isTerminal(x, y)) continue;
                                const currentAction = policy[y][x];
                                const actionValue = getActionValues(x, y, values)[currentAction];
                                const newValue = REWARDS.step + GAMMA * actionValue;
                                currentMaxChange = Math.max(currentMaxChange, Math.abs(newValue - values[y][x]));
                                values[y][x] = newValue;
                            }
                        }
                        maxChange = currentMaxChange;
                    }
                    updateInfoEl.textContent = `ç­–ç•¥è¯„ä¼° | æœ€å¤§å˜åŒ–: ${maxChange.toFixed(5)}`;
                    if (maxChange < convergence_threshold) pi_phase = 'improvement';
                } else { // improvement phase
                    for (let y = 0; y < GRID_SIZE; y++) {
                        for (let x = 0; x < GRID_SIZE; x++) {
                            if (isTerminal(x, y) || isWall(x, y)) continue;
                            let old_action = policy[y][x];
                            const actionValues = getActionValues(x, y, values);
                            policy[y][x] = actionValues.indexOf(Math.max(...actionValues));
                            if (old_action !== policy[y][x]) policy_stable = false;
                        }
                    }
                    updateInfoEl.textContent = `ç­–ç•¥æå‡ | ç­–ç•¥ç¨³å®š: ${policy_stable}`;
                    pi_phase = 'evaluation';
                    if (policy_stable) return true;
                }
                updatePhaseDisplay();
                return false;
            }
            
            function getActionValues(x, y, value_grid) {
                const actions = [[0, -1], [0, 1], [-1, 0], [1, 0]]; // U, D, L, R
                return actions.map(([dx, dy]) => {
                    const nx = x + dx, ny = y + dy;
                    if (nx < 0 || nx >= GRID_SIZE || ny < 0 || ny >= GRID_SIZE || isWall(nx, ny)) {
                        return value_grid[y][x];
                    }
                    return value_grid[ny][nx];
                });
            }
            
            function updatePolicyBasedOnValues() {
                 for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        if (isTerminal(x, y) || isWall(x, y)) continue;
                        const actionValues = getActionValues(x, y, values);
                        policy[y][x] = actionValues.indexOf(Math.max(...actionValues));
                    }
                }
            }

            function isTerminal(x, y) { return (x === goal.x && y === goal.y) || traps.some(t => t.x === x && t.y === y); }
            function isWall(x, y) { return walls.some(w => w.x === x && w.y === y); }
            function updatePhaseDisplay() { phaseInfoEl.textContent = methodSelect.value === 'pi' ? (pi_phase === 'evaluation' ? 'è¯„ä¼°ä¸­' : 'æå‡ä¸­') : 'N/A'; }

            function animateGrid() {
                const cellSize = canvas.width / GRID_SIZE;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const isDark = document.documentElement.classList.contains('dark');
                let needsAnotherFrame = false;

                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        const diff = targetValues[y][x] - currentValues[y][x];
                        if (Math.abs(diff) > 0.001) {
                            currentValues[y][x] += diff * 0.1; // Interpolation
                            needsAnotherFrame = true;
                        } else {
                            currentValues[y][x] = targetValues[y][x];
                        }
                        
                        const val = currentValues[y][x];
                        const heat = (val - REWARDS.trap) / (REWARDS.goal - REWARDS.trap);
                        const r = Math.floor(255 * (1 - heat));
                        const g = Math.floor(255 * heat);
                        ctx.fillStyle = `rgb(${r}, ${g}, 100)`;
                        if (isWall(x, y)) ctx.fillStyle = '#555';
                        else if (isTerminal(x, y)) ctx.fillStyle = (x === goal.x && y === goal.y) ? 'rgb(100,255,100)' : 'rgb(255,100,100)';
                        
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                        ctx.strokeStyle = isDark ? '#475569' : '#ccc';
                        ctx.strokeRect(x * cellSize, y * cellSize, cellSize, cellSize);

                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        if (isTerminal(x,y) || isWall(x,y)) {
                            ctx.font = `${cellSize*0.6}px sans-serif`;
                            if(x === goal.x && y === goal.y) ctx.fillText('ğŸ†', x*cellSize+cellSize/2, y*cellSize+cellSize/2);
                            else if(isWall(x, y)) ctx.fillText('ğŸ§±', x*cellSize+cellSize/2, y*cellSize+cellSize/2);
                            else ctx.fillText('â˜ ï¸', x*cellSize+cellSize/2, y*cellSize+cellSize/2);
                        } else {
                            ctx.fillStyle = isDark ? '#f1f5f9' : '#1e293b';
                            ctx.font = `bold ${cellSize*0.25}px sans-serif`;
                            ctx.fillText(val.toFixed(2), x*cellSize+cellSize/2, y*cellSize+cellSize/4);
                            if(policy[y][x] !== -1) {
                                 ctx.font = `${cellSize*0.4}px sans-serif`;
                                 const arrows = ['â†‘', 'â†“', 'â†', 'â†’'];
                                 ctx.fillText(arrows[policy[y][x]], x*cellSize+cellSize/2, y*cellSize+cellSize*0.7);
                            }
                        }
                    }
                }
                if (needsAnotherFrame) {
                    state.activeAnimationFrames.bellman = requestAnimationFrame(animateGrid);
                }
            }
            
            iterateBtn.addEventListener('click', () => {
                iterate();
                if (!state.activeAnimationFrames.bellman) animateGrid();
            });
            solveBtn.addEventListener('click', () => {
                autoSolve();
                if (!state.activeAnimationFrames.bellman) animateGrid();
            });
            resetBtn.addEventListener('click', reset);
            methodSelect.addEventListener('change', reset);
            reset();
        }
        
        function initActorCriticViz() {
            const container = document.getElementById('ac-diagram-container');
            if (!container) return;
            const playBtn = document.getElementById('play-ac-viz');
            const explanationEl = document.getElementById('ac-viz-explanation');
            renderAcDiagram(container);
            const svgEl = container.querySelector('svg');
            if (!svgEl) return;
            const allElements = {
                nodes: Array.from(svgEl.querySelectorAll(".ac-node")),
                arrows: Array.from(svgEl.querySelectorAll(".ac-arrow")),
                updateLabel: svgEl.querySelector("#label-update")
            };
            function resetHighlights() {
                allElements.nodes.forEach(el => el.classList.remove('highlight'));
                allElements.arrows.forEach(el => {
                    el.style.stroke = '#9ca3af';
                    el.setAttribute('marker-end', 'url(#arrowhead)');
                });
                if (allElements.updateLabel) allElements.updateLabel.style.fill = 'transparent';
                explanationEl.textContent = "";
            }
            playBtn.addEventListener('click', () => {
                if (playBtn.disabled) return;
                playBtn.disabled = true;
                if(window.acAnimationTimeoutId) clearTimeout(window.acAnimationTimeoutId);
                let stepIndex = 0;
                const steps = [
                    { el: ["node-state"], text: "1. æ™ºèƒ½ä½“è§‚å¯Ÿåˆ°å½“å‰çŠ¶æ€ S" },
                    { el: ["arrow-to-actor"], text: "2. çŠ¶æ€ S è¢«è¾“å…¥ç»™æ¼”å‘˜ (Actor)" },
                    { el: ["node-actor"], text: "3. æ¼”å‘˜æ ¹æ®å…¶ç­–ç•¥ $\\pi(a|S)$ï¼Œé€‰æ‹©ä¸€ä¸ªåŠ¨ä½œ A" },
                    { el: ["arrow-to-action"], text: "4. æ¼”å‘˜è¾“å‡ºåŠ¨ä½œ A" },
                    { el: ["node-action"], text: "5. åŠ¨ä½œ A æ–½åŠ äºç¯å¢ƒ" },
                    { el: ["arrow-to-env"], text: "6. ç¯å¢ƒæ¥æ”¶åŠ¨ä½œå¹¶å‘ç”ŸçŠ¶æ€è½¬ç§»" },
                    { el: ["node-env"], text: "7. ç¯å¢ƒè¿”å›æ–°çŠ¶æ€S'å’Œå¥–åŠ±R" },
                    { el: ["arrow-to-critic"], text: "8. (S, A, R, S') è¢«é€å¾€è¯„è®ºå®¶è¿›è¡Œè¯„ä¼°" },
                    { el: ["node-critic"], text: "9. è¯„è®ºå®¶è®¡ç®—ä¼˜åŠ¿å‡½æ•° A(s,a)" },
                    { el: ["arrow-critic-to-actor", "label-update"], text: "10. ä¼˜åŠ¿å‡½æ•° A(s,a) æŒ‡å¯¼æ¼”å‘˜æ›´æ–°" }
                ];
                function nextStep() {
                    resetHighlights();
                    if (stepIndex >= steps.length) {
                        playBtn.disabled = false;
                        explanationEl.textContent = "æµç¨‹ç»“æŸã€‚";
                        if(window.MathJax) MathJax.typesetPromise();
                        return;
                    }
                    const currentStep = steps[stepIndex];
                    explanationEl.innerHTML = currentStep.text;
                    if(window.MathJax) MathJax.typesetPromise();
                    currentStep.el.forEach(id => {
                        const element = svgEl.querySelector(`#${id}`);
                        if (element) {
                            if (element.tagName.toLowerCase() === 'path') {
                                element.style.stroke = '#f97316';
                                element.setAttribute('marker-end', 'url(#arrowhead-h)');
                            } else if (id.includes('node')) {
                                element.classList.add('highlight');
                            } else if (id === 'label-update') {
                                element.style.fill = '#c2410c';
                            }
                        }
                    });
                    stepIndex++;
                    window.acAnimationTimeoutId = setTimeout(nextStep, 1800);
                }
                resetHighlights();
                nextStep();
            });
        }
        function initPpoCanvas() {
            const canvas = document.getElementById('ppo-canvas'); 
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const toggleBtn = document.getElementById('ppo-toggle-advantage');
            const explanationEl = document.getElementById('ppo-explanation');
            const epsilonSlider = document.getElementById('epsilon-slider');
            const epsilonValueEl = document.getElementById('epsilon-value');
            let advantage = 1;
            let epsilon = 0.2;
            function drawPpo(){
                const w = canvas.width, h = canvas.height;
                const isDark = document.documentElement.classList.contains('dark');
                ctx.clearRect(0, 0, w, h);
                ctx.strokeStyle = isDark ? '#475569' : '#cbd5e1';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, h/2); ctx.lineTo(w, h/2);
                const r1_x = w * (1 - 0.5) / 1.5;
                ctx.moveTo(r1_x, 0); ctx.lineTo(r1_x, h);
                ctx.stroke();
                ctx.fillStyle = isDark ? '#94a3b8' : '#64748b';
                ctx.font = "12px 'Noto Sans SC'";
                ctx.fillText('r(Î¸)=1', r1_x - 10, h/2 + 15);
                ctx.fillText('ç›®æ ‡ L', w/2 - 20, 15);
                ctx.fillText('æ¦‚ç‡æ¯” r(Î¸)', w - 60, h/2 + 15);
                ctx.fillStyle = 'rgba(79, 70, 229, 0.05)';
                const clip_lower_x = w * (1 - epsilon - 0.5) / 1.5;
                const clip_upper_x = w * (1 + epsilon - 0.5) / 1.5;
                ctx.fillRect(clip_lower_x, 0, clip_upper_x - clip_lower_x, h);
                ctx.strokeStyle = '#fca5a5';
                ctx.setLineDash([5, 5]);
                ctx.lineWidth = 1.5;
                const y_clip_upper = h/2 - 50 * (1 + epsilon) * advantage;
                const y_clip_lower = h/2 - 50 * (1 - epsilon) * advantage;
                ctx.beginPath(); ctx.moveTo(0, y_clip_upper); ctx.lineTo(w, y_clip_upper); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0, y_clip_lower); ctx.lineTo(w, y_clip_lower); ctx.stroke();
                ctx.setLineDash([]);
                ctx.strokeStyle = '#4f46e5';
                ctx.lineWidth = 3;
                ctx.beginPath();
                for (let i = 0; i <= w; i++) {
                    const ratio = 0.5 + (i / w) * 1.5;
                    const y_unclipped = h/2 - 50 * ratio * advantage;
                    const y_clipped_val = h/2 - 50 * (ratio > 1 ? (1+epsilon) : (1-epsilon)) * advantage;
                    const y_final = (advantage > 0) ? Math.max(y_unclipped, y_clipped_val) : Math.min(y_unclipped, y_clipped_val);
                    i === 0 ? ctx.moveTo(i, y_final) : ctx.lineTo(i, y_final);
                }
                ctx.stroke();
                if (advantage > 0) {
                    explanationEl.innerHTML = 'å½“ä¼˜åŠ¿ $\\hat{A}_t > 0$ (å¥½åŠ¨ä½œ)æ—¶ï¼Œç›®æ ‡å‡½æ•°è¢« <span class="text-green-600 font-semibold">å‘ä¸Šæ¨åŠ¨</span>ï¼Œä½†è¢«ä¸Šé™è£å‰ªï¼Œé˜²æ­¢ç­–ç•¥è¿‡äºæ¿€è¿›ã€‚';
                } else {
                    explanationEl.innerHTML = 'å½“ä¼˜åŠ¿ $\\hat{A}_t < 0$ (ååŠ¨ä½œ)æ—¶ï¼Œç›®æ ‡å‡½æ•°è¢« <span class="text-red-600 font-semibold">å‘ä¸‹æ‹‰åŠ¨</span>ï¼Œä½†è¢«ä¸‹é™è£å‰ªï¼Œé˜²æ­¢ç­–ç•¥æ›´æ–°è¿‡çŒ›ã€‚';
                }
                if(window.MathJax) MathJax.typesetPromise();
            }
            toggleBtn.addEventListener('click', () => {
                advantage *= -1;
                toggleBtn.innerHTML = advantage > 0 ? 'åˆ‡æ¢åˆ° "ååŠ¨ä½œ" ($\\hat{A}_t < 0$)' : 'åˆ‡æ¢åˆ° "å¥½åŠ¨ä½œ" ($\\hat{A}_t > 0$)';
                if(window.MathJax) MathJax.typesetPromise();
                drawPpo();
            });
            epsilonSlider.addEventListener('input', (e) => {
                epsilon = parseFloat(e.target.value);
                epsilonValueEl.textContent = epsilon.toFixed(2);
                drawPpo();
            });
            drawPpo();
        }
        function initSacCanvas() {
            const sacCanvas = document.getElementById('sac-canvas'); 
            if (!sacCanvas) return;
            const sacCtx = sacCanvas.getContext('2d');
            const slider = document.getElementById('alpha-slider');
            const valueDisp = document.getElementById('alpha-value');
            const explanationEl = document.getElementById('sac-explanation');
            let alpha = 0.2;
            slider.addEventListener('input', (e) => {
                alpha = parseFloat(e.target.value);
                valueDisp.textContent = alpha.toFixed(2);
            });
            const rewardLandscape = (x_norm) => Math.sin(x_norm * 2 * Math.PI) * 0.5 + Math.cos(x_norm * 3 * Math.PI) * 0.3;
            let animationTime = 0;
            function drawSac() {
                if (!document.getElementById('sac-canvas')) {
                    if (window.activeAnimationFrames.sac) cancelAnimationFrame(window.activeAnimationFrames.sac);
                    return;
                }
                const w = sacCanvas.width, h = sacCanvas.height;
                sacCtx.clearRect(0, 0, w, h);
                sacCtx.beginPath();
                sacCtx.strokeStyle = 'rgba(100, 116, 139, 0.4)';
                sacCtx.lineWidth = 2;
                sacCtx.setLineDash([2, 3]);
                for (let x = 0; x <= w; x++) {
                    const y = h/2 - rewardLandscape(x / w) * h/3;
                    x === 0 ? sacCtx.moveTo(x, y) : sacCtx.lineTo(x, y);
                }
                sacCtx.stroke();
                sacCtx.setLineDash([]);
                sacCtx.beginPath();
                sacCtx.fillStyle = 'rgba(79, 70, 229, 0.5)';
                const std_dev = 0.05 + alpha * 0.4;
                animationTime += 0.005;
                const mean = w / 2 + Math.sin(animationTime) * w/3;
                sacCtx.moveTo(0, h);
                for (let x = 0; x <= w; x++) {
                    const y = Math.exp(-0.5 * Math.pow(((x - mean) / (w/4)) / std_dev, 2)) * (h - 20);
                    sacCtx.lineTo(x, h - y);
                }
                sacCtx.lineTo(w, h);
                sacCtx.closePath();
                sacCtx.fill();
                if (alpha > 0.6) explanationEl.textContent = 'é«˜ Î±: ç­–ç•¥éå¸¸å¹³å¦, ç†µå¥–åŠ±ä¸»å¯¼, æ™ºèƒ½ä½“ç§¯ææ¢ç´¢ã€‚';
                else if (alpha < 0.1) explanationEl.textContent = 'ä½ Î±: ç­–ç•¥éå¸¸å°–é”, ä»»åŠ¡å¥–åŠ±ä¸»å¯¼, æ™ºèƒ½ä½“ç§¯æåˆ©ç”¨ã€‚';
                else explanationEl.textContent = 'Î± é€‚ä¸­: åœ¨æ¢ç´¢ä¸åˆ©ç”¨ä¹‹é—´å–å¾—è‰¯å¥½å¹³è¡¡ã€‚';
                window.activeAnimationFrames.sac = requestAnimationFrame(drawSac);
            }
            drawSac();
        }
        function initQuiz() {
            const quizContainer = document.getElementById('quiz-container');
            if(!quizContainer) return;
            const quizData = [
                {
                    question: "å“ªç§ç®—æ³•æ˜¯ On-Policy (åŒç­–ç•¥) çš„ï¼Ÿ",
                    answers: ["DQN", "SAC", "PPO", "DDPG"],
                    correct: "PPO"
                },
                {
                    question: "DQN ä½¿ç”¨å“ªé¡¹å…³é”®æŠ€æœ¯æ¥æ‰“ç ´æ•°æ®ç›¸å…³æ€§ï¼Ÿ",
                    answers: ["ç›®æ ‡ç½‘ç»œ", "ç»éªŒå›æ”¾", "ä¼˜åŠ¿å‡½æ•°", "ç†µæ­£åˆ™åŒ–"],
                    correct: "ç»éªŒå›æ”¾"
                },
                {
                    question: "SAC ç®—æ³•çš„ç›®æ ‡å‡½æ•°ä¸­ï¼Œé™¤äº†æœ€å¤§åŒ–å¥–åŠ±ï¼Œè¿˜æœ€å¤§åŒ–ä»€ä¹ˆï¼Ÿ",
                    answers: ["ç­–ç•¥çš„ç¡®å®šæ€§", "ä»·å€¼å‡½æ•°", "ç­–ç•¥çš„ç†µ (éšæœºæ€§)", "åŠ¨ä½œæ•°é‡"],
                    correct: "ç­–ç•¥çš„ç†µ (éšæœºæ€§)"
                },
                {
                    question: "PPOç®—æ³•ä¸­çš„\"è£å‰ª(Clipping)\"ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜?",
                    answers: ["æå‡æ¢ç´¢æ•ˆç‡", "é™åˆ¶ç­–ç•¥æ›´æ–°æ­¥é•¿ï¼Œå¢åŠ ç¨³å®šæ€§", "å‡å°‘è®¡ç®—é‡", "å¤„ç†è¿ç»­åŠ¨ä½œç©ºé—´"],
                    correct: "é™åˆ¶ç­–ç•¥æ›´æ–°æ­¥é•¿ï¼Œå¢åŠ ç¨³å®šæ€§"
                }
            ];
            quizContainer.innerHTML = `
                ${quizData.map((q, i) => `
                    <div class="mb-6 quiz-item" id="q-${i}">
                        <p class="font-bold mb-2">${i+1}. ${q.question}</p>
                        <div class="space-y-2">
                            ${q.answers.map(a => `<label class="block p-3 border border-themed rounded-lg hover:bg-themed-muted cursor-pointer transition-colors"><input type="radio" name="q${i}" value="${a}" class="mr-3 accent-accent-color">${a}</label>`).join('')}
                        </div>
                        <p class="text-sm mt-2 font-bold hidden quiz-feedback p-2 rounded-md"></p>
                    </div>
                `).join('')}
                <div class="flex items-center gap-4 mt-8">
                    <button id="submit-quiz" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-colors">æäº¤ç­”æ¡ˆ</button>
                    <div id="quiz-final-score" class="font-bold text-lg"></div>
                </div>
            `;

            document.getElementById('submit-quiz').addEventListener('click', () => {
                let score = 0;
                quizData.forEach((q, i) => {
                    const selected = quizContainer.querySelector(`input[name="q${i}"]:checked`);
                    const feedback = quizContainer.querySelector(`#q-${i} .quiz-feedback`);
                    feedback.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');
                    if (selected) {
                        if (selected.value === q.correct) {
                            feedback.textContent = `å›ç­”æ­£ç¡®ï¼`;
                            feedback.classList.add('bg-green-100', 'text-green-700');
                            score++;
                        } else {
                            feedback.textContent = `å›ç­”é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯: ${q.correct}`;
                            feedback.classList.add('bg-red-100', 'text-red-700');
                        }
                    } else {
                        feedback.textContent = 'æ‚¨æœªé€‰æ‹©ç­”æ¡ˆã€‚';
                        feedback.classList.add('bg-red-100', 'text-red-700');
                    }
                    feedback.classList.remove('hidden');
                });
                const finalScoreEl = document.getElementById('quiz-final-score');
                finalScoreEl.textContent = `æ‚¨çš„å¾—åˆ†: ${score} / ${quizData.length}`;
            });
        }
        function initCmdpLab() {
            const builderPanel = document.getElementById('cmdp-builder-panel');
            if (!builderPanel) return;
            const checkboxes = builderPanel.querySelectorAll('.cmdp-checkbox');
            const controls = { air: document.getElementById('air-slider-ch7'), tilt: document.getElementById('tilt-slider-ch7'), ofa: document.getElementById('ofa-slider-ch7') };
            const valueLabels = { air: document.getElementById('air-value-ch7'), tilt: document.getElementById('tilt-value-ch7'), ofa: document.getElementById('ofa-value-ch7') };
            const visuals = { flame: document.getElementById('flame-visual-ch7'), noxFill: document.getElementById('nox-meter-fill-ch7'), coFill: document.getElementById('co-meter-fill-ch7'), tempFill: document.getElementById('temp-meter-fill-ch7'), efficiency: document.getElementById('efficiency-value-ch7') };
            
            function updateSimulation() {
                if (!controls.air || !controls.tilt || !controls.ofa) return;
                const air = parseFloat(controls.air.value), tilt = parseFloat(controls.tilt.value), ofa = parseFloat(controls.ofa.value);
                if (valueLabels.air) valueLabels.air.textContent = air.toFixed(0);
                if (valueLabels.tilt) valueLabels.tilt.textContent = tilt.toFixed(0);
                if (valueLabels.ofa) valueLabels.ofa.textContent = ofa.toFixed(0);
                let nox = 1.1 * air - 1.6 * ofa + 0.4 * Math.abs(tilt);
                let co = 140 - air + 0.5 * Math.abs(air - 80);
                let temp = 60 + (air - 75) + Math.abs(tilt);
                let efficiency = 91.5 + (1 - Math.abs(air - 85) / 50) * 1.5 + (1 - Math.abs(ofa - 35) / 40) * 1 - (co / 100);
                nox = Math.max(10, Math.min(100, nox));
                co = Math.max(5, Math.min(100, co));
                temp = Math.max(20, Math.min(100, temp));
                efficiency = Math.max(90, Math.min(94, efficiency));
                if (visuals.flame) {
                    visuals.flame.style.height = `${30 + (air / 100) * 70}%`;
                    visuals.flame.style.transform = `translateY(${tilt * -1.5}px) skewX(${tilt * -0.5}deg)`;
                }
                if (visuals.noxFill) visuals.noxFill.style.width = `${nox}%`;
                if (visuals.coFill) visuals.coFill.style.width = `${co}%`;
                if (visuals.tempFill) visuals.tempFill.style.width = `${temp}%`;
                if (visuals.efficiency) visuals.efficiency.textContent = efficiency.toFixed(2);
            }
            function updateUI() {
                const summary = { State: [], Action: [], Reward: [], Cost: [] };
                checkboxes.forEach(cb => {
                    const targetEl = document.getElementById(cb.dataset.target);
                    if (!targetEl) return;
                    targetEl.classList.toggle('hidden', !cb.checked);
                    targetEl.classList.remove('reward-highlight', 'cost-highlight');

                    if (cb.checked) {
                        const label = cb.parentElement.textContent.trim();
                        const header = cb.closest('div.space-y-2').previousElementSibling.textContent;
                        if (header.includes('çŠ¶æ€')) summary.State.push(label);
                        else if (header.includes('åŠ¨ä½œ')) summary.Action.push(label);
                        else if (header.includes('å¥–åŠ±')) {
                            summary.Reward.push(label);
                            targetEl.classList.add('reward-highlight');
                        }
                        else if (header.includes('æˆæœ¬')) {
                            summary.Cost.push(label);
                            targetEl.classList.add('cost-highlight');
                        }
                    }
                });
                const renderList = (key) => {
                    const el = document.getElementById(`summary-${key}-ch7`);
                    if(el) el.innerHTML = summary[key].length ? summary[key].map(item => `<li>${item}</li>`).join('') : '<li>æœªé€‰</li>';
                }
                ['State', 'Action', 'Reward', 'Cost'].forEach(renderList);
            }
            checkboxes.forEach(cb => cb.addEventListener('change', updateUI));
            Object.values(controls).forEach(slider => { if(slider) slider.addEventListener('input', updateSimulation); });
            
            updateUI();
            updateSimulation();
        }
        function initSimRealCanvas() {
            const canvas = document.getElementById('sim-real-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const slider = document.getElementById('model-quality-slider');
            const valueDisp = document.getElementById('model-quality-value');
            let quality = 50;
            if (slider) slider.oninput = (e) => {
                quality = parseInt(e.target.value);
                if (valueDisp) valueDisp.textContent = quality;
            };
            let time = 0;
            const draw = () => {
                if(!document.getElementById('sim-real-canvas')) {
                    if(window.activeAnimationFrames.simReal) cancelAnimationFrame(window.activeAnimationFrames.simReal);
                    return;
                }
                const w = canvas.width, h = canvas.height;
                const isDark = document.documentElement.classList.contains('dark');
                ctx.clearRect(0, 0, w, h);
                time += 0.01;
                ctx.beginPath(); 
                ctx.strokeStyle = isDark ? '#f1f5f9' : '#1e293b'; 
                ctx.lineWidth = 3;
                for (let x = 0; x < w; x++) {
                    const y = h / 2 + Math.sin(x * 0.03 + time) * h / 6 + Math.cos(x * 0.07 + time) * h / 8;
                    x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                }
                ctx.stroke();
                ctx.beginPath(); 
                ctx.strokeStyle = '#3b82f6'; 
                ctx.lineWidth = 2; 
                ctx.setLineDash([5, 5]);
                const noise_amplitude = (100 - quality) / 100 * h / 3;
                for (let x = 0; x < w; x++) {
                    const real_y = h / 2 + Math.sin(x * 0.03 + time) * h / 6 + Math.cos(x * 0.07 + time) * h / 8;
                    const sim_y = real_y + (Math.random() - 0.5) * noise_amplitude;
                    x === 0 ? ctx.moveTo(x, sim_y) : ctx.lineTo(x, sim_y);
                }
                ctx.stroke();
                ctx.setLineDash([]);
                window.activeAnimationFrames.simReal = requestAnimationFrame(draw);
            };
            draw();
        }
        function initRlTrainingLab() {
            const canvas = document.getElementById('rl-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const chartCtx = document.getElementById('rewardChart')?.getContext('2d');
            if (!chartCtx) return;
            const startBtn = document.getElementById('start-sim');

            const GRID_SIZE = 8;
            const GOAL = { x: GRID_SIZE - 1, y: GRID_SIZE - 1 };
            const TRAPS = [{x: 2,y: 2},{x: 2,y: 3},{x: 3,y: 2},{x: 5,y: 5},{x: 6,y: 5}];
            let agent, q_table, episode, totalReward, rewardHistory, rewardChart, simParams, agentEpisode, agentSteps, isEpisodeRunning;

            const sliders = { gamma: document.getElementById('gamma-slider'), lr: document.getElementById('lr-slider'), epsilon: document.getElementById('epsilon-slider-ch9') };
            const valueLabels = { gamma: document.getElementById('gamma-value'), lr: document.getElementById('lr-value'), epsilon: document.getElementById('epsilon-value-ch9') };
            
            function setupParams() {
                simParams = { gamma: parseFloat(sliders.gamma.value), lr: parseFloat(sliders.lr.value), epsilon: parseFloat(sliders.epsilon.value) };
                valueLabels.gamma.textContent = simParams.gamma.toFixed(2);
                valueLabels.lr.textContent = simParams.lr.toFixed(2);
                valueLabels.epsilon.textContent = simParams.epsilon.toFixed(2);
            }

            function resetSimulation() {
                if (window.rlSimulationIntervalId) clearInterval(window.rlSimulationIntervalId);
                if (window.rlAgentIntervalId) clearInterval(window.rlAgentIntervalId);
                
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
                q_table = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(0).map(() => [0, 0, 0, 0]));
                episode = 0;
                totalReward = 0;
                rewardHistory = [];
                isEpisodeRunning = false;
                
                setupParams();
                resetChart();
                updateCounters();
                
                startBtn.disabled = false;
                startBtn.innerHTML = 'å¼€å§‹ / é‡ç½®è®­ç»ƒ';

                // Initial draw
                agent = {x:0, y:0};
                drawGrid();

                window.rlSimulationIntervalId = setInterval(runTrainingBatch, 50);
            }

            // This function runs in the background to train the Q-table
            function runTrainingBatch() {
                if (episode > 1000) { 
                    clearInterval(window.rlSimulationIntervalId); 
                    if (!isEpisodeRunning) {
                        startBtn.innerHTML = 'å¼€å§‹å¯è§†åŒ–æœ€ç»ˆç­–ç•¥';
                        startBtn.onclick = () => runAgentVisualization(true);
                    }
                    return; 
                }

                for(let i=0; i < 10; i++) { // Run 10 episodes per batch for faster training
                    let current_agent = { x: 0, y: 0 };
                    let episodeReward = 0, done = false, steps = 0;
                    while (!done && steps < 50) {
                        const state = { x: current_agent.x, y: current_agent.y };
                        const action = chooseAction(state, simParams.epsilon);
                        const nextState = getNextState(state, action);
                        const reward = getReward(nextState);
                        const old_q = q_table[state.y][state.x][action];
                        const next_max_q = Math.max(...q_table[nextState.y][nextState.x]);
                        q_table[state.y][state.x][action] = old_q + simParams.lr * (reward + simParams.gamma * next_max_q - old_q);
                        current_agent = nextState;
                        episodeReward += reward;
                        steps++;
                        done = isTerminal(nextState);
                    }
                    episode++;
                    rewardHistory.push(episodeReward);
                }
                
                updateChart();
                updateCounters();
                drawGrid(); // Redraw grid to show updated policy arrows
            }

            // This function visualizes one agent run, step by step
            function runAgentVisualization(isFinalPolicy = false) {
                 if (isEpisodeRunning) return;
                 isEpisodeRunning = true;
                 startBtn.disabled = true;

                 agent = { x: 0, y: 0 };
                 agentSteps = 0;
                 
                 if (window.rlAgentIntervalId) clearInterval(window.rlAgentIntervalId);
                 window.rlAgentIntervalId = setInterval(() => {
                    if (isTerminal(agent) || agentSteps > 50) {
                        clearInterval(window.rlAgentIntervalId);
                        isEpisodeRunning = false;
                        startBtn.disabled = false;
                        if(isFinalPolicy) startBtn.innerHTML = 'é‡æ–°å¯è§†åŒ–';
                        return;
                    }

                    // For visualization, use a greedy policy (low epsilon)
                    const action = chooseAction(agent, isFinalPolicy ? 0.0 : simParams.epsilon);
                    agent = getNextState(agent, action);
                    agentSteps++;
                    drawGrid();
                 }, 100);
            }

            function chooseAction(state, currentEpsilon) {
                if (Math.random() < currentEpsilon) return Math.floor(Math.random() * 4);
                const q_vals = q_table[state.y][state.x];
                const max_q = Math.max(...q_vals);
                const best_actions = q_vals.map((q,i) => q === max_q ? i : -1).filter(i => i !== -1);
                return best_actions[Math.floor(Math.random() * best_actions.length)]; // Break ties randomly
            }

            function getNextState({x,y}, action) {
                if (action === 0) y = Math.max(0, y - 1);
                else if (action === 1) y = Math.min(GRID_SIZE - 1, y + 1);
                else if (action === 2) x = Math.max(0, x - 1);
                else if (action === 3) x = Math.min(GRID_SIZE - 1, x + 1);
                return { x, y };
            }
            function getReward(state) {
                if (state.x === GOAL.x && state.y === GOAL.y) return 100;
                if (TRAPS.some(t => t.x === state.x && t.y === state.y)) return -100;
                return -1;
            }
            function isTerminal(state) { return (state.x === GOAL.x && state.y === GOAL.y) || TRAPS.some(t => t.x === state.x && t.y === state.y); }
            
            function drawGrid() {
                const cellSize = canvas.width / GRID_SIZE;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const isDark = document.documentElement.classList.contains('dark');
                for (let y = 0; y < GRID_SIZE; y++) {
                    for (let x = 0; x < GRID_SIZE; x++) {
                        if(TRAPS.some(t => t.x === x && t.y === y)) ctx.fillStyle = isDark ? '#450a0a' : '#fee2e2';
                        else if(GOAL.x === x && GOAL.y === y) ctx.fillStyle = isDark ? '#064e3b' : '#dcfce7';
                        else ctx.fillStyle = isDark ? '#334155' : '#f1f5f9';
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                        if (!isTerminal({x,y})) {
                            const bestAction = chooseAction({x,y}, 0.0); // Always show greedy policy
                            ctx.fillStyle = isDark ? '#cbd5e1' : 'rgba(0, 0, 0, 0.6)';
                            ctx.font = `${cellSize * 0.4}px sans-serif`;
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.fillText(['â†‘', 'â†“', 'â†', 'â†’'][bestAction], x * cellSize + cellSize / 2, y * cellSize + cellSize / 2);
                        }
                    }
                }
                ctx.font = `${cellSize * 0.6}px sans-serif`;
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText('S', cellSize / 2, cellSize / 2);
                ctx.fillText('ğŸ†', GOAL.x * cellSize + cellSize / 2, GOAL.y * cellSize + cellSize / 2);
                TRAPS.forEach(t => ctx.fillText('â˜ ï¸', t.x * cellSize + cellSize / 2, t.y * cellSize + cellSize / 2));
                
                if(agent) {
                    ctx.fillStyle = '#3b82f6';
                    ctx.beginPath();
                    ctx.arc(agent.x * cellSize + cellSize / 2, agent.y * cellSize + cellSize / 2, cellSize / 3.5, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }
            function resetChart() {
                if (rewardChart) rewardChart.destroy();
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#94a3b8' : '#475569';
                const gridColor = isDark ? 'rgba(148, 163, 184, 0.2)' : 'rgba(0, 0, 0, 0.1)';
                rewardChart = new Chart(chartCtx, {
                    type: 'line',
                    data: { labels: [], datasets: [{ label: 'æœ€è¿‘50å›åˆå¹³å‡å¥–åŠ±', data: [], borderColor: '#16a34a', tension: 0.2, pointRadius: 0, fill: true, backgroundColor: 'rgba(22, 163, 74, 0.1)' }] },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { title: { display: true, text: 'å¥–åŠ±', color: textColor }, grid: { color: gridColor }, ticks: { color: textColor } } }, plugins: { legend: { display: false } } }
                });
            }
            function updateChart() {
                if (!rewardChart || episode % 20 !== 0) return; // Update chart less frequently
                const recentRewards = rewardHistory.slice(-50);
                totalReward = recentRewards.reduce((a, b) => a + b, 0) / recentRewards.length;
                rewardChart.data.labels.push(episode);
                rewardChart.data.datasets[0].data.push(totalReward);
                if (rewardChart.data.labels.length > 50) {
                    rewardChart.data.labels.shift();
                    rewardChart.data.datasets[0].data.shift();
                }
                rewardChart.update('none');
            }
            function updateCounters() {
                document.getElementById('episode-counter').textContent = episode;
                document.getElementById('total-reward').textContent = totalReward.toFixed(2);
            }
            startBtn.addEventListener('click', resetSimulation);
            Object.values(sliders).forEach(slider => slider.addEventListener('input', setupParams));
            resetSimulation();
        }
        function selectStep(step) {
            const contentEl = document.getElementById('step-content');
            if (!contentEl) return;
            const content = {
                1: { title: "é˜¶æ®µä¸€ï¼šå»ºè®®æ¨¡å¼ (Advisory Mode)", description: 'RLæ™ºèƒ½ä½“ä»¥"å½±å­æ¨¡å¼"è¿è¡Œï¼Œå®æ—¶æ¥æ”¶ç”µå‚æ•°æ®å¹¶è®¡ç®—æœ€ä¼˜åŠ¨ä½œã€‚ä½†è¿™äº›åŠ¨ä½œå¹¶<strong>ä¸</strong>ç›´æ¥æ‰§è¡Œï¼Œè€Œæ˜¯ä½œä¸ºæ“ä½œå»ºè®®æ˜¾ç¤ºåœ¨æ“ä½œå‘˜ç«™çš„ç•Œé¢ä¸Šï¼Œç”±ç»éªŒä¸°å¯Œçš„äººå·¥æ“ä½œå‘˜ç¡®è®¤åæ‰§è¡Œã€‚', goals: ["åœ¨é›¶é£é™©ä¸‹éªŒè¯AIç­–ç•¥çš„é•¿æœŸæ€§èƒ½ã€‚", "è®©æ“ä½œå‘˜é€æ­¥ç†Ÿæ‚‰å’Œä¿¡ä»»AIçš„å†³ç­–é€»è¾‘ã€‚", "æ”¶é›†å¯¹æ¯”æ•°æ®ï¼Œé‡åŒ–AIç›¸æ¯”çº¯äººå·¥æ“ä½œçš„å…·ä½“æå‡ã€‚"], risk_mitigation: "æ“ä½œå‘˜æ‹¥æœ‰100%çš„æœ€ç»ˆæ§åˆ¶æƒï¼ŒAIæ— ä»»ä½•ç‰©ç†æ‰§è¡Œèƒ½åŠ›ï¼Œå®ç°ç»å¯¹å®‰å…¨ã€‚" },
                2: { title: "é˜¶æ®µäºŒï¼šç›‘ç£æ§åˆ¶ (Supervisory Control)", description: 'AIçš„è¾“å‡ºä¸å†æ˜¯ç›´æ¥çš„é˜€é—¨åŠ¨ä½œï¼Œè€Œæ˜¯è°ƒæ•´DCSä¸­ç°æœ‰PIDæ§åˆ¶å›è·¯çš„<strong>è®¾å®šå€¼</strong>ã€‚ä¾‹å¦‚ï¼ŒAIå†³å®šå°†"æ€»é£é‡PID"çš„ç›®æ ‡å€¼ä»50%è°ƒæ•´åˆ°55%ã€‚', goals: ["åœ¨ä¸æ”¹å˜åº•å±‚å¯é æ§åˆ¶ç»“æ„çš„å‰æä¸‹ï¼Œå®ç°æ›´é«˜å±‚çº§çš„ä¼˜åŒ–ã€‚", "åˆ©ç”¨ç°æœ‰DCSç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨è”é”ä½œä¸ºåº•å±‚å®‰å…¨ç½‘ã€‚", "åœ¨çœŸå®çš„é—­ç¯åé¦ˆä¸‹å¯¹æ¨¡å‹è¿›è¡Œåœ¨çº¿å¾®è°ƒã€‚"], risk_mitigation: "æ™ºèƒ½ä½“çš„ä½œç”¨èŒƒå›´è¢«é™åˆ¶åœ¨é«˜å±‚è®¾å®šå€¼ï¼Œåº•å±‚çš„å¿«é€Ÿè°ƒèŠ‚å’Œå®‰å…¨ä¿æŠ¤ä»ç”±ä¹…ç»è€ƒéªŒçš„PIDç³»ç»Ÿå®Œæˆï¼Œæå¤§é™ä½äº†é£é™©ã€‚" },
                3: { title: "é˜¶æ®µä¸‰ï¼šç›´æ¥æ§åˆ¶ (Direct Control)", description: 'AIè·å¾—å¯¹æ‰§è¡Œæœºæ„çš„ç›´æ¥æ§åˆ¶æƒã€‚ä½†å…¶è¾“å‡ºçš„æ‰€æœ‰æŒ‡ä»¤åœ¨å‘é€ç»™DCSä¹‹å‰ï¼Œå¿…é¡»å¼ºåˆ¶é€šè¿‡ä¸€ä¸ªæœ€ç»ˆçš„ã€ç¡¬ç¼–ç çš„<strong>å®‰å…¨å±‚ (Safety Layer)</strong>ã€‚', goals: ["å®ç°å®Œå…¨çš„è‡ªä¸»ä¼˜åŒ–ï¼Œå¯¹å·¥å†µå˜åŒ–åšå‡ºæœ€å¿«é€Ÿã€æœ€ç›´æ¥çš„å“åº”ã€‚", "æœ€å¤§åŒ–RLç­–ç•¥çš„æ€§èƒ½ã€‚"], risk_mitigation: '"å®‰å…¨å±‚"æ˜¯ä¸€ä¸ªéAIçš„ã€åŸºäºç®€å•è§„åˆ™çš„ç¨‹åºã€‚å®ƒä¼šæ£€æŸ¥AIçš„æ¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œå¹¶ç«‹å³å¦å†³ä»»ä½•å¯èƒ½è¿åç¡¬æ€§å®‰å…¨çº¦æŸçš„åŠ¨ä½œã€‚è¿™æ˜¯å¯¹æŠ—AIä¸å¯é¢„è§è¡Œä¸ºçš„æœ€åä¸€é“é˜²çº¿ã€‚' }
            };
            for (let i = 1; i <= 3; i++) document.getElementById(`step${i}`)?.classList.toggle('active', i === step);
            const selectedContent = content[step];
            if (selectedContent) {
                contentEl.innerHTML = `<h3 class="text-xl font-bold mb-4">${selectedContent.title}</h3><p class="text-themed-secondary mb-4">${selectedContent.description}</p><h4 class="font-bold text-lg mb-2">ä¸»è¦ç›®æ ‡:</h4><ul class="list-disc list-inside space-y-1 text-themed-secondary mb-4">${selectedContent.goals.map(g => `<li>${g}</li>`).join('')}</ul><h4 class="font-bold text-lg mb-2">é£é™©æ§åˆ¶:</h4><p class="p-3 bg-green-500/10 border border-green-500/20 text-green-700 dark:text-green-300 rounded-lg">${selectedContent.risk_mitigation}</p>`;
            }
        }
        function renderBoilerDiagram() {
            const container = document.getElementById('boiler-diagram-container');
            if (!container) return;
            container.innerHTML = `<svg viewBox="0 0 300 200" xmlns="http://www.w3.org/2000/svg"><style>.txt{font-size:8px; font-family: 'Noto Sans SC', sans-serif; text-anchor: middle; fill: var(--text-secondary);} .line{stroke: var(--text-secondary); fill: none;} .arr{marker-end: url(#arrow); stroke-width: 0.8; stroke: var(--text-secondary); fill: none;}</style><defs><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="var(--text-secondary)"/></marker></defs><rect x="100" y="20" width="100" height="160" fill="var(--bg-muted)" stroke="var(--border-color)" stroke-width="1.5"/><text x="150" y="15" class="txt">é”…ç‚‰</text><path d="M120,20 v-10 h60 v10" class="line" stroke-width="1.5"/><path d="M145,10 v-5 h10 v5" class="line" stroke-width="1.5"/><text x="150" y="7" class="txt" fill="#c2410c">è¿‡çƒ­è’¸æ±½</text><rect x="110" y="100" width="80" height="40" fill="#fef9c3" stroke="#facc15" /><text x="150" y="125" class="txt">ç‡ƒçƒ§åŒº</text><path d="M100,140 h-20 v-10 h20" class="arr" /><text x="65" y="135" class="txt">ç‡ƒæ–™+ç©ºæ°”</text><path d="M200,160 h20 v-10 h-20" class="arr" /><text x="225" y="155" class="txt">ç°æ¸£</text><rect x="230" y="60" width="50" height="80" fill="#dbeafe" stroke="#60a5fa" stroke-width="1"/><text x="255" y="55" class="txt">æ±½è½®æœº</text><path d="M150,25 h80 v40" class="arr" /><rect x="230" y="150" width="50" height="30" fill="#e0f2fe" stroke="#38bdf8" stroke-width="1"/><text x="255" y="145" class="txt">å†·å‡å™¨</text><path d="M255,140 v-35" class="arr" /><rect x="40" y="160" width="50" height="20" fill="#dcfce7" stroke="#4ade80" stroke-width="1"/><text x="65" y="155" class="txt">ç»™æ°´æ³µ</text><path d="M255,180 h-190 v-15" class="arr" /><path d="M40,170 h-10 v-20 h80" class="arr" /></svg>`;
        }
        function renderRankineDiagram() {
            const container = document.getElementById('rankine-diagram-container');
            if (!container) return;
            container.innerHTML = `<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg"><style>.txt{font-size:7px; font-family: 'Noto Sans SC', sans-serif; fill: var(--text-primary);} .lbl{font-size:6px; fill: var(--text-secondary);} .line{stroke-width:1; stroke:var(--text-secondary); fill:none;} .cycle{stroke-width:1.5; stroke:#ef4444; fill:none; marker-end: url(#arrow-red);}</style><defs><marker id="arrow-red" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="3" markerHeight="3" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#ef4444"/></marker></defs><path d="M20,140 L20,10 L180,10" class="line" /><text x="15" y="15" class="txt" text-anchor="end">T</text><text x="180" y="15" class="txt" text-anchor="end">s</text><path d="M40,120 C 80,120 80,40 120,40" class="line" /><text x="80" y="30" class="lbl">é¥±å’Œè’¸æ±½çº¿</text><path d="M40,120 C 30,80 30,40 40,30" class="line" /><text x="35" y="25" class="lbl">é¥±å’Œæ¶²ä½“çº¿</text><path d="M45,115 L45,80" class="cycle"/><text x="38" y="100" class="txt">1â†’2</text><text x="52" y="100" class="lbl">(æ³µ)</text><path d="M45,80 C60,78 140,75 160,45" class="cycle"/><text x="90" y="65" class="lbl">(é”…ç‚‰)</text><path d="M160,45 L170,105" class="cycle"/><text x="158" y="40" class="txt">2â†’3</text><text x="175" y="70" class="lbl">(æ±½è½®æœº)</text><path d="M170,105 L45,115" class="cycle"/><text x="173" y="108" class="txt">3â†’4</text><text x="110" y="120" class="lbl">(å†·å‡å™¨)</text></svg>`;
        }
        function renderRlTaxonomy() {
            const container = document.getElementById('rl-taxonomy-container');
            if (!container) return;
            container.innerHTML = `<svg viewBox="0 0 250 150" xmlns="http://www.w3.org/2000/svg"><style>.box{fill:var(--bg-secondary); stroke:var(--accent-color); rx:3;} .txt{font-size:8px; font-family: 'Noto Sans SC', sans-serif; text-anchor:middle; fill: var(--text-primary);} .line{stroke:var(--text-secondary); stroke-width:0.5;}</style><rect x="85" y="5" width="80" height="15" class="box" /><text x="125" y="14" class="txt">å¼ºåŒ–å­¦ä¹ </text><line x1="125" y1="20" x2="125" y2="30" class="line" /><line x1="60" y1="30" x2="190" y2="30" class="line" /><line x1="60" y1="30" x2="60" y2="40" class="line" /><line x1="190" y1="30" x2="190" y2="40" class="line" /><rect x="20" y="40" width="80" height="15" class="box" /><text x="60" y="49" class="txt">åŸºäºæ¨¡å‹</text><rect x="150" y="40" width="80" height="15" class="box" /><text x="190" y="49" class="txt">æ— æ¨¡å‹</text><line x1="190" y1="55" x2="190" y2="65" class="line" /><line x1="155" y1="65" x2="225" y2="65" class="line" /><line x1="155" y1="65" x2="155" y2="75" class="line" /><line x1="225" y1="65" x2="225" y2="75" class="line" /><rect x="115" y="75" width="80" height="15" class="box" /><text x="155" y="84" class="txt">åŸºäºç­–ç•¥</text><rect x="185" y="75" width="80" height="15" class="box" /><text x="225" y="84" class="txt">åŸºäºä»·å€¼</text><line x1="155" y1="90" x2="155" y2="100" class="line" /><rect x="115" y="100" width="80" height="15" style="fill:#dcfce7; stroke:#4ade80;" /><text x="155" y="109" class="txt">PPO</text><line x1="225" y1="90" x2="225" y2="100" class="line" /><rect x="185" y="100" width="80" height="15" style="fill:#fef9c3; stroke:#facc15;" /><text x="225" y="109" class="txt">DQN</text><path d="M155,90 C175,95 205,95 225,90" fill="none" class="line"/><line x1="190" y1="92.5" x2="190" y2="120" class="line"/><text x="190" y="108" class="txt">æ¼”å‘˜-è¯„è®ºå®¶</text><rect x="150" y="120" width="80" height="15" style="fill:#fbcfe8; stroke:#f472b6;" /><text x="190" y="129" class="txt">SAC / DDPG</text></svg>`;
        }
        function renderAcDiagram(container) {
            if (!container) return;
            container.innerHTML = `<svg id="ac-viz-svg" viewBox="0 0 400 300" class="w-full max-w-lg"><defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="5" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#9ca3af" /></marker><marker id="arrowhead-h" markerWidth="10" markerHeight="7" refX="5" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#f97316" /></marker></defs><style>.ac-node rect { transition: all 0.3s ease; transform-origin: center; } .ac-node.highlight rect { stroke-width:3; transform: scale(1.05); stroke: #f97316; } .ac-arrow { transition: stroke 0.3s ease; } text { fill: var(--text-primary); font-size:12px; font-family: 'Noto Sans SC', sans-serif; text-anchor: middle; }</style><g class="ac-node" id="node-state"><rect x="10" y="30" width="80" height="40" rx="5" fill="var(--bg-secondary)" stroke="var(--border-color)" stroke-width="2" /></g><text x="50" y="25">çŠ¶æ€ S</text><path class="ac-arrow" id="arrow-to-actor" d="M95,50 C140,50 140,90 185,90" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-node" id="node-actor"><rect x="185" y="85" width="80" height="40" rx="20" fill="#eff6ff" stroke="#60a5fa" stroke-width="2" /></g><text x="225" y="80">æ¼”å‘˜ Actor</text><path class="ac-arrow" id="arrow-to-action" d="M225,130 Q225,150 225,170" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-node" id="node-action"><rect x="185" y="170" width="80" height="40" rx="5" fill="var(--bg-secondary)" stroke="var(--border-color)" stroke-width="2" /></g><text x="225" y="165">åŠ¨ä½œ A</text><path class="ac-arrow" id="arrow-to-env" d="M180,190 C140,190 140,230 105,230" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><g class="ac-node" id="node-env"><rect x="25" y="225" width="80" height="40" rx="20" fill="#fff7ed" stroke="#fb923c" stroke-width="2" /></g><text x="65" y="220">ç¯å¢ƒ Env</text><path class="ac-arrow" id="arrow-to-critic" d="M110,245 C160,245 250,245 295,245" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" /><text x="200" y="265" font-size="10">å¥–åŠ± R, æ–°çŠ¶æ€ S'</text><g class="ac-node" id="node-critic"><rect x="300" y="225" width="80" height="40" rx="20" fill="#f0fdf4" stroke="#4ade80" stroke-width="2" /></g><text x="340" y="220">è¯„è®ºå®¶ Critic</text><path class="ac-arrow" id="arrow-critic-to-actor" d="M340,220 C340,150 270,150 265,125" stroke="#9ca3af" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5" /><g id="label-update"><text x="310" y="170" font-weight="bold" font-size="12" fill="transparent">ä¼˜åŠ¿ A(s,a)</text></g></svg>`;
        }
        function renderOfflineRLDiagram() {
            const container = document.getElementById('offline-rl-diagram');
            if (!container) return;
            container.innerHTML = `<svg viewBox="0 0 400 250" class="w-full max-w-lg"><style>.text { font-size: 12px; font-family: 'Noto Sans SC', sans-serif; fill: var(--text-primary); } .small-text { font-size: 10px; fill: var(--text-secondary); }</style><defs><marker id="arrow-dark" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="var(--text-secondary)"/></marker></defs><ellipse cx="200" cy="125" rx="120" ry="60" fill="rgba(79, 70, 229, 0.1)" stroke="rgba(79, 70, 229, 0.3)" stroke-dasharray="5,5"/><text x="200" y="125" text-anchor="middle" class="text">æ•°æ®é›† D (è¡Œä¸ºç­–ç•¥ $\\pi_\\beta$ çš„è½¨è¿¹)</text><circle cx="150" cy="110" r="5" fill="#22c55e"/><text x="150" y="100" text-anchor="middle" class="small-text">æ•°æ®æ”¯æŒçš„å¥½åŠ¨ä½œ</text><circle cx="250" cy="140" r="5" fill="#ef4444"/><text x="250" y="160" text-anchor="middle" class="small-text">æ•°æ®æ”¯æŒçš„ååŠ¨ä½œ</text><circle cx="350" cy="80" r="5" fill="#f97316"/><path d="M345,85 L300,110" stroke="#f97316" stroke-width="1.5" marker-end="url(#arrow-dark)"/><text x="355" y="75" text-anchor="start" class="small-text" fill="#f97316">åˆ†å¸ƒå¤–(OOD)åŠ¨ä½œ</text><text x="355" y="90" text-anchor="start" class="small-text" fill="#f97316">Qå€¼ä¼°è®¡ä¸å‡†ï¼Œå¯èƒ½è¢«é«˜ä¼°</text><ellipse cx="180" cy="115" rx="50" ry="25" fill="none" stroke="#16a34a" stroke-width="2"/><text x="180" y="150" text-anchor="middle" class="text" fill="#16a34a">ä¿å®ˆç­–ç•¥ $\\pi_\\theta$</text><text x="180" y="165" text-anchor="middle" class="small-text" fill="#16a34a">(è¢«çº¦æŸåœ¨æ•°æ®åˆ†å¸ƒå†…)</text></svg>`;
        }
    </script>
</body>
</html>
